<Page x:Class="VendaFlex.UI.Views.Reports.ReportManagementView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:local="clr-namespace:VendaFlex.UI.Views.Reports"
      xmlns:vm="clr-namespace:VendaFlex.ViewModels.Reports"
      xmlns:infconv="clr-namespace:VendaFlex.Infrastructure.Converters"
      xmlns:oxy="http://oxyplot.org/wpf"
      mc:Ignorable="d"
      d:DesignHeight="800" d:DesignWidth="1400"
      Background="{DynamicResource MaterialDesignPaper}"
      Title="Relatórios">

    <Page.Resources>

        <infconv:CountToVisibilityConverter x:Key="CountToVisibilityConverter"/>
        <infconv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

        <!-- Card Style -->
        <Style x:Key="ReportCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="24"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="15" ShadowDepth="3" Opacity="0.08" Color="#2C3E50"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Report Button Style -->
        <Style x:Key="ReportButtonStyle" TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}">
            <Setter Property="Height" Value="100"/>
            <Setter Property="Margin" Value="6"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Background" Value="#F8F9FA"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="materialDesign:ButtonAssist.CornerRadius" Value="10"/>
            <Setter Property="materialDesign:ElevationAssist.Elevation" Value="Dp2"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.1" Color="#2C3E50"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                            VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                            TextElement.Foreground="{TemplateBinding Foreground}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource PrimaryHueLightBrush}"/>
                                <Setter Property="BorderBrush" Value="{DynamicResource PrimaryHueMidBrush}"/>
                                <Setter Property="Foreground" Value="{DynamicResource PrimaryHueDarkBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{DynamicResource PrimaryHueMidBrush}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Stat Card Style -->
        <Style x:Key="StatCardStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="6"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="12" ShadowDepth="2" Opacity="0.1" Color="Black"/>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Icon Button Style -->
        <Style x:Key="IconButtonStyle" TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}">
            <Setter Property="Width" Value="36"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="4,0"/>
        </Style>
    </Page.Resources>

    <Grid>
        <!-- Loading Overlay -->
        <Border Background="#80000000" Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                Panel.ZIndex="1000">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                             Value="0" IsIndeterminate="True"
                             Width="70" Height="70"
                             Foreground="White"/>
                <TextBlock Text="Carregando relatórios..." Foreground="White" 
                          FontSize="18" FontWeight="Medium"
                          Margin="0,20,0,0" 
                          HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Main Content -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/><!-- Header -->
                    <RowDefinition Height="Auto"/><!-- Quick Stats -->
                    <RowDefinition Height="Auto"/><!-- Filters -->
                    <RowDefinition Height="Auto"/><!-- Categories -->
                    <RowDefinition Height="*"/><!-- Content -->
                </Grid.RowDefinitions>

                <!-- Header with Actions -->
                <Border Grid.Row="0" Style="{StaticResource ReportCardStyle}" Margin="0,0,0,20">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Title Section -->
                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="ChartBox" 
                                                        Width="36" Height="36"
                                                        Foreground="{DynamicResource PrimaryHueMidBrush}"
                                                        VerticalAlignment="Center"
                                                        Margin="0,0,12,0"/>
                                <TextBlock Text="Centro de Relatórios" 
                                          FontSize="28" FontWeight="Bold"
                                          Foreground="{DynamicResource PrimaryHueDarkBrush}"
                                          VerticalAlignment="Center"/>
                            </StackPanel>
                            <TextBlock Text="Análises, indicadores e insights do negócio" 
                                      FontSize="14"
                                      Foreground="{DynamicResource MaterialDesignBodyLight}"
                                      Margin="48,4,0,0"/>
                        </StackPanel>

                        <!-- Quick Period Actions -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                            <Button Content="Hoje" Command="{Binding QuickPeriodTodayCommand}"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    Height="36" Padding="16,0"
                                    Margin="4,0">
                                <Button.ToolTip>
                                    <ToolTip Content="Filtrar para hoje"/>
                                </Button.ToolTip>
                            </Button>
                            <Button Content="Semana" Command="{Binding QuickPeriodWeekCommand}"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    Height="36" Padding="16,0"
                                    Margin="4,0">
                                <Button.ToolTip>
                                    <ToolTip Content="Filtrar últimos 7 dias"/>
                                </Button.ToolTip>
                            </Button>
                            <Button Content="Mês" Command="{Binding QuickPeriodMonthCommand}"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    Height="36" Padding="16,0"
                                    Margin="4,0">
                                <Button.ToolTip>
                                    <ToolTip Content="Filtrar último mês"/>
                                </Button.ToolTip>
                            </Button>
                            <Button Content="Ano" Command="{Binding QuickPeriodYearCommand}"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    Height="36" Padding="16,0"
                                    Margin="4,0">
                                <Button.ToolTip>
                                    <ToolTip Content="Filtrar último ano"/>
                                </Button.ToolTip>
                            </Button>
                            
                            <Button Command="{Binding RefreshDashboardCommand}"
                                    Style="{StaticResource MaterialDesignIconButton}"
                                    ToolTip="Atualizar dashboard"
                                    Margin="12,0,0,0">
                                <materialDesign:PackIcon Kind="Refresh" Width="24" Height="24"/>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Statistics Cards -->
                <Grid Grid.Row="1" Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Total Sales -->
                    <Border Grid.Column="0" Style="{StaticResource StatCardStyle}">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#667eea" Offset="0"/>
                                <GradientStop Color="#764ba2" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <StackPanel>
                            <materialDesign:PackIcon Kind="CurrencyUsd" Width="32" Height="32"
                                                    Foreground="White" Opacity="0.9"/>
                            <TextBlock Text="Vendas Totais" FontSize="13" Margin="0,8,0,4"
                                      Foreground="White" Opacity="0.85"/>
                            <TextBlock Text="{Binding TotalSalesValue, StringFormat='Kz {0:N2}'}"
                                      FontSize="22" FontWeight="Bold"
                                      Foreground="White"/>
                        </StackPanel>
                    </Border>

                    <!-- Total Invoices -->
                    <Border Grid.Column="1" Style="{StaticResource StatCardStyle}">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#f093fb" Offset="0"/>
                                <GradientStop Color="#f5576c" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <StackPanel>
                            <materialDesign:PackIcon Kind="Receipt" Width="32" Height="32"
                                                    Foreground="White" Opacity="0.9"/>
                            <TextBlock Text="Total de Faturas" FontSize="13" Margin="0,8,0,4"
                                      Foreground="White" Opacity="0.85"/>
                            <TextBlock Text="{Binding TotalInvoices}"
                                      FontSize="22" FontWeight="Bold"
                                      Foreground="White"/>
                        </StackPanel>
                    </Border>

                    <!-- Revenue -->
                    <Border Grid.Column="2" Style="{StaticResource StatCardStyle}">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#4facfe" Offset="0"/>
                                <GradientStop Color="#00f2fe" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <StackPanel>
                            <materialDesign:PackIcon Kind="Cash" Width="32" Height="32"
                                                    Foreground="White" Opacity="0.9"/>
                            <TextBlock Text="Receita" FontSize="13" Margin="0,8,0,4"
                                      Foreground="White" Opacity="0.85"/>
                            <TextBlock Text="{Binding TotalRevenue, StringFormat='Kz {0:N2}'}"
                                      FontSize="22" FontWeight="Bold"
                                      Foreground="White"/>
                        </StackPanel>
                    </Border>

                    <!-- Stock Value -->
                    <Border Grid.Column="3" Style="{StaticResource StatCardStyle}">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#43e97b" Offset="0"/>
                                <GradientStop Color="#38f9d7" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <StackPanel>
                            <materialDesign:PackIcon Kind="Package" Width="32" Height="32"
                                                    Foreground="White" Opacity="0.9"/>
                            <TextBlock Text="Valor do Estoque" FontSize="13" Margin="0,8,0,4"
                                      Foreground="White" Opacity="0.85"/>
                            <TextBlock Text="{Binding TotalStockValue, StringFormat='Kz {0:N2}'}"
                                      FontSize="22" FontWeight="Bold"
                                      Foreground="White"/>
                        </StackPanel>
                    </Border>

                    <!-- Profit Margin -->
                    <Border Grid.Column="4" Style="{StaticResource StatCardStyle}">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#fa709a" Offset="0"/>
                                <GradientStop Color="#fee140" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <StackPanel>
                            <materialDesign:PackIcon Kind="TrendingUp" Width="32" Height="32"
                                                    Foreground="White" Opacity="0.9"/>
                            <TextBlock Text="Margem de Lucro" FontSize="13" Margin="0,8,0,4"
                                      Foreground="White" Opacity="0.85"/>
                            <TextBlock Text="{Binding TotalProfitMargin, StringFormat='{}{0:F1}%'}"
                                      FontSize="22" FontWeight="Bold"
                                      Foreground="White"/>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- Filtros Avançados (Expansível) -->
                <Border Grid.Row="2" Style="{StaticResource ReportCardStyle}" Margin="0,0,0,20">
                    <StackPanel>
                        <!-- Filter Header -->
                        <Button Command="{Binding ToggleAdvancedFiltersCommand}"
                                Style="{StaticResource MaterialDesignFlatButton}"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Left"
                                Padding="0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <materialDesign:PackIcon Grid.Column="0" Kind="FilterVariant" 
                                                        Width="24" Height="24"
                                                        Margin="0,0,12,0"
                                                        VerticalAlignment="Center"/>
                                
                                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock Text="Filtros Avançados" 
                                              FontSize="16" FontWeight="SemiBold"
                                              VerticalAlignment="Center"/>
                                    <Border Background="{DynamicResource PrimaryHueMidBrush}"
                                            CornerRadius="10"
                                            Padding="8,2"
                                            Margin="12,0,0,0"
                                            Visibility="{Binding IsAdvancedFiltersVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <TextBlock Text="ATIVO" 
                                                  FontSize="10" FontWeight="Bold"
                                                  Foreground="White"/>
                                    </Border>
                                </StackPanel>

                                <materialDesign:PackIcon Grid.Column="2" Kind="ChevronDown" 
                                                        Width="24" Height="24"
                                                        VerticalAlignment="Center">
                                    <materialDesign:PackIcon.RenderTransform>
                                        <RotateTransform Angle="0" CenterX="12" CenterY="12"/>
                                    </materialDesign:PackIcon.RenderTransform>
                                    <materialDesign:PackIcon.Style>
                                        <Style TargetType="materialDesign:PackIcon">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsAdvancedFiltersVisible}" Value="True">
                                                    <DataTrigger.EnterActions>
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                                                               To="180" Duration="0:0:0.3">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <CubicEase EasingMode="EaseOut"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </DataTrigger.EnterActions>
                                                    <DataTrigger.ExitActions>
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                                                               To="0" Duration="0:0:0.3">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <CubicEase EasingMode="EaseIn"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </DataTrigger.ExitActions>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </materialDesign:PackIcon.Style>
                                </materialDesign:PackIcon>
                            </Grid>
                        </Button>

                        <!-- Filtros Expansíveis -->
                        <Border BorderThickness="0,1,0,0" 
                                BorderBrush="{DynamicResource MaterialDesignDivider}"
                                Margin="0,12,0,0">
                            <Grid>
                                <Grid.Style>
                                    <Style TargetType="Grid">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Setter Property="MaxHeight" Value="0"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsAdvancedFiltersVisible}" Value="True">
                                                <DataTrigger.EnterActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility">
                                                                <DiscreteObjectKeyFrame KeyTime="0:0:0" Value="{x:Static Visibility.Visible}"/>
                                                            </ObjectAnimationUsingKeyFrames>
                                                            <DoubleAnimation Storyboard.TargetProperty="MaxHeight"
                                                                           To="500" Duration="0:0:0.3">
                                                                <DoubleAnimation.EasingFunction>
                                                                    <CubicEase EasingMode="EaseOut"/>
                                                                </DoubleAnimation.EasingFunction>
                                                            </DoubleAnimation>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </DataTrigger.EnterActions>
                                                <DataTrigger.ExitActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetProperty="MaxHeight"
                                                                           To="0" Duration="0:0:0.3">
                                                                <DoubleAnimation.EasingFunction>
                                                                    <CubicEase EasingMode="EaseIn"/>
                                                                </DoubleAnimation.EasingFunction>
                                                            </DoubleAnimation>
                                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility">
                                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.3" Value="{x:Static Visibility.Collapsed}"/>
                                                            </ObjectAnimationUsingKeyFrames>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </DataTrigger.ExitActions>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Style>

                                <StackPanel Margin="0,16,0,0">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Período -->
                                        <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,8,16">
                                            <TextBlock Text="Data Inicial" 
                                                      FontSize="12" FontWeight="SemiBold"
                                                      Margin="0,0,0,8"/>
                                            <DatePicker SelectedDate="{Binding StartDate}"
                                                       materialDesign:HintAssist.Hint="Selecione a data"
                                                       Style="{StaticResource MaterialDesignFloatingHintDatePicker}"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="0" Grid.Column="1" Margin="8,0,8,16">
                                            <TextBlock Text="Data Final" 
                                                      FontSize="12" FontWeight="SemiBold"
                                                      Margin="0,0,0,8"/>
                                            <DatePicker SelectedDate="{Binding EndDate}"
                                                       materialDesign:HintAssist.Hint="Selecione a data"
                                                       Style="{StaticResource MaterialDesignFloatingHintDatePicker}"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="0" Grid.Column="2" Margin="8,0,0,16">
                                            <TextBlock Text="Agrupamento" 
                                                      FontSize="12" FontWeight="SemiBold"
                                                      Margin="0,0,0,8"/>
                                            <ComboBox ItemsSource="{Binding PeriodGroupingOptions}"
                                                     SelectedItem="{Binding SelectedPeriodGrouping}"
                                                     materialDesign:HintAssist.Hint="Agrupar por"
                                                     Style="{StaticResource MaterialDesignFloatingHintComboBox}"/>
                                        </StackPanel>

                                        <!-- Filtros Adicionais -->
                                        <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,8,0">
                                            <TextBlock Text="Status da Fatura" 
                                                      FontSize="12" FontWeight="SemiBold"
                                                      Margin="0,0,0,8"/>
                                            <ComboBox ItemsSource="{Binding InvoiceStatusOptions}"
                                                     SelectedItem="{Binding SelectedInvoiceStatus}"
                                                     materialDesign:HintAssist.Hint="Todos os status"
                                                     Style="{StaticResource MaterialDesignFloatingHintComboBox}"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="1" Grid.Column="1" Margin="8,0,8,0">
                                            <TextBlock Text="Usuário" 
                                                      FontSize="12" FontWeight="SemiBold"
                                                      Margin="0,0,0,8"/>
                                            <ComboBox ItemsSource="{Binding Users}"
                                                     SelectedValue="{Binding SelectedUserId}"
                                                     DisplayMemberPath="Username"
                                                     SelectedValuePath="UserId"
                                                     materialDesign:HintAssist.Hint="Todos os usuários"
                                                     Style="{StaticResource MaterialDesignFloatingHintComboBox}"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="1" Grid.Column="2" Margin="8,0,0,0">
                                            <TextBlock Text="Forma de Pagamento" 
                                                      FontSize="12" FontWeight="SemiBold"
                                                      Margin="0,0,0,8"/>
                                            <ComboBox SelectedValue="{Binding SelectedPaymentTypeId}"
                                                     materialDesign:HintAssist.Hint="Todas as formas"
                                                     Style="{StaticResource MaterialDesignFloatingHintComboBox}"/>
                                        </StackPanel>
                                    </Grid>

                                    <!-- Ações dos Filtros -->
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                                        <Button Content="Limpar Filtros" 
                                               Command="{Binding ClearFiltersCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               Margin="0,0,8,0"/>
                                        <Button Content="Aplicar Filtros" 
                                               Command="{Binding ApplyFiltersCommand}"
                                               Style="{StaticResource MaterialDesignRaisedButton}">
                                            <Button.CommandParameter>
                                                <materialDesign:PackIcon Kind="Check"/>
                                            </Button.CommandParameter>
                                        </Button>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </StackPanel>
                </Border>

            <!-- Main Content -->
            <TabControl Grid.Row="3" 
                       SelectedIndex="{Binding SelectedCategoryIndex}"
                       Style="{StaticResource MaterialDesignFilledTabControl}">

                <!-- Sales Reports Tab -->
                <TabItem Header="Vendas">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="ChartLine" Width="20" Height="20" Margin="0,0,8,0"/>
                                <TextBlock Text="Vendas"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="16">
                            <!-- Report Buttons -->
                            <UniformGrid Columns="3" Margin="0,0,0,24">
                                <Button Command="{Binding GenerateSalesByPeriodCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel HorizontalAlignment="Center">
                                        <materialDesign:PackIcon Kind="CalendarRange" Width="40" Height="40" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Vendas por Período" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0" TextAlignment="Center"/>
                                        <TextBlock Text="Análise temporal" FontSize="11" Foreground="{DynamicResource MaterialDesignBodyLight}" TextAlignment="Center"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding GenerateTopProductsCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel HorizontalAlignment="Center">
                                        <materialDesign:PackIcon Kind="TrophyVariant" Width="40" Height="40" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Top Produtos" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0" TextAlignment="Center"/>
                                        <TextBlock Text="Mais vendidos" FontSize="11" Foreground="{DynamicResource MaterialDesignBodyLight}" TextAlignment="Center"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding GenerateSalesByCustomerCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel HorizontalAlignment="Center">
                                        <materialDesign:PackIcon Kind="AccountGroup" Width="40" Height="40" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Vendas por Cliente" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0" TextAlignment="Center"/>
                                        <TextBlock Text="Por cliente" FontSize="11" Foreground="{DynamicResource MaterialDesignBodyLight}" TextAlignment="Center"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding GenerateProfitMarginCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel HorizontalAlignment="Center">
                                        <materialDesign:PackIcon Kind="ChartLineVariant" Width="40" Height="40" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Margem de Lucro" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0" TextAlignment="Center"/>
                                        <TextBlock Text="Análise de margem" FontSize="11" Foreground="{DynamicResource MaterialDesignBodyLight}" TextAlignment="Center"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding GenerateInvoicesByStatusCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel HorizontalAlignment="Center">
                                        <materialDesign:PackIcon Kind="FileDocumentMultiple" Width="40" Height="40" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Faturas por Status" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0" TextAlignment="Center"/>
                                        <TextBlock Text="Status das faturas" FontSize="11" Foreground="{DynamicResource MaterialDesignBodyLight}" TextAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                            </UniformGrid>

                            <!-- Sales by Period Results -->
                            <Border Style="{StaticResource ReportCardStyle}" 
                                   Visibility="{Binding SalesByPeriod.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="CalendarRange" Width="24" Height="24" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Vendas por Período" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <Button Content="Exportar" Command="{Binding ExportSalesByPeriodCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right">
                                            <Button.CommandParameter>
                                                <materialDesign:PackIcon Kind="Download"/>
                                            </Button.CommandParameter>
                                        </Button>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding SalesByPeriod}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Data" Binding="{Binding DateFormatted}" Width="120"/>
                                            <DataGridTextColumn Header="Faturas" Binding="{Binding InvoiceCount}" Width="100"/>
                                            <DataGridTextColumn Header="Total" Binding="{Binding TotalValue, StringFormat='Kz {0:N2}'}" Width="*"/>
                                            <DataGridTextColumn Header="Pago" Binding="{Binding PaidValue, StringFormat='Kz {0:N2}'}" Width="*"/>
                                            <DataGridTextColumn Header="Pendente" Binding="{Binding PendingValue, StringFormat='Kz {0:N2}'}" Width="*"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>

                            <!-- Top Products Results -->
                            <Border Style="{StaticResource ReportCardStyle}"
                                   Visibility="{Binding TopProducts.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="TrophyVariant" Width="24" Height="24" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Top 20 Produtos Mais Vendidos" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <Button Content="Exportar" Command="{Binding ExportTopProductsCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding TopProducts}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="#" Binding="{Binding Rank}" Width="50"/>
                                            <DataGridTextColumn Header="Produto" Binding="{Binding ProductName}" Width="*"/>
                                            <DataGridTextColumn Header="Quantidade" Binding="{Binding QuantitySold, StringFormat='{}{0:N0}'}" Width="120"/>
                                            <DataGridTextColumn Header="Valor Total" Binding="{Binding TotalValue, StringFormat='Kz {0:N2}'}" Width="150"/>
                                            <DataGridTextColumn Header="Preço Médio" Binding="{Binding AveragePrice, StringFormat='Kz {0:N2}'}" Width="150"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>

                            <!-- Sales by Customer Results -->
                            <Border Style="{StaticResource ReportCardStyle}"
                                   Visibility="{Binding SalesByCustomer.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="AccountGroup" Width="24" Height="24" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Vendas por Cliente" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <Button Content="Exportar" Command="{Binding ExportSalesByCustomerCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding SalesByCustomer}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Cliente" Binding="{Binding CustomerName}" Width="*"/>
                                            <DataGridTextColumn Header="Faturas" Binding="{Binding InvoiceCount}" Width="100"/>
                                            <DataGridTextColumn Header="Total" Binding="{Binding TotalValue, StringFormat='Kz {0:N2}'}" Width="150"/>
                                            <DataGridTextColumn Header="Pago" Binding="{Binding PaidValue, StringFormat='Kz {0:N2}'}" Width="150"/>
                                            <DataGridTextColumn Header="Pendente" Binding="{Binding PendingValue, StringFormat='Kz {0:N2}'}" Width="150"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Financial Reports Tab -->
                <TabItem Header="Financeiro">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Cash" Width="20" Height="20" Margin="0,0,8,0"/>
                                <TextBlock Text="Financeiro"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="16">
                            <!-- Financial Report Buttons -->
                            <UniformGrid Columns="3" Margin="0,0,0,24">
                                <Button Command="{Binding GenerateCashFlowCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel HorizontalAlignment="Center">
                                        <materialDesign:PackIcon Kind="ChartAreaspline" Width="40" Height="40" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Fluxo de Caixa" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0" TextAlignment="Center"/>
                                        <TextBlock Text="Entradas e saídas" FontSize="11" Foreground="{DynamicResource MaterialDesignBodyLight}" TextAlignment="Center"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding GeneratePaymentMethodsCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel HorizontalAlignment="Center">
                                        <materialDesign:PackIcon Kind="CreditCard" Width="40" Height="40" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Formas de Pagamento" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0" TextAlignment="Center"/>
                                        <TextBlock Text="Métodos de pagamento" FontSize="11" Foreground="{DynamicResource MaterialDesignBodyLight}" TextAlignment="Center"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding GenerateAccountsReceivableCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel HorizontalAlignment="Center">
                                        <materialDesign:PackIcon Kind="ClockAlert" Width="40" Height="40" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Contas a Receber" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0" TextAlignment="Center"/>
                                        <TextBlock Text="Faturas pendentes" FontSize="11" Foreground="{DynamicResource MaterialDesignBodyLight}" TextAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                            </UniformGrid>

                            <!-- Cash Flow Results -->
                            <Border Style="{StaticResource ReportCardStyle}"
                                   Visibility="{Binding CashFlow.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="ChartAreaspline" Width="24" Height="24" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Fluxo de Caixa" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <Button Content="Exportar" Command="{Binding ExportCashFlowCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding CashFlow}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Data" Binding="{Binding DateFormatted}" Width="120"/>
                                            <DataGridTextColumn Header="Entradas" Binding="{Binding Inflow, StringFormat='Kz {0:N2}'}" Width="*"/>
                                            <DataGridTextColumn Header="Saídas" Binding="{Binding Outflow, StringFormat='Kz {0:N2}'}" Width="*"/>
                                            <DataGridTextColumn Header="Saldo" Binding="{Binding Balance, StringFormat='Kz {0:N2}'}" Width="*"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>

                            <!-- Payment Methods Results -->
                            <Border Style="{StaticResource ReportCardStyle}"
                                   Visibility="{Binding PaymentMethods.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="CreditCard" Width="24" Height="24" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Formas de Pagamento" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <Button Content="Exportar" Command="{Binding ExportPaymentMethodsCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding PaymentMethods}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Forma de Pagamento" Binding="{Binding MethodName}" Width="*"/>
                                            <DataGridTextColumn Header="Transações" Binding="{Binding TransactionCount}" Width="120"/>
                                            <DataGridTextColumn Header="Valor Total" Binding="{Binding TotalValue, StringFormat='Kz {0:N2}'}" Width="150"/>
                                            <DataGridTextColumn Header="%" Binding="{Binding Percentage, StringFormat='{}{0:F1}%'}" Width="100"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>

                            <!-- Accounts Receivable Results -->
                            <Border Style="{StaticResource ReportCardStyle}"
                                   Visibility="{Binding AccountsReceivable.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="ClockAlert" Width="24" Height="24" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Contas a Receber" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <Button Content="Exportar" Command="{Binding ExportAccountsReceivableCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding AccountsReceivable}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Fatura" Binding="{Binding InvoiceNumber}" Width="120"/>
                                            <DataGridTextColumn Header="Cliente" Binding="{Binding CustomerName}" Width="*"/>
                                            <DataGridTextColumn Header="Vencimento" Binding="{Binding DueDate, StringFormat='dd/MM/yyyy'}" Width="120"/>
                                            <DataGridTextColumn Header="Total" Binding="{Binding TotalValue, StringFormat='Kz {0:N2}'}" Width="120"/>
                                            <DataGridTextColumn Header="Pendente" Binding="{Binding PendingValue, StringFormat='Kz {0:N2}'}" Width="120"/>
                                            <DataGridTextColumn Header="Dias" Binding="{Binding DaysOverdue}" Width="80"/>
                                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Stock Reports Tab -->
                <TabItem Header="Estoque">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Package" Width="20" Height="20" Margin="0,0,8,0"/>
                                <TextBlock Text="Estoque"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="16">
                            <!-- Stock Report Buttons -->
                            <UniformGrid Columns="3" Margin="0,0,0,24">
                                <Button Command="{Binding GenerateStockMovementsCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel HorizontalAlignment="Center">
                                        <materialDesign:PackIcon Kind="SwapHorizontal" Width="40" Height="40" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Movimentação" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0" TextAlignment="Center"/>
                                        <TextBlock Text="Histórico de movimentos" FontSize="11" Foreground="{DynamicResource MaterialDesignBodyLight}" TextAlignment="Center"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding GenerateLowStockCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel HorizontalAlignment="Center">
                                        <materialDesign:PackIcon Kind="AlertCircle" Width="40" Height="40" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Estoque Baixo" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0" TextAlignment="Center"/>
                                        <TextBlock Text="Produtos em falta" FontSize="11" Foreground="{DynamicResource MaterialDesignBodyLight}" TextAlignment="Center"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding GenerateExpiringProductsCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel HorizontalAlignment="Center">
                                        <materialDesign:PackIcon Kind="CalendarClock" Width="40" Height="40" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Produtos Vencendo" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0" TextAlignment="Center"/>
                                        <TextBlock Text="Validades próximas" FontSize="11" Foreground="{DynamicResource MaterialDesignBodyLight}" TextAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                            </UniformGrid>

                            <!-- Stock Movements Results -->
                            <Border Style="{StaticResource ReportCardStyle}"
                                   Visibility="{Binding StockMovements.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="SwapHorizontal" Width="24" Height="24" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Movimentação de Estoque" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <Button Content="Exportar" Command="{Binding ExportStockMovementsCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding StockMovements}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Data" Binding="{Binding DateFormatted}" Width="120"/>
                                            <DataGridTextColumn Header="Produto" Binding="{Binding ProductName}" Width="*"/>
                                            <DataGridTextColumn Header="Tipo" Binding="{Binding MovementType}" Width="100"/>
                                            <DataGridTextColumn Header="Quantidade" Binding="{Binding Quantity}" Width="100"/>
                                            <DataGridTextColumn Header="Saldo" Binding="{Binding Balance}" Width="100"/>
                                            <DataGridTextColumn Header="Motivo" Binding="{Binding Reason}" Width="*"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>

                            <!-- Low Stock Results -->
                            <Border Style="{StaticResource ReportCardStyle}"
                                   Visibility="{Binding LowStockProducts.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="AlertCircle" Width="24" Height="24" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Produtos com Estoque Baixo" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <Button Content="Exportar" Command="{Binding ExportLowStockCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding LowStockProducts}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Produto" Binding="{Binding ProductName}" Width="*"/>
                                            <DataGridTextColumn Header="Atual" Binding="{Binding CurrentQuantity}" Width="100"/>
                                            <DataGridTextColumn Header="Mínimo" Binding="{Binding MinimumQuantity}" Width="100"/>
                                            <DataGridTextColumn Header="Reposição" Binding="{Binding ReorderPoint}" Width="100"/>
                                            <DataGridTextColumn Header="Diferença" Binding="{Binding Difference}" Width="100"/>
                                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="120"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>

                            <!-- Expiring Products Results -->
                            <Border Style="{StaticResource ReportCardStyle}"
                                   Visibility="{Binding ExpiringProducts.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="CalendarClock" Width="24" Height="24" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Produtos Vencendo (Próximos 30 dias)" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <Button Content="Exportar" Command="{Binding ExportExpiringProductsCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding ExpiringProducts}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Produto" Binding="{Binding ProductName}" Width="*"/>
                                            <DataGridTextColumn Header="Lote" Binding="{Binding Batch}" Width="120"/>
                                            <DataGridTextColumn Header="Validade" Binding="{Binding ExpirationDateFormatted}" Width="120"/>
                                            <DataGridTextColumn Header="Dias" Binding="{Binding DaysToExpire}" Width="80"/>
                                            <DataGridTextColumn Header="Quantidade" Binding="{Binding Quantity}" Width="100"/>
                                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="150"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Management Reports Tab -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="ChartBox" Width="20" Height="20" Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <TextBlock Text="Gerencial" VerticalAlignment="Center"/>
                        </StackPanel>
                    </TabItem.Header>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="16">
                            
                            <!-- Header Section -->
                            <Border Style="{StaticResource ReportCardStyle}">
                                <Grid>
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="ChartMultiple" Width="32" Height="32" 
                                                                    Foreground="{DynamicResource PrimaryHueMidBrush}"
                                                                    VerticalAlignment="Center"
                                                                    Margin="0,0,12,0"/>
                                            <TextBlock Text="Dashboard Gerencial" 
                                                      FontSize="24" FontWeight="Bold"
                                                      VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <TextBlock Text="Visualizações gráficas e análises de desempenho do negócio"
                                                  FontSize="14" 
                                                  Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                  Margin="44,8,0,0"/>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- Sales Analytics Section -->
                            <TextBlock Text="📈 Análise de Vendas" FontSize="20" FontWeight="Bold" Margin="0,24,0,16"/>
                            
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="400"/>
                                    <RowDefinition Height="400"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Sales by Month Chart -->
                                <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource ReportCardStyle}" Margin="0,0,8,8">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                            <materialDesign:PackIcon Kind="ChartBar" Width="24" Height="24" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                            <StackPanel>
                                                <TextBlock Text="Vendas Mensais" FontSize="16" FontWeight="SemiBold"/>
                                                <TextBlock Text="Comparativo mensal de vendas" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <oxy:PlotView Model="{Binding SalesByMonthChart}" Height="320"/>
                                    </StackPanel>
                                </Border>

                                <!-- Sales Trend Chart -->
                                <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource ReportCardStyle}" Margin="8,0,0,8">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                            <materialDesign:PackIcon Kind="ChartLine" Width="24" Height="24" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                            <StackPanel>
                                                <TextBlock Text="Tendência de Vendas" FontSize="16" FontWeight="SemiBold"/>
                                                <TextBlock Text="Evolução temporal das vendas" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <oxy:PlotView Model="{Binding SalesTrendChart}" Height="320"/>
                                    </StackPanel>
                                </Border>

                                <!-- Top Products Chart -->
                                <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource ReportCardStyle}" Margin="0,8,8,0">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                            <materialDesign:PackIcon Kind="ChartBarStacked" Width="24" Height="24" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                            <StackPanel>
                                                <TextBlock Text="Top 10 Produtos" FontSize="16" FontWeight="SemiBold"/>
                                                <TextBlock Text="Produtos mais vendidos" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <oxy:PlotView Model="{Binding TopProductsChart}" Height="320"/>
                                    </StackPanel>
                                </Border>

                                <!-- Invoice Status Chart -->
                                <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource ReportCardStyle}"  Height="520" Margin="8,8,0,0">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                            <materialDesign:PackIcon Kind="ChartDonut" Width="24" Height="24" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                            <StackPanel>
                                                <TextBlock Text="Status das Faturas" FontSize="16" FontWeight="SemiBold"/>
                                                <TextBlock Text="Distribuição por status" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <oxy:PlotView Model="{Binding InvoiceStatusChart}" Height="320"/>
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <!-- Financial Analytics Section -->
                            <TextBlock Text="💰 Análise Financeira" FontSize="20" FontWeight="Bold" Margin="0,32,0,16"/>
                            
                            <!-- Payment Methods Chart -->
                            <Border Style="{StaticResource ReportCardStyle}">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                        <materialDesign:PackIcon Kind="ChartPie" Width="24" Height="24" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                        <StackPanel>
                                            <TextBlock Text="Formas de Pagamento" FontSize="16" FontWeight="SemiBold"/>
                                            <TextBlock Text="Distribuição de métodos de pagamento utilizados" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                        </StackPanel>
                                    </StackPanel>
                                    <oxy:PlotView Model="{Binding PaymentMethodsChart}" Height="400"/>
                                </StackPanel>
                            </Border>

                            <!-- Insights Section -->
                            <Border Style="{StaticResource ReportCardStyle}" Margin="0,24,0,0">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                        <materialDesign:PackIcon Kind="Lightbulb" Width="24" Height="24" 
                                                                Foreground="#FFA500"
                                                                VerticalAlignment="Center"
                                                                Margin="0,0,12,0"/>
                                        <TextBlock Text="Insights e Recomendações" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                            <Border Background="#E8F5E9" CornerRadius="8" Padding="16" Margin="0,0,0,12">
                                                <StackPanel>
                                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                        <materialDesign:PackIcon Kind="TrendingUp" Foreground="#4CAF50" Width="20" Height="20" Margin="0,0,8,0"/>
                                                        <TextBlock Text="Desempenho" FontWeight="SemiBold" Foreground="#4CAF50"/>
                                                    </StackPanel>
                                                    <TextBlock Text="Utilize os gráficos para identificar tendências e padrões de vendas ao longo do tempo."
                                                              TextWrapping="Wrap"
                                                              FontSize="13"
                                                              Foreground="#1B5E20"/>
                                                </StackPanel>
                                            </Border>
                                            
                                            <Border Background="#FFF3E0" CornerRadius="8" Padding="16">
                                                <StackPanel>
                                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                        <materialDesign:PackIcon Kind="Information" Foreground="#FF9800" Width="20" Height="20" Margin="0,0,8,0"/>
                                                        <TextBlock Text="Produtos" FontWeight="SemiBold" Foreground="#FF9800"/>
                                                    </StackPanel>
                                                    <TextBlock Text="Foque nos produtos mais vendidos e considere estratégias de marketing para itens com baixo desempenho."
                                                              TextWrapping="Wrap"
                                                              FontSize="13"
                                                              Foreground="#E65100"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                            <Border Background="#E3F2FD" CornerRadius="8" Padding="16" Margin="0,0,0,12">
                                                <StackPanel>
                                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                        <materialDesign:PackIcon Kind="CashMultiple" Foreground="#2196F3" Width="20" Height="20" Margin="0,0,8,0"/>
                                                        <TextBlock Text="Pagamentos" FontWeight="SemiBold" Foreground="#2196F3"/>
                                                    </StackPanel>
                                                    <TextBlock Text="Analise as formas de pagamento preferidas pelos clientes para otimizar as opções oferecidas."
                                                              TextWrapping="Wrap"
                                                              FontSize="13"
                                                              Foreground="#0D47A1"/>
                                                </StackPanel>
                                            </Border>
                                            
                                            <Border Background="#FCE4EC" CornerRadius="8" Padding="16">
                                                <StackPanel>
                                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                        <materialDesign:PackIcon Kind="ChartTimeline" Foreground="#E91E63" Width="20" Height="20" Margin="0,0,8,0"/>
                                                        <TextBlock Text="Previsões" FontWeight="SemiBold" Foreground="#E91E63"/>
                                                    </StackPanel>
                                                    <TextBlock Text="Use os dados históricos para fazer previsões e planejar estoques e promoções futuras."
                                                              TextWrapping="Wrap"
                                                              FontSize="13"
                                                              Foreground="#880E4F"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
            </TabControl>
            </Grid>
        </ScrollViewer>

        <!-- Snackbar for Messages -->
        <materialDesign:Snackbar MessageQueue="{Binding MessageQueue}"
                                VerticalAlignment="Bottom"
                                HorizontalAlignment="Stretch"
                                Margin="20"/>
    </Grid>
</Page>
