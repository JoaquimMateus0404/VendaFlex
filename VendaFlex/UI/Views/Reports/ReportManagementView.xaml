<Page x:Class="VendaFlex.UI.Views.Reports.ReportManagementView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:local="clr-namespace:VendaFlex.UI.Views.Reports"
      xmlns:vm="clr-namespace:VendaFlex.ViewModels.Reports"
      xmlns:infconv="clr-namespace:VendaFlex.Infrastructure.Converters"
      mc:Ignorable="d"
      d:DesignHeight="800" d:DesignWidth="1400"
      Background="{DynamicResource MaterialDesignPaper}"
      Title="RelatÃ³rios">

    <Page.Resources>

        <infconv:CountToVisibilityConverter x:Key="CountToVisibilityConverter"/>
        <infconv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

        <!-- Card Style -->
        <Style x:Key="ReportCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.1" Color="Black"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Report Button Style -->
        <Style x:Key="ReportButtonStyle" TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}">
            <Setter Property="Height" Value="120"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryHueMidBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryHueMidBrush}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="materialDesign:ButtonAssist.CornerRadius" Value="12"/>
            <Setter Property="materialDesign:ElevationAssist.Elevation" Value="Dp2"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <!-- Stat Card Style -->
        <Style x:Key="StatCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource PrimaryHueLightBrush}"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.15" Color="Black"/>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid>
        <!-- Loading Overlay -->
        <Border Background="#80000000" Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                Panel.ZIndex="1000">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                             Value="0" IsIndeterminate="True"
                             Width="60" Height="60"/>
                <TextBlock Text="Carregando..." Foreground="White" 
                          FontSize="16" Margin="0,16,0,0" 
                          HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <Grid Margin="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- Header -->
                <RowDefinition Height="Auto"/>
                <!-- Statistics -->
                <RowDefinition Height="Auto"/>
                <!-- Filters -->
                <RowDefinition Height="*"/>
                <!-- Content -->
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Margin="0,0,0,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="ðŸ“Š RelatÃ³rios" FontSize="32" FontWeight="Bold"
                              Foreground="{DynamicResource PrimaryHueDarkBrush}"/>
                    <TextBlock Text="AnÃ¡lises e indicadores do sistema" FontSize="14"
                              Foreground="{DynamicResource MaterialDesignBodyLight}"
                              Margin="0,4,0,0"/>
                </StackPanel>

                <!-- Quick Actions -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Content="Hoje" Command="{Binding QuickPeriodTodayCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Margin="4,0"/>
                    <Button Content="Semana" Command="{Binding QuickPeriodWeekCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Margin="4,0"/>
                    <Button Content="MÃªs" Command="{Binding QuickPeriodMonthCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Margin="4,0"/>
                    <Button Content="Ano" Command="{Binding QuickPeriodYearCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Margin="4,0"/>
                </StackPanel>
            </Grid>

            <!-- Statistics Cards -->
            <Grid Grid.Row="1" Margin="0,0,0,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Total Sales -->
                <Border Grid.Column="0" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <materialDesign:PackIcon Kind="CurrencyUsd" Width="32" Height="32"
                                                Foreground="{DynamicResource PrimaryHueDarkBrush}"/>
                        <TextBlock Text="Vendas Totais" FontSize="14" Margin="0,8,0,4"
                                  Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        <TextBlock Text="{Binding TotalSalesValue, StringFormat='Kz {0:N2}'}"
                                  FontSize="24" FontWeight="Bold"
                                  Foreground="{DynamicResource PrimaryHueDarkBrush}"/>
                    </StackPanel>
                </Border>

                <!-- Total Invoices -->
                <Border Grid.Column="1" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <materialDesign:PackIcon Kind="Receipt" Width="32" Height="32"
                                                Foreground="{DynamicResource PrimaryHueDarkBrush}"/>
                        <TextBlock Text="Faturas" FontSize="14" Margin="0,8,0,4"
                                  Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        <TextBlock Text="{Binding TotalInvoices}"
                                  FontSize="24" FontWeight="Bold"
                                  Foreground="{DynamicResource PrimaryHueDarkBrush}"/>
                    </StackPanel>
                </Border>

                <!-- Revenue -->
                <Border Grid.Column="2" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <materialDesign:PackIcon Kind="Cash" Width="32" Height="32"
                                                Foreground="{DynamicResource PrimaryHueDarkBrush}"/>
                        <TextBlock Text="Receita" FontSize="14" Margin="0,8,0,4"
                                  Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        <TextBlock Text="{Binding TotalRevenue, StringFormat='Kz {0:N2}'}"
                                  FontSize="24" FontWeight="Bold"
                                  Foreground="{DynamicResource PrimaryHueDarkBrush}"/>
                    </StackPanel>
                </Border>

                <!-- Stock Value -->
                <Border Grid.Column="3" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <materialDesign:PackIcon Kind="Package" Width="32" Height="32"
                                                Foreground="{DynamicResource PrimaryHueDarkBrush}"/>
                        <TextBlock Text="Valor do Estoque" FontSize="14" Margin="0,8,0,4"
                                  Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        <TextBlock Text="{Binding TotalStockValue, StringFormat='Kz {0:N2}'}"
                                  FontSize="24" FontWeight="Bold"
                                  Foreground="{DynamicResource PrimaryHueDarkBrush}"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Date Filter -->
            <Border Grid.Row="2" Style="{StaticResource ReportCardStyle}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="PerÃ­odo:" VerticalAlignment="Center"
                              FontWeight="SemiBold" Margin="0,0,16,0"/>

                    <DatePicker Grid.Column="1" 
                               materialDesign:HintAssist.Hint="Data Inicial"
                               SelectedDate="{Binding StartDate}"
                               Margin="0,0,16,0"/>

                    <TextBlock Grid.Column="2" Text="atÃ©" VerticalAlignment="Center"
                              Margin="0,0,16,0"/>

                    <DatePicker Grid.Column="3"
                               materialDesign:HintAssist.Hint="Data Final"
                               SelectedDate="{Binding EndDate}"
                               Margin="0,0,16,0"/>
                </Grid>
            </Border>

            <!-- Main Content -->
            <TabControl Grid.Row="3" 
                       SelectedIndex="{Binding SelectedCategoryIndex}"
                       Style="{StaticResource MaterialDesignFilledTabControl}">

                <!-- Sales Reports Tab -->
                <TabItem Header="Vendas">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="ChartLine" Width="20" Height="20" Margin="0,0,8,0"/>
                                <TextBlock Text="Vendas"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="16">
                            <!-- Report Buttons -->
                            <UniformGrid Columns="3" Margin="0,0,0,24">
                                <Button Command="{Binding GenerateSalesByPeriodCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel>
                                        <materialDesign:PackIcon Kind="CalendarRange" Width="40" Height="40"/>
                                        <TextBlock Text="Vendas por PerÃ­odo" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0"/>
                                        <TextBlock Text="AnÃ¡lise diÃ¡ria das vendas" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding GenerateTopProductsCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel>
                                        <materialDesign:PackIcon Kind="TrophyVariant" Width="40" Height="40"/>
                                        <TextBlock Text="Top Produtos" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0"/>
                                        <TextBlock Text="Produtos mais vendidos" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding GenerateSalesByCustomerCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel>
                                        <materialDesign:PackIcon Kind="AccountGroup" Width="40" Height="40"/>
                                        <TextBlock Text="Vendas por Cliente" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0"/>
                                        <TextBlock Text="AnÃ¡lise por cliente" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                </Button>
                            </UniformGrid>

                            <!-- Sales by Period Results -->
                            <Border Style="{StaticResource ReportCardStyle}" 
                                   Visibility="{Binding SalesByPeriod.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <TextBlock Text="Vendas por PerÃ­odo" FontSize="18" FontWeight="SemiBold"/>
                                        <Button Content="Exportar" Command="{Binding ExportSalesByPeriodCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding SalesByPeriod}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Data" Binding="{Binding DateFormatted}" Width="120"/>
                                            <DataGridTextColumn Header="Faturas" Binding="{Binding InvoiceCount}" Width="100"/>
                                            <DataGridTextColumn Header="Total" Binding="{Binding TotalValue, StringFormat='Kz {0:N2}'}" Width="*"/>
                                            <DataGridTextColumn Header="Pago" Binding="{Binding PaidValue, StringFormat='Kz {0:N2}'}" Width="*"/>
                                            <DataGridTextColumn Header="Pendente" Binding="{Binding PendingValue, StringFormat='Kz {0:N2}'}" Width="*"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>

                            <!-- Top Products Results -->
                            <Border Style="{StaticResource ReportCardStyle}"
                                   Visibility="{Binding TopProducts.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <TextBlock Text="Top 20 Produtos Mais Vendidos" FontSize="18" FontWeight="SemiBold"/>
                                        <Button Content="Exportar" Command="{Binding ExportTopProductsCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding TopProducts}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Produto" Binding="{Binding ProductName}" Width="*"/>
                                            <DataGridTextColumn Header="Quantidade" Binding="{Binding QuantitySold, StringFormat='{}{0:N0}'}" Width="120"/>
                                            <DataGridTextColumn Header="Valor Total" Binding="{Binding TotalValue, StringFormat='Kz {0:N2}'}" Width="150"/>
                                            <DataGridTextColumn Header="PreÃ§o MÃ©dio" Binding="{Binding AveragePrice, StringFormat='Kz {0:N2}'}" Width="150"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>

                            <!-- Sales by Customer Results -->
                            <Border Style="{StaticResource ReportCardStyle}"
                                   Visibility="{Binding SalesByCustomer.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <TextBlock Text="Vendas por Cliente" FontSize="18" FontWeight="SemiBold"/>
                                        <Button Content="Exportar" Command="{Binding ExportSalesByCustomerCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding SalesByCustomer}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Cliente" Binding="{Binding CustomerName}" Width="*"/>
                                            <DataGridTextColumn Header="Faturas" Binding="{Binding InvoiceCount}" Width="100"/>
                                            <DataGridTextColumn Header="Total" Binding="{Binding TotalValue, StringFormat='Kz {0:N2}'}" Width="150"/>
                                            <DataGridTextColumn Header="Pago" Binding="{Binding PaidValue, StringFormat='Kz {0:N2}'}" Width="150"/>
                                            <DataGridTextColumn Header="Pendente" Binding="{Binding PendingValue, StringFormat='Kz {0:N2}'}" Width="150"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Financial Reports Tab -->
                <TabItem Header="Financeiro">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Cash" Width="20" Height="20" Margin="0,0,8,0"/>
                                <TextBlock Text="Financeiro"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="16">
                            <!-- Financial Report Buttons -->
                            <UniformGrid Columns="3" Margin="0,0,0,24">
                                <Button Command="{Binding GenerateCashFlowCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel>
                                        <materialDesign:PackIcon Kind="ChartAreaspline" Width="40" Height="40"/>
                                        <TextBlock Text="Fluxo de Caixa" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0"/>
                                        <TextBlock Text="Entradas e saÃ­das" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding GeneratePaymentMethodsCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel>
                                        <materialDesign:PackIcon Kind="CreditCard" Width="40" Height="40"/>
                                        <TextBlock Text="Formas de Pagamento" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0"/>
                                        <TextBlock Text="AnÃ¡lise de pagamentos" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding GenerateAccountsReceivableCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel>
                                        <materialDesign:PackIcon Kind="ClockAlert" Width="40" Height="40"/>
                                        <TextBlock Text="Contas a Receber" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0"/>
                                        <TextBlock Text="Faturas pendentes" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                </Button>
                            </UniformGrid>

                            <!-- Cash Flow Results -->
                            <Border Style="{StaticResource ReportCardStyle}"
                                   Visibility="{Binding CashFlow.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <TextBlock Text="Fluxo de Caixa" FontSize="18" FontWeight="SemiBold"/>
                                        <Button Content="Exportar" Command="{Binding ExportCashFlowCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding CashFlow}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Data" Binding="{Binding DateFormatted}" Width="120"/>
                                            <DataGridTextColumn Header="Entradas" Binding="{Binding Inflow, StringFormat='Kz {0:N2}'}" Width="*"/>
                                            <DataGridTextColumn Header="SaÃ­das" Binding="{Binding Outflow, StringFormat='Kz {0:N2}'}" Width="*"/>
                                            <DataGridTextColumn Header="Saldo" Binding="{Binding Balance, StringFormat='Kz {0:N2}'}" Width="*"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>

                            <!-- Payment Methods Results -->
                            <Border Style="{StaticResource ReportCardStyle}"
                                   Visibility="{Binding PaymentMethods.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <TextBlock Text="Formas de Pagamento" FontSize="18" FontWeight="SemiBold"/>
                                        <Button Content="Exportar" Command="{Binding ExportPaymentMethodsCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding PaymentMethods}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Forma de Pagamento" Binding="{Binding MethodName}" Width="*"/>
                                            <DataGridTextColumn Header="TransaÃ§Ãµes" Binding="{Binding TransactionCount}" Width="120"/>
                                            <DataGridTextColumn Header="Valor Total" Binding="{Binding TotalValue, StringFormat='Kz {0:N2}'}" Width="150"/>
                                            <DataGridTextColumn Header="%" Binding="{Binding Percentage, StringFormat='{}{0:F1}%'}" Width="100"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>

                            <!-- Accounts Receivable Results -->
                            <Border Style="{StaticResource ReportCardStyle}"
                                   Visibility="{Binding AccountsReceivable.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <TextBlock Text="Contas a Receber" FontSize="18" FontWeight="SemiBold"/>
                                        <Button Content="Exportar" Command="{Binding ExportAccountsReceivableCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding AccountsReceivable}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Fatura" Binding="{Binding InvoiceNumber}" Width="120"/>
                                            <DataGridTextColumn Header="Cliente" Binding="{Binding CustomerName}" Width="*"/>
                                            <DataGridTextColumn Header="Vencimento" Binding="{Binding DueDate, StringFormat='dd/MM/yyyy'}" Width="120"/>
                                            <DataGridTextColumn Header="Total" Binding="{Binding TotalValue, StringFormat='Kz {0:N2}'}" Width="120"/>
                                            <DataGridTextColumn Header="Pendente" Binding="{Binding PendingValue, StringFormat='Kz {0:N2}'}" Width="120"/>
                                            <DataGridTextColumn Header="Dias" Binding="{Binding DaysOverdue}" Width="80"/>
                                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Stock Reports Tab -->
                <TabItem Header="Estoque">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Package" Width="20" Height="20" Margin="0,0,8,0"/>
                                <TextBlock Text="Estoque"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="16">
                            <!-- Stock Report Buttons -->
                            <UniformGrid Columns="3" Margin="0,0,0,24">
                                <Button Command="{Binding GenerateStockMovementsCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel>
                                        <materialDesign:PackIcon Kind="SwapHorizontal" Width="40" Height="40"/>
                                        <TextBlock Text="MovimentaÃ§Ã£o" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0"/>
                                        <TextBlock Text="HistÃ³rico de movimentos" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding GenerateLowStockCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel>
                                        <materialDesign:PackIcon Kind="AlertCircle" Width="40" Height="40"/>
                                        <TextBlock Text="Estoque Baixo" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0"/>
                                        <TextBlock Text="Produtos em falta" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding GenerateExpiringProductsCommand}" Style="{StaticResource ReportButtonStyle}">
                                    <StackPanel>
                                        <materialDesign:PackIcon Kind="CalendarClock" Width="40" Height="40"/>
                                        <TextBlock Text="Produtos Vencendo" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,0"/>
                                        <TextBlock Text="Validades prÃ³ximas" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                </Button>
                            </UniformGrid>

                            <!-- Low Stock Results -->
                            <Border Style="{StaticResource ReportCardStyle}"
                                   Visibility="{Binding LowStockProducts.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <TextBlock Text="Produtos com Estoque Baixo" FontSize="18" FontWeight="SemiBold"/>
                                        <Button Content="Exportar" Command="{Binding ExportLowStockCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding LowStockProducts}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Produto" Binding="{Binding ProductName}" Width="*"/>
                                            <DataGridTextColumn Header="Atual" Binding="{Binding CurrentQuantity}" Width="100"/>
                                            <DataGridTextColumn Header="MÃ­nimo" Binding="{Binding MinimumQuantity}" Width="100"/>
                                            <DataGridTextColumn Header="ReposiÃ§Ã£o" Binding="{Binding ReorderPoint}" Width="100"/>
                                            <DataGridTextColumn Header="DiferenÃ§a" Binding="{Binding Difference}" Width="100"/>
                                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="120"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>

                            <!-- Expiring Products Results -->
                            <Border Style="{StaticResource ReportCardStyle}"
                                   Visibility="{Binding ExpiringProducts.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                <StackPanel>
                                    <Grid Margin="0,0,0,16">
                                        <TextBlock Text="Produtos Vencendo (PrÃ³ximos 30 dias)" FontSize="18" FontWeight="SemiBold"/>
                                        <Button Content="Exportar" Command="{Binding ExportExpiringProductsCommand}"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Right"/>
                                    </Grid>

                                    <DataGrid ItemsSource="{Binding ExpiringProducts}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             IsReadOnly="True"
                                             Style="{StaticResource MaterialDesignDataGrid}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Produto" Binding="{Binding ProductName}" Width="*"/>
                                            <DataGridTextColumn Header="Lote" Binding="{Binding Batch}" Width="120"/>
                                            <DataGridTextColumn Header="Validade" Binding="{Binding ExpirationDateFormatted}" Width="120"/>
                                            <DataGridTextColumn Header="Dias" Binding="{Binding DaysToExpire}" Width="80"/>
                                            <DataGridTextColumn Header="Quantidade" Binding="{Binding Quantity}" Width="100"/>
                                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="150"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Management Reports Tab -->
                <TabItem Header="Gerencial">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="ChartBox" Width="20" Height="20" Margin="0,0,8,0"/>
                                <TextBlock Text="Gerencial"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="16">
                            <TextBlock Text="RelatÃ³rios Gerenciais" FontSize="24" FontWeight="Bold" Margin="0,0,0,16"/>
                            <TextBlock Text="Dashboards executivos e anÃ¡lises avanÃ§adas em desenvolvimento..."
                                      FontSize="14" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
            </TabControl>
        </Grid>

        <!-- Snackbar for Messages -->
        <materialDesign:Snackbar MessageQueue="{Binding MessageQueue}"
                                VerticalAlignment="Bottom"
                                HorizontalAlignment="Stretch"/>
    </Grid>
</Page>
