<Page x:Class="VendaFlex.UI.Views.Products.ProductManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:VendaFlex.Infrastructure.Converters"
             xmlns:entities="clr-namespace:VendaFlex.Data.Entities"
             xmlns:system="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1400"
             Background="{DynamicResource MaterialDesignPaper}">

    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <materialDesign:BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:StringToImageSourceConverter x:Key="StringToImageSourceConverter"/>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
        <converters:BoolToStringConverter x:Key="BoolToStringConverter"/>
        <converters:BoolToIconConverter x:Key="BoolToIconConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <converters:GreaterThanZeroToVisibilityConverter x:Key="GreaterThanZeroToVisibilityConverter"/>
        <converters:ProductStatusToColorConverter x:Key="ProductStatusToColorConverter"/>
        <converters:ProductStatusToStringConverter x:Key="ProductStatusToStringConverter"/>
        <converters:DaysFromNowConverter x:Key="DaysFromNowConverter"/>

        <!-- Product Status to String Converter -->
        <converters:EnumToStringConverter x:Key="ProductStatusConverter"/>
        
        <!-- Movement Type to Color Converter -->
        <converters:EnumToStringConverter x:Key="MovementTypeConverter"/>

        <Style x:Key="StatCardStyle" TargetType="materialDesign:Card">
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="UniformCornerRadius" Value="8"/>
        </Style>

        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock" BasedOn="{StaticResource MaterialDesignHeadline6TextBlock}">
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
    </Page.Resources>

    <Grid>
        <!-- Loading Overlay -->
        <Grid Background="#AA000000" 
              Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
              Panel.ZIndex="1000">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                             Value="0"
                             IsIndeterminate="True"
                             Width="60" Height="60"/>
                <TextBlock Text="Carregando..." 
                           Foreground="White"
                           Margin="0,16,0,0"
                           FontSize="16"/>
            </StackPanel>
        </Grid>

        <!-- Main Content -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <materialDesign:Card Grid.Row="0" Margin="0,0,0,8" Padding="16" UniformCornerRadius="0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Gerenciamento de Produtos" 
                                   Style="{StaticResource MaterialDesignHeadline4TextBlock}"/>
                        <TextBlock Text="Gerencie produtos, categorias, estoque e movimentações" 
                                   Style="{StaticResource MaterialDesignBody2TextBlock}"
                                   Foreground="{DynamicResource MaterialDesignBodyLight}"
                                   Margin="0,4,0,0"/>
                    </StackPanel>

                    <Button Grid.Column="1"
                            Style="{StaticResource MaterialDesignFloatingActionButton}"
                            Command="{Binding RefreshCommand}"
                            ToolTip="Atualizar">
                        <materialDesign:PackIcon Kind="Refresh" Width="24" Height="24"/>
                    </Button>
                </Grid>
            </materialDesign:Card>

            <!-- Statistics Cards with Gradients -->
            <Grid Grid.Row="0" Margin="0,80,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Total Products Card -->
                <Border Grid.Column="0" CornerRadius="12" Padding="20" Margin="6">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#667eea" Offset="0"/>
                            <GradientStop Color="#764ba2" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="12" ShadowDepth="2" Opacity="0.15" Color="Black"/>
                    </Border.Effect>
                    <StackPanel>
                        <materialDesign:PackIcon Kind="Package" Width="36" Height="36" 
                                                Foreground="White" Opacity="0.9"/>
                        <TextBlock Text="Total de Produtos" FontSize="13" Margin="0,12,0,4"
                                  Foreground="White" Opacity="0.85"/>
                        <TextBlock Text="{Binding TotalProducts}"
                                  FontSize="32" FontWeight="Bold"
                                  Foreground="White"/>
                    </StackPanel>
                </Border>

                <!-- Active Products Card -->
                <Border Grid.Column="1" CornerRadius="12" Padding="20" Margin="6">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#43e97b" Offset="0"/>
                            <GradientStop Color="#38f9d7" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="12" ShadowDepth="2" Opacity="0.15" Color="Black"/>
                    </Border.Effect>
                    <StackPanel>
                        <materialDesign:PackIcon Kind="CheckCircle" Width="36" Height="36" 
                                                Foreground="White" Opacity="0.9"/>
                        <TextBlock Text="Produtos Ativos" FontSize="13" Margin="0,12,0,4"
                                  Foreground="White" Opacity="0.85"/>
                        <TextBlock Text="{Binding ActiveProducts}"
                                  FontSize="32" FontWeight="Bold"
                                  Foreground="White"/>
                    </StackPanel>
                </Border>

                <!-- Stock Value Card -->
                <Border Grid.Column="2" CornerRadius="12" Padding="20" Margin="6">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#4facfe" Offset="0"/>
                            <GradientStop Color="#00f2fe" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="12" ShadowDepth="2" Opacity="0.15" Color="Black"/>
                    </Border.Effect>
                    <StackPanel>
                        <materialDesign:PackIcon Kind="CurrencyUsd" Width="36" Height="36" 
                                                Foreground="White" Opacity="0.9"/>
                        <TextBlock Text="Valor em Estoque" FontSize="13" Margin="0,12,0,4"
                                  Foreground="White" Opacity="0.85"/>
                        <TextBlock Text="{Binding TotalStockValue, StringFormat='Kz {0:N2}'}"
                                  FontSize="28" FontWeight="Bold"
                                  Foreground="White"/>
                    </StackPanel>
                </Border>

                <!-- Low Stock Card -->
                <Border Grid.Column="3" CornerRadius="12" Padding="20" Margin="6">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#f093fb" Offset="0"/>
                            <GradientStop Color="#f5576c" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="12" ShadowDepth="2" Opacity="0.15" Color="Black"/>
                    </Border.Effect>
                    <StackPanel>
                        <materialDesign:PackIcon Kind="AlertCircle" Width="36" Height="36" 
                                                Foreground="White" Opacity="0.9"/>
                        <TextBlock Text="Estoque Baixo" FontSize="13" Margin="0,12,0,4"
                                  Foreground="White" Opacity="0.85"/>
                        <TextBlock Text="{Binding LowStockCount}"
                                  FontSize="32" FontWeight="Bold"
                                  Foreground="White"/>
                    </StackPanel>
                </Border>

                <!-- Near Expiration Card -->
                <Border Grid.Column="4" CornerRadius="12" Padding="20" Margin="6">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#fa709a" Offset="0"/>
                            <GradientStop Color="#fee140" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="12" ShadowDepth="2" Opacity="0.15" Color="Black"/>
                    </Border.Effect>
                    <StackPanel>
                        <materialDesign:PackIcon Kind="CalendarAlert" Width="36" Height="36" 
                                                Foreground="White" Opacity="0.9"/>
                        <TextBlock Text="Próximo ao Vencimento" FontSize="13" Margin="0,12,0,4"
                                  Foreground="White" Opacity="0.85"/>
                        <TextBlock Text="{Binding NearExpirationCount}"
                                  FontSize="32" FontWeight="Bold"
                                  Foreground="White"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Tab Control -->
            <TabControl Grid.Row="1" 
                        Style="{StaticResource MaterialDesignNavigationRailTabControl}"
                        TabStripPlacement="Left"
                        Margin="0,0,0,8">

                <!-- Products Tab -->
                <TabItem Header="Produtos" MinWidth="180">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="16,12">
                                <materialDesign:PackIcon Kind="Package" 
                                                         Width="24" Height="24"
                                                         VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding}" 
                                           Margin="12,0,0,0"
                                           VerticalAlignment="Center"
                                           FontSize="14"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Filters and Actions -->
                        <materialDesign:Card Grid.Row="0" Padding="16" Margin="0,0,0,16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Search and Add Button -->
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBox Grid.Column="0"
                                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                             materialDesign:HintAssist.Hint="Buscar por nome, código de barras ou SKU..."
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             Margin="0,0,16,0" >
                                        <TextBox.InputBindings>
                                            <KeyBinding Key="Escape" Command="{Binding ClearFiltersCommand}"/>
                                        </TextBox.InputBindings>
                                    </TextBox>

                                    <Button Grid.Column="1"
                                            Command="{Binding ExportProductsCommand}"
                                            Style="{StaticResource MaterialDesignOutlinedButton}"
                                            Height="40"
                                            Margin="0,0,8,0"
                                            ToolTip="Exportar Produtos">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="FileExport" 
                                                                     VerticalAlignment="Center"
                                                                     Margin="0,0,8,0"/>
                                            <TextBlock Text="Exportar" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>

                                    <Button Grid.Column="2"
                                            Command="{Binding AddProductCommand}"
                                            Style="{StaticResource MaterialDesignRaisedButton}"
                                            Height="40">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="Plus" 
                                                                     VerticalAlignment="Center"
                                                                     Margin="0,0,8,0"/>
                                            <TextBlock Text="Novo Produto" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </Grid>

                                <!-- Filters -->
                                <Grid Grid.Row="1" Margin="0,16,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="Categoria:" 
                                               VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <ComboBox Grid.Column="1"
                                              ItemsSource="{Binding Categories}"
                                              SelectedItem="{Binding SelectedCategory}"
                                              DisplayMemberPath="Name"
                                              materialDesign:HintAssist.Hint="Todas"
                                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                              Margin="0,0,24,0"/>

                                    <TextBlock Grid.Column="2" Text="Status:" 
                                               VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <ComboBox Grid.Column="3"
                                              SelectedItem="{Binding FilterStatus}"
                                              materialDesign:HintAssist.Hint="Todos"
                                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                              Margin="0,0,24,0">
                                        <entities:ProductStatus>Active</entities:ProductStatus>
                                        <entities:ProductStatus>Inactive</entities:ProductStatus>
                                        <entities:ProductStatus>Discontinued</entities:ProductStatus>
                                        <entities:ProductStatus>OutOfStock</entities:ProductStatus>
                                    </ComboBox>

                                    <CheckBox Grid.Column="4" 
                                              Content="Estoque Baixo"
                                              IsChecked="{Binding FilterLowStock}"
                                              Margin="0,0,16,0"/>

                                    <CheckBox Grid.Column="5" 
                                              Content="Em Destaque"
                                              IsChecked="{Binding FilterFeatured}"
                                              Margin="0,0,16,0"/>

                                    <Button Grid.Column="7"
                                            Command="{Binding ClearFiltersCommand}"
                                            Style="{StaticResource MaterialDesignFlatButton}"
                                            Content="Limpar Filtros"/>
                                </Grid>
                            </Grid>
                        </materialDesign:Card>

                        <!-- Products DataGrid -->
                        <materialDesign:Card Grid.Row="1">
                            <DataGrid ItemsSource="{Binding FilteredProducts}"
                                      SelectedItem="{Binding SelectedProduct}"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      IsReadOnly="False"
                                      SelectionMode="Single"
                                      materialDesign:DataGridAssist.CellPadding="8"
                                      materialDesign:DataGridAssist.ColumnHeaderPadding="8">
                                <DataGrid.Columns>
                                    <DataGridTemplateColumn Header="Foto" Width="80" IsReadOnly="True">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Border Width="50" Height="50" 
                                                        Background="{DynamicResource MaterialDesignDivider}"
                                                        CornerRadius="4">
                                                    <Image Source="{Binding PhotoUrl}" 
                                                           Stretch="UniformToFill"/>
                                                </Border>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>

                                    <DataGridTextColumn Header="Código" 
                                                        Binding="{Binding Code}" 
                                                        Width="100"
                                                        IsReadOnly="True"/>

                                    <DataGridTextColumn Header="Nome" 
                                                        Binding="{Binding Name}" 
                                                        Width="*"
                                                        MinWidth="200"
                                                        IsReadOnly="True"/>

                                    <DataGridTextColumn Header="Categoria" 
                                                        Binding="{Binding CategoryName}" 
                                                        Width="150"
                                                        IsReadOnly="True"/>

                                    <DataGridTextColumn Header="SKU" 
                                                        Binding="{Binding SKU}" 
                                                        Width="120"
                                                        IsReadOnly="True"/>

                                    <DataGridTextColumn Header="Código de Barras" 
                                                        Binding="{Binding Barcode}" 
                                                        Width="140"
                                                        IsReadOnly="True"/>

                                    <DataGridTextColumn Header="Preço de Custo" 
                                                        Binding="{Binding CostPrice, StringFormat=C2}" 
                                                        Width="120"
                                                        IsReadOnly="True"/>

                                    <DataGridTextColumn Header="Preço de Venda" 
                                                        Binding="{Binding SalePrice, StringFormat=C2}" 
                                                        Width="120"
                                                        IsReadOnly="True"/>

                                    <DataGridTextColumn Header="Estoque" 
                                                        Binding="{Binding CurrentStock}" 
                                                        Width="80"
                                                        IsReadOnly="True"/>

                                    <DataGridTemplateColumn Header="Status" Width="150">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Border Background="{Binding Status, Converter={StaticResource ProductStatusToColorConverter}}"
                                                        CornerRadius="12" Padding="8,4">
                                                    <TextBlock Text="{Binding Status, Converter={StaticResource ProductStatusToStringConverter}}" 
                                                               Foreground="White"
                                                               HorizontalAlignment="Center"
                                                               FontSize="11"
                                                               FontWeight="Bold"/>
                                                </Border>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                        <DataGridTemplateColumn.CellEditingTemplate>
                                            <DataTemplate>
                                                <ComboBox SelectedItem="{Binding Status, UpdateSourceTrigger=PropertyChanged}"
                                                          materialDesign:HintAssist.IsFloating="False">
                                                    <entities:ProductStatus>Active</entities:ProductStatus>
                                                    <entities:ProductStatus>Inactive</entities:ProductStatus>
                                                    <entities:ProductStatus>Discontinued</entities:ProductStatus>
                                                    <entities:ProductStatus>OutOfStock</entities:ProductStatus>
                                                </ComboBox>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellEditingTemplate>
                                    </DataGridTemplateColumn>

                                    <DataGridTemplateColumn Header="Ações" Width="150" IsReadOnly="True">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <Button Command="{Binding DataContext.EditProductCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            CommandParameter="{Binding}"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            ToolTip="Editar">
                                                        <materialDesign:PackIcon Kind="Pencil"/>
                                                    </Button>
                                                    <Button Command="{Binding DataContext.DeleteProductCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            CommandParameter="{Binding}"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            ToolTip="Excluir"
                                                            Foreground="{DynamicResource ValidationErrorBrush}">
                                                        <materialDesign:PackIcon Kind="Delete"/>
                                                    </Button>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </materialDesign:Card>

                        <!-- Pagination -->
                        <materialDesign:Card Grid.Row="2" Padding="16" Margin="0,8,0,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Info -->
                                <TextBlock Grid.Column="0" VerticalAlignment="Center">
                                    <Run Text="Mostrando"/>
                                    <Run Text="{Binding FilteredProducts.Count, Mode=OneWay}" FontWeight="Bold"/>
                                    <Run Text="de"/>
                                    <Run Text="{Binding TotalRecords, Mode=OneWay}" FontWeight="Bold"/>
                                    <Run Text="registros"/>
                                </TextBlock>

                                <!-- Navigation -->
                                <StackPanel Grid.Column="2" Orientation="Horizontal">
                                    <Button Command="{Binding FirstPageCommand}"
                                            Style="{StaticResource MaterialDesignIconButton}"
                                            ToolTip="Primeira Página">
                                        <materialDesign:PackIcon Kind="PageFirst"/>
                                    </Button>

                                    <Button Command="{Binding PreviousPageCommand}"
                                            Style="{StaticResource MaterialDesignIconButton}"
                                            ToolTip="Página Anterior">
                                        <materialDesign:PackIcon Kind="ChevronLeft"/>
                                    </Button>

                                    <TextBlock VerticalAlignment="Center" Margin="16,0">
                                        <Run Text="Página"/>
                                        <Run Text="{Binding CurrentPage, Mode=OneWay}" FontWeight="Bold"/>
                                        <Run Text="de"/>
                                        <Run Text="{Binding TotalPages, Mode=OneWay}" FontWeight="Bold"/>
                                    </TextBlock>

                                    <Button Command="{Binding NextPageCommand}"
                                            Style="{StaticResource MaterialDesignIconButton}"
                                            ToolTip="Próxima Página">
                                        <materialDesign:PackIcon Kind="ChevronRight"/>
                                    </Button>

                                    <Button Command="{Binding LastPageCommand}"
                                            Style="{StaticResource MaterialDesignIconButton}"
                                            ToolTip="Última Página">
                                        <materialDesign:PackIcon Kind="PageLast"/>
                                    </Button>

                                    <ComboBox SelectedItem="{Binding PageSize}"
                                              Width="80"
                                              Margin="16,0,0,0"
                                              ToolTip="Itens por página">
                                        <ComboBox.Items>
                                            <system:Int32>10</system:Int32>
                                            <system:Int32>20</system:Int32>
                                            <system:Int32>50</system:Int32>
                                            <system:Int32>100</system:Int32>
                                        </ComboBox.Items>
                                    </ComboBox>
                                </StackPanel>
                            </Grid>
                        </materialDesign:Card>
                    </Grid>
                </TabItem>

                <!-- Categories Tab -->
                <TabItem Header="Categorias" MinWidth="180">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="16,12">
                                <materialDesign:PackIcon Kind="FolderMultiple" 
                                                         Width="24" Height="24"
                                                         VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding}" 
                                           Margin="12,0,0,0"
                                           VerticalAlignment="Center"
                                           FontSize="14"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <Grid Grid.Row="0" Margin="0,0,0,16">
                            <Button Command="{Binding AddCategoryCommand}"
                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                    HorizontalAlignment="Right">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Plus" 
                                                             VerticalAlignment="Center"
                                                             Margin="0,0,8,0"/>
                                    <TextBlock Text="Nova Categoria" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </Grid>

                        <!-- Categories Grid -->
                        <materialDesign:Card Grid.Row="1">
                            <DataGrid ItemsSource="{Binding Categories}"
                                      SelectedItem="{Binding SelectedCategory}"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Código" 
                                                        Binding="{Binding Code}" 
                                                        Width="120"/>

                                    <DataGridTextColumn Header="Nome" 
                                                        Binding="{Binding Name}" 
                                                        Width="*"
                                                        MinWidth="200"/>

                                    <DataGridTextColumn Header="Descrição" 
                                                        Binding="{Binding Description}" 
                                                        Width="*"
                                                        MinWidth="250"/>

                                    <DataGridTextColumn Header="Produtos" 
                                                        Binding="{Binding ProductCount}" 
                                                        Width="100"/>

                                    <DataGridTemplateColumn Header="Status" Width="100">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <materialDesign:PackIcon Kind="{Binding IsActive, Converter={StaticResource BoolToIconConverter}, ConverterParameter=CheckCircle|CloseCircle}"
                                                                         Foreground="{Binding IsActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#4CAF50|#F44336}"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>

                                    <DataGridTemplateColumn Header="Ações" Width="150">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <Button Command="{Binding DataContext.EditCategoryCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            ToolTip="Editar">
                                                        <materialDesign:PackIcon Kind="Pencil"/>
                                                    </Button>
                                                    <Button Command="{Binding DataContext.DeleteCategoryCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            ToolTip="Excluir"
                                                            Foreground="{DynamicResource ValidationErrorBrush}">
                                                        <materialDesign:PackIcon Kind="Delete"/>
                                                    </Button>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </materialDesign:Card>
                    </Grid>
                </TabItem>

                <!-- Expirations Tab -->
                <TabItem Header="Validades" MinWidth="180">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="16,12">
                                <materialDesign:PackIcon Kind="CalendarClock" 
                                                         Width="24" Height="24"
                                                         VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding}" 
                                           Margin="12,0,0,0"
                                           VerticalAlignment="Center"
                                           FontSize="14"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Near Expiration Alert -->
                        <materialDesign:Card Grid.Row="0" 
                                             Background="#FFF3E0" 
                                             Margin="0,0,0,16"
                                             Padding="16"
                                             Visibility="{Binding NearExpirationCount, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <materialDesign:PackIcon Kind="AlertCircle" 
                                                         Width="32" Height="32"
                                                         Foreground="#FF6F00"
                                                         VerticalAlignment="Center"/>

                                <StackPanel Grid.Column="1" Margin="16,0,0,0">
                                    <TextBlock Text="Atenção: Produtos Próximos ao Vencimento" 
                                               FontWeight="Bold"
                                               Foreground="#FF6F00"/>
                                    <TextBlock Foreground="#E65100">
                                        <Run Text="{Binding NearExpirationCount, Mode=OneWay}"/>
                                        <Run Text="produto(s) com validade próxima. Verifique e tome as medidas necessárias."/>
                                    </TextBlock>
                                </StackPanel>
                            </Grid>
                        </materialDesign:Card>

                        <!-- Expirations Grid -->
                        <materialDesign:Card Grid.Row="1">
                            <DataGrid ItemsSource="{Binding Expirations}"
                                      SelectedItem="{Binding SelectedExpiration}"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Produto" 
                                                        Binding="{Binding ProductName}" 
                                                        Width="*"
                                                        MinWidth="180"/>

                                    <DataGridTextColumn Header="Lote" 
                                                        Binding="{Binding BatchNumber}" 
                                                        Width="100"/>

                                    <DataGridTextColumn Header="Data de Validade" 
                                                        Binding="{Binding ExpirationDate, StringFormat=dd/MM/yyyy}" 
                                                        Width="120"/>

                                    <DataGridTextColumn Header="Dias Restantes" 
                                                        Width="120">
                                        <DataGridTextColumn.Binding>
                                            <Binding Path="DaysUntilExpiration">
                                                <Binding.StringFormat>{0} dias</Binding.StringFormat>
                                            </Binding>
                                        </DataGridTextColumn.Binding>
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsExpired}" Value="True">
                                                        <Setter Property="Foreground" Value="#F44336"/>
                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsNearExpiration}" Value="True">
                                                        <Setter Property="Foreground" Value="#FF9800"/>
                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>

                                    <DataGridTextColumn Header="Quantidade" 
                                                        Binding="{Binding Quantity}" 
                                                        Width="90"/>

                                    <DataGridTemplateColumn Header="Status" Width="140">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Border Background="{Binding StatusColor}"
                                                        CornerRadius="12" Padding="8,4">
                                                    <TextBlock Text="{Binding StatusText}" 
                                                               Foreground="White"
                                                               HorizontalAlignment="Center"
                                                               FontWeight="SemiBold"
                                                               FontSize="11"/>
                                                </Border>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>

                                    <DataGridTemplateColumn Header="Ações" Width="120">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <Button Command="{Binding DataContext.EditExpirationCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            ToolTip="Editar">
                                                        <materialDesign:PackIcon Kind="Pencil"/>
                                                    </Button>
                                                    <Button Command="{Binding DataContext.DeleteExpirationCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            ToolTip="Excluir"
                                                            Foreground="{DynamicResource ValidationErrorBrush}">
                                                        <materialDesign:PackIcon Kind="Delete"/>
                                                    </Button>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </materialDesign:Card>
                    </Grid>
                </TabItem>

                <!-- Price History Tab -->
                <TabItem Header="Histórico de Preços" MinWidth="180">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="16,12">
                                <materialDesign:PackIcon Kind="ChartLine" 
                                                         Width="24" Height="24"
                                                         VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding}" 
                                           Margin="12,0,0,0"
                                           VerticalAlignment="Center"
                                           FontSize="14"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <Grid Margin="16">
                        <materialDesign:Card>
                            <DataGrid ItemsSource="{Binding PriceHistories}"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Data" 
                                                        Binding="{Binding ChangeDate, StringFormat=dd/MM/yyyy HH:mm}" 
                                                        Width="140"/>

                                    <DataGridTextColumn Header="Produto" 
                                                        Binding="{Binding ProductName}" 
                                                        Width="*"
                                                        MinWidth="200"/>

                                    <DataGridTextColumn Header="Preço Venda Anterior" 
                                                        Binding="{Binding OldSalePrice, StringFormat=C2}" 
                                                        Width="150"/>

                                    <DataGridTextColumn Header="Novo Preço Venda" 
                                                        Binding="{Binding NewSalePrice, StringFormat=C2}" 
                                                        Width="150"/>

                                    <DataGridTextColumn Header="Preço Custo Anterior" 
                                                        Binding="{Binding OldCostPrice, StringFormat=C2}" 
                                                        Width="150"/>

                                    <DataGridTextColumn Header="Novo Preço Custo" 
                                                        Binding="{Binding NewCostPrice, StringFormat=C2}" 
                                                        Width="150"/>

                                    <DataGridTextColumn Header="Motivo" 
                                                        Binding="{Binding Reason}" 
                                                        Width="*"
                                                        MinWidth="200"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </materialDesign:Card>
                    </Grid>
                </TabItem>
            </TabControl>

            <!-- Status Message -->
            <materialDesign:Card Grid.Row="2" 
                                 Padding="16" 
                                 Margin="0"
                                 Background="{Binding IsStatusError, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#FFEBEE|#E8F5E9}"
                                 Visibility="{Binding StatusMessage, Converter={StaticResource NullToVisibilityConverter}}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <materialDesign:PackIcon Grid.Column="0"
                                             Kind="{Binding IsStatusError, Converter={StaticResource BoolToIconConverter}, ConverterParameter=AlertCircle|CheckCircle}"
                                             Foreground="{Binding IsStatusError, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#D32F2F|#388E3C}"
                                             Width="24" Height="24"
                                             VerticalAlignment="Center"
                                             Margin="0,0,12,0"/>

                    <TextBlock Grid.Column="1" 
                               Text="{Binding StatusMessage}"
                               Foreground="{Binding IsStatusError, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#D32F2F|#388E3C}"
                               VerticalAlignment="Center"
                               TextWrapping="Wrap"/>
                </Grid>
            </materialDesign:Card>
        </Grid>

        <!-- Product Form Dialog -->
        <Grid Background="#AA000000" 
              Visibility="{Binding IsProductFormOpen, Converter={StaticResource BooleanToVisibilityConverter}}"
              Panel.ZIndex="999">
            <materialDesign:Card Width="950" 
                                 MaxHeight="750"
                                 VerticalAlignment="Center"
                                 Padding="32">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Header com Progress Indicator -->
                        <Grid Margin="0,0,0,24">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0"
                                       Text="{Binding ProductId, Converter={StaticResource BoolToStringConverter}, ConverterParameter=Editar Produto|Novo Produto}"
                                       Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,12"/>

                            <!-- Step Indicator -->
                            <Grid Grid.Row="1" Margin="0,0,0,16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Step 1 -->
                                <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Border Width="32" Height="32" 
                                            CornerRadius="16"
                                            Margin="0,0,8,0">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#E2E8F0"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding CurrentStep}" Value="1">
                                                        <Setter Property="Background" Value="#667eea"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock Text="1" 
                                                   Foreground="White"
                                                   FontWeight="SemiBold"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"/>
                                    </Border>
                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="Informações" 
                                                   FontSize="13" 
                                                   FontWeight="Medium"
                                                   Foreground="{Binding IsStep1, Mode=OneWay, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#667eea|#64748B}"/>
                                        <TextBlock Text="Básicas" 
                                                   FontSize="11"
                                                   Foreground="#94A3B8"/>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Connector 1 -->
                                <Rectangle Grid.Column="1" 
                                           Width="60" 
                                           Height="2"
                                           Margin="16,0">
                                    <Rectangle.Style>
                                        <Style TargetType="Rectangle">
                                            <Setter Property="Fill" Value="#E2E8F0"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CurrentStep}" Value="2">
                                                    <Setter Property="Fill" Value="#667eea"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding CurrentStep}" Value="3">
                                                    <Setter Property="Fill" Value="#667eea"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Rectangle.Style>
                                </Rectangle>

                                <!-- Step 2 -->
                                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Border Width="32" Height="32" 
                                            CornerRadius="16"
                                            Margin="0,0,8,0">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#E2E8F0"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding CurrentStep}" Value="2">
                                                        <Setter Property="Background" Value="#43e97b"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock Text="2" 
                                                   Foreground="White"
                                                   FontWeight="SemiBold"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"/>
                                    </Border>
                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="Estoque" 
                                                   FontSize="13" 
                                                   FontWeight="Medium"
                                                   Foreground="{Binding IsStep2, Mode=OneWay, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#43e97b|#64748B}"/>
                                        <TextBlock Text="Inicial" 
                                                   FontSize="11"
                                                   Foreground="#94A3B8"/>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Connector 2 -->
                                <Rectangle Grid.Column="3" 
                                           Width="60" 
                                           Height="2"
                                           Margin="16,0">
                                    <Rectangle.Style>
                                        <Style TargetType="Rectangle">
                                            <Setter Property="Fill" Value="#E2E8F0"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CurrentStep}" Value="3">
                                                    <Setter Property="Fill" Value="#43e97b"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Rectangle.Style>
                                </Rectangle>

                                <!-- Step 3 -->
                                <StackPanel Grid.Column="4" Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Border Width="32" Height="32" 
                                            CornerRadius="16"
                                            Margin="0,0,8,0">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#E2E8F0"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding CurrentStep}" Value="3">
                                                        <Setter Property="Background" Value="#f093fb"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock Text="3" 
                                                   Foreground="White"
                                                   FontWeight="SemiBold"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"/>
                                    </Border>
                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="Validade" 
                                                   FontSize="13" 
                                                   FontWeight="Medium"
                                                   Foreground="{Binding IsStep3, Mode=OneWay, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#f093fb|#64748B}"/>
                                        <TextBlock Text="(Opcional)" 
                                                   FontSize="11"
                                                   Foreground="#94A3B8"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>

                            <!-- Progress Bar -->
                            <ProgressBar Grid.Row="2" 
                                         Value="{Binding StepProgress, Mode=OneWay}"
                                         Height="4"
                                         Minimum="0"
                                         Maximum="100"
                                         Foreground="#667eea"
                                         Background="#E2E8F0"
                                         BorderThickness="0"/>
                        </Grid>

                        <!-- STEP 1: Informações Básicas do Produto -->
                        <StackPanel Visibility="{Binding IsStep1, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                            
                            <TextBlock Text="Informações Básicas do Produto" 
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       Foreground="#1E293B"
                                       Margin="0,0,0,8"/>
                            
                            <TextBlock Text="Preencha as informações essenciais do produto"
                                       FontSize="13"
                                       Foreground="#64748B"
                                       Margin="0,0,0,24"/>
                            
                            <!-- Identificação -->
                            <TextBlock Text="Identificação" 
                                       FontSize="14"
                                       FontWeight="Medium"
                                       Foreground="#475569"
                                       Margin="0,0,0,12"/>
                            
                            <Grid Margin="0,0,0,24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                    <TextBox Text="{Binding ProductCode}"
                                             materialDesign:HintAssist.Hint="Código*"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             Margin="0,0,0,16"/>

                                    <TextBox Text="{Binding ProductName, UpdateSourceTrigger=PropertyChanged}"
                                             materialDesign:HintAssist.Hint="Nome do Produto*"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             Margin="0,0,0,16"/>

                                    <TextBox Text="{Binding ProductBarcode}"
                                             materialDesign:HintAssist.Hint="Código de Barras"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             Margin="0,0,0,16"/>

                                    <TextBox Text="{Binding ProductSKU}"
                                             materialDesign:HintAssist.Hint="SKU"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                    <ComboBox ItemsSource="{Binding Categories}"
                                              SelectedValue="{Binding ProductCategoryId}"
                                              SelectedValuePath="CategoryId"
                                              DisplayMemberPath="Name"
                                              materialDesign:HintAssist.Hint="Categoria*"
                                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                              Margin="0,0,0,16"/>

                                    <ComboBox ItemsSource="{Binding Suppliers}"
                                              SelectedValue="{Binding ProductSupplierId}"
                                              SelectedValuePath="PersonId"
                                              DisplayMemberPath="Name"
                                              materialDesign:HintAssist.Hint="Fornecedor*"
                                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                              Margin="0,0,0,16"/>

                                    <ComboBox SelectedItem="{Binding ProductStatus}"
                                              materialDesign:HintAssist.Hint="Status*"
                                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                              Margin="0,0,0,16">
                                        <entities:ProductStatus>Active</entities:ProductStatus>
                                        <entities:ProductStatus>Inactive</entities:ProductStatus>
                                        <entities:ProductStatus>Discontinued</entities:ProductStatus>
                                        <entities:ProductStatus>OutOfStock</entities:ProductStatus>
                                    </ComboBox>

                                    <TextBox Text="{Binding ProductDisplayOrder}"
                                             materialDesign:HintAssist.Hint="Ordem de Exibição"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                </StackPanel>
                            </Grid>

                            <!-- Descrições -->
                            <TextBlock Text="Descrições" 
                                       FontSize="14"
                                       FontWeight="Medium"
                                       Foreground="#475569"
                                       Margin="0,0,0,12"/>
                            
                            <TextBox Text="{Binding ProductShortDescription}"
                                     materialDesign:HintAssist.Hint="Descrição Curta"
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                     AcceptsReturn="True"
                                     MinLines="2"
                                     MaxLines="3"
                                     TextWrapping="Wrap"
                                     Margin="0,0,0,16"/>

                            <TextBox Text="{Binding ProductDescription}"
                                     materialDesign:HintAssist.Hint="Descrição Completa"
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                     AcceptsReturn="True"
                                     MinLines="3"
                                     MaxLines="5"
                                     TextWrapping="Wrap"
                                     Margin="0,0,0,24"/>

                            <!-- Preços e Impostos -->
                            <TextBlock Text="Preços e Impostos" 
                                       FontSize="14"
                                       FontWeight="Medium"
                                       Foreground="#475569"
                                       Margin="0,0,0,12"/>
                            
                            <Grid Margin="0,0,0,24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                    <TextBox Text="{Binding ProductCostPrice, StringFormat=N2}"
                                             materialDesign:HintAssist.Hint="Preço de Custo*"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             Margin="0,0,0,16"/>

                                    <TextBox Text="{Binding ProductSalePrice, StringFormat=N2}"
                                             materialDesign:HintAssist.Hint="Preço de Venda*"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             Margin="0,0,0,16"/>

                                    <TextBox Text="{Binding ProductDiscountPercentage, StringFormat=N2}"
                                             materialDesign:HintAssist.Hint="Desconto (%)"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                    <TextBox Text="{Binding ProductTaxRate, StringFormat=N2}"
                                             materialDesign:HintAssist.Hint="Taxa de Imposto (%)"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             Margin="0,0,0,16"/>

                                    <TextBox Text="{Binding ProfitMargin, StringFormat=N2}"
                                             materialDesign:HintAssist.Hint="Margem de Lucro (%)"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             IsReadOnly="True"
                                             Margin="0,0,0,16"/>

                                    <TextBox Text="{Binding FinalPrice, StringFormat=C2}"
                                             materialDesign:HintAssist.Hint="Preço Final"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             IsReadOnly="True"/>
                                </StackPanel>
                            </Grid>

                            <!-- Características Físicas -->
                            <TextBlock Text="Características Físicas" 
                                       FontSize="14"
                                       FontWeight="Medium"
                                       Foreground="#475569"
                                       Margin="0,0,0,12"/>
                            
                            <Grid Margin="0,0,0,24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                    <TextBox Text="{Binding ProductWeight}"
                                             materialDesign:HintAssist.Hint="Peso (ex: 1.5kg, 500g)"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                    <TextBox Text="{Binding ProductDimensions}"
                                             materialDesign:HintAssist.Hint="Dimensões (ex: 10x20x30cm)"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                </StackPanel>
                            </Grid>

                            <!-- Controle de Estoque -->
                            <TextBlock Text="Controle de Estoque" 
                                       FontSize="14"
                                       FontWeight="Medium"
                                       Foreground="#475569"
                                       Margin="0,0,0,12"/>
                            
                            <Grid Margin="0,0,0,24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                    <TextBox Text="{Binding ProductMinimumStock}"
                                             materialDesign:HintAssist.Hint="Estoque Mínimo"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Margin="4,0">
                                    <TextBox Text="{Binding ProductMaximumStock}"
                                             materialDesign:HintAssist.Hint="Estoque Máximo"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2" Margin="8,0,0,0">
                                    <TextBox Text="{Binding ProductReorderPoint}"
                                             materialDesign:HintAssist.Hint="Ponto de Reposição"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                </StackPanel>
                            </Grid>

                            <!-- Controle de Validade -->
                            <TextBlock Text="Controle de Validade" 
                                       FontSize="14"
                                       FontWeight="Medium"
                                       Foreground="#475569"
                                       Margin="0,0,0,12"/>
                            
                            <Grid Margin="0,0,0,24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                    <TextBox Text="{Binding ProductExpirationDays}"
                                             materialDesign:HintAssist.Hint="Dias até Validade"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                    <TextBox Text="{Binding ProductExpirationWarningDays}"
                                             materialDesign:HintAssist.Hint="Dias de Aviso de Validade"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                </StackPanel>
                            </Grid>

                            <!-- Imagem do Produto -->
                            <TextBlock Text="Imagem do Produto" 
                                       FontSize="14"
                                       FontWeight="Medium"
                                       Foreground="#475569"
                                       Margin="0,0,0,12"/>

                            <Grid Margin="0,0,0,24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Logo Preview -->
                                <Border Grid.Column="0"
                                        Width="120"
                                        Height="120"
                                        BorderBrush="#E2E8F0"
                                        BorderThickness="2"
                                        CornerRadius="8"
                                        Margin="0,0,16,0">
                                    <Grid>
                                        <Image Source="{Binding ProductPhotoUrl}"
                                               Stretch="UniformToFill"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Center"/>
                                        <TextBlock Text="Sem Imagem"
                                                   Foreground="#94A3B8"
                                                   FontSize="12"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding ProductPhotoUrl}" Value="">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding ProductPhotoUrl}" Value="{x:Null}">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Grid>
                                </Border>

                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBox Text="{Binding ProductPhotoUrl}"
                                             materialDesign:HintAssist.Hint="URL da Imagem"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             Margin="0,0,0,12"/>
                                    
                                    <TextBlock Text="Cole a URL da imagem do produto"
                                               FontSize="12"
                                               Foreground="#64748B"/>
                                </StackPanel>
                            </Grid>

                            <!-- Configurações -->
                            <TextBlock Text="Configurações" 
                                       FontSize="14"
                                       FontWeight="Medium"
                                       Foreground="#475569"
                                       Margin="0,0,0,12"/>
                            
                            <Grid Margin="0,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                    <CheckBox Content="Controla Estoque"
                                              IsChecked="{Binding ProductControlsStock}"
                                              FontWeight="Medium"
                                              Margin="0,8"/>

                                    <CheckBox Content="Possui Data de Validade"
                                              IsChecked="{Binding ProductHasExpirationDate}"
                                              FontWeight="Medium"
                                              Margin="0,8"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                    <CheckBox Content="Produto em Destaque"
                                              IsChecked="{Binding ProductIsFeatured}"
                                              FontWeight="Medium"
                                              Margin="0,8"/>

                                    <CheckBox Content="Permite Backorder"
                                              IsChecked="{Binding ProductAllowBackorder}"
                                              FontWeight="Medium"
                                              Margin="0,8"/>
                                </StackPanel>
                            </Grid>

                        </StackPanel>

                        <!-- STEP 2: Estoque Inicial -->
                        <StackPanel Visibility="{Binding IsStep2, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                            
                            <TextBlock Text="Estoque Inicial do Produto" 
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       Foreground="#1E293B"
                                       Margin="0,0,0,8"/>
                            
                            <TextBlock Text="Configure o estoque inicial deste produto"
                                       FontSize="13"
                                       Foreground="#64748B"
                                       Margin="0,0,0,24"/>

                            <Border Background="#F8FAFC"
                                    BorderBrush="#E2E8F0"
                                    BorderThickness="2"
                                    CornerRadius="12"
                                    Padding="24"
                                    Margin="0,0,0,24">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                        <materialDesign:PackIcon Kind="InformationOutline"
                                                                 Width="20"
                                                                 Height="20"
                                                                 Foreground="#3B82F6"
                                                                 VerticalAlignment="Top"
                                                                 Margin="0,2,12,0"/>
                                        <TextBlock TextWrapping="Wrap"
                                                   FontSize="13"
                                                   Foreground="#475569">
                                            <Run Text="Defina a quantidade inicial de estoque para este produto."/>
                                            <LineBreak/>
                                            <Run Text="Esta será registrada como uma movimentação de entrada no histórico."/>
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                    <TextBox Text="{Binding InitialStockQuantity, UpdateSourceTrigger=PropertyChanged}"
                                             materialDesign:HintAssist.Hint="Quantidade Inicial*"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             Margin="0,0,0,16"/>

                                    <TextBox Text="{Binding InitialStockCost, StringFormat=N2}"
                                             materialDesign:HintAssist.Hint="Custo Unitário*"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                    <TextBox Text="{Binding InitialStockNotes}"
                                             materialDesign:HintAssist.Hint="Observações"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             AcceptsReturn="True"
                                             MinLines="4"
                                             MaxLines="6"
                                             TextWrapping="Wrap"/>
                                </StackPanel>
                            </Grid>

                        </StackPanel>

                        <!-- STEP 3: Data de Validade -->
                        <StackPanel Visibility="{Binding IsStep3, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                            
                            <TextBlock Text="Data de Validade do Produto" 
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       Foreground="#1E293B"
                                       Margin="0,0,0,8"/>
                            
                            <TextBlock Text="Configure a data de validade para o lote inicial (opcional)"
                                       FontSize="13"
                                       Foreground="#64748B"
                                       Margin="0,0,0,24"/>

                            <!-- Aviso se não tem HasExpirationDate -->
                            <Border Background="#FEF3C7"
                                    BorderBrush="#FCD34D"
                                    BorderThickness="2"
                                    CornerRadius="12"
                                    Padding="24"
                                    Margin="0,0,0,24"
                                    Visibility="{Binding ProductHasExpirationDate, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="AlertOutline"
                                                             Width="24"
                                                             Height="24"
                                                             Foreground="#F59E0B"
                                                             VerticalAlignment="Top"
                                                             Margin="0,2,12,0"/>
                                    <TextBlock TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="#92400E">
                                        <Run Text="Este produto não está configurado para controlar data de validade."/>
                                        <LineBreak/>
                                        <Run Text="Você pode pular esta etapa clicando em 'Finalizar'."/>
                                    </TextBlock>
                                </StackPanel>
                            </Border>

                            <!-- Campos de validade -->
                            <Border Background="#F8FAFC"
                                    BorderBrush="#E2E8F0"
                                    BorderThickness="2"
                                    CornerRadius="12"
                                    Padding="24"
                                    Margin="0,0,0,24"
                                    Visibility="{Binding ProductHasExpirationDate, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                        <materialDesign:PackIcon Kind="CalendarOutline"
                                                                 Width="20"
                                                                 Height="20"
                                                                 Foreground="#10B981"
                                                                 VerticalAlignment="Top"
                                                                 Margin="0,2,12,0"/>
                                        <TextBlock TextWrapping="Wrap"
                                                   FontSize="13"
                                                   Foreground="#475569">
                                            <Run Text="Registre a data de validade do lote inicial."/>
                                            <LineBreak/>
                                            <Run Text="Esta informação é importante para o controle de qualidade."/>
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <Grid Visibility="{Binding ProductHasExpirationDate, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                    <DatePicker SelectedDate="{Binding InitialExpirationDate}"
                                                materialDesign:HintAssist.Hint="Data de Validade*"
                                                Style="{StaticResource MaterialDesignOutlinedDatePicker}"
                                                Margin="0,0,0,16"/>

                                    <TextBox Text="{Binding InitialBatchNumber}"
                                             materialDesign:HintAssist.Hint="Número do Lote"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                    <TextBox Text="{Binding InitialExpirationNotes}"
                                             materialDesign:HintAssist.Hint="Observações"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             AcceptsReturn="True"
                                             MinLines="6"
                                             MaxLines="8"
                                             TextWrapping="Wrap"/>
                                </StackPanel>
                            </Grid>

                        </StackPanel>

                        <!-- Botões de Navegação do Wizard -->
                        <Grid Margin="0,32,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Botão Anterior -->
                            <Button Grid.Column="0"
                                    Command="{Binding PreviousStepCommand}"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    Height="40"
                                    Padding="24,0"
                                    Visibility="{Binding IsStep1, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="ChevronLeft" 
                                                             Width="20" 
                                                             Height="20"
                                                             VerticalAlignment="Center"/>
                                    <TextBlock Text="Anterior" 
                                               Margin="8,0,0,0"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <!-- Botão Cancelar -->
                            <Button Grid.Column="2"
                                    Command="{Binding CancelProductCommand}"
                                    Style="{StaticResource MaterialDesignFlatButton}"
                                    Content="Cancelar"
                                    Height="40"
                                    Padding="24,0"
                                    Margin="0,0,12,0"/>

                            <!-- Botão Próximo (Steps 1 e 2) -->
                            <Button Grid.Column="3"
                                    Command="{Binding NextStepCommand}"
                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                    Height="40"
                                    Padding="24,0"
                                    Visibility="{Binding IsStep3, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Próximo" 
                                               VerticalAlignment="Center"/>
                                    <materialDesign:PackIcon Kind="ChevronRight" 
                                                             Width="20" 
                                                             Height="20"
                                                             Margin="8,0,0,0"
                                                             VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <!-- Botão Finalizar (Step 3) -->
                            <Button Grid.Column="3"
                                    Command="{Binding FinishWizardCommand}"
                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                    Height="40"
                                    Padding="24,0"
                                    Visibility="{Binding IsStep3, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Check" 
                                                             Width="20" 
                                                             Height="20"
                                                             VerticalAlignment="Center"/>
                                    <TextBlock Text="Finalizar" 
                                               Margin="8,0,0,0"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </materialDesign:Card>
        </Grid>

        <!-- Category Form Dialog -->
        <Grid Background="#AA000000" 
              Visibility="{Binding IsCategoryFormOpen, Converter={StaticResource BooleanToVisibilityConverter}}"
              Panel.ZIndex="999">
            <materialDesign:Card Width="500" 
                                 VerticalAlignment="Center"
                                 Padding="24">
                <StackPanel>
                    <TextBlock Text="{Binding CategoryId, Converter={StaticResource BoolToStringConverter}, ConverterParameter=Editar Categoria|Nova Categoria}"
                               Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                               Margin="0,0,0,24"/>

                    <TextBox Text="{Binding CategoryName, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="Nome da Categoria*"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"/>

                    <TextBox Text="{Binding CategoryCode}"
                             materialDesign:HintAssist.Hint="Código"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"/>

                    <TextBox Text="{Binding CategoryDescription}"
                             materialDesign:HintAssist.Hint="Descrição"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             AcceptsReturn="True"
                             MinLines="3"
                             Margin="0,0,0,16"/>

                    <CheckBox Content="Categoria Ativa"
                              IsChecked="{Binding CategoryIsActive}"
                              Margin="0,0,0,24"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="1"
                                Command="{Binding CancelCategoryCommand}"
                                Style="{StaticResource MaterialDesignFlatButton}"
                                Content="Cancelar"
                                Margin="0,0,8,0"/>

                        <Button Grid.Column="2"
                                Command="{Binding SaveCategoryCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Content="Salvar"/>
                    </Grid>
                </StackPanel>
            </materialDesign:Card>
        </Grid>

        <!-- Expiration Form Dialog -->
        <Grid Background="#AA000000" 
              Visibility="{Binding IsExpirationFormOpen, Converter={StaticResource BooleanToVisibilityConverter}}"
              Panel.ZIndex="999">
            <materialDesign:Card Width="500" 
                                 VerticalAlignment="Center"
                                 Padding="24">
                <StackPanel>
                    <TextBlock Text="{Binding ExpirationId, Converter={StaticResource BoolToStringConverter}, ConverterParameter=Editar Validade|Nova Validade}"
                               Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                               Margin="0,0,0,24"/>

                    <DatePicker SelectedDate="{Binding ExpirationDate}"
                                materialDesign:HintAssist.Hint="Data de Validade*"
                                Style="{StaticResource MaterialDesignOutlinedDatePicker}"
                                Margin="0,0,0,8"/>

                    <!-- Calculadora de dias -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <materialDesign:PackIcon Kind="CalendarClock" 
                                                 VerticalAlignment="Center"
                                                 Margin="0,0,8,0"
                                                 Foreground="#757575"/>
                        <TextBlock VerticalAlignment="Center" Foreground="#757575" FontSize="12">
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}Vence em {0} dias a partir de hoje">
                                    <Binding Path="ExpirationDate" Converter="{StaticResource DaysFromNowConverter}"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </StackPanel>

                    <TextBox Text="{Binding ExpirationQuantity}"
                             materialDesign:HintAssist.Hint="Quantidade*"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"/>

                    <TextBox Text="{Binding BatchNumber}"
                             materialDesign:HintAssist.Hint="Número do Lote"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"/>

                    <TextBox Text="{Binding ExpirationNotes}"
                             materialDesign:HintAssist.Hint="Observações"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             AcceptsReturn="True"
                             MinLines="3"
                             Margin="0,0,0,24"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="1"
                                Command="{Binding CancelExpirationCommand}"
                                Style="{StaticResource MaterialDesignFlatButton}"
                                Content="Cancelar"
                                Margin="0,0,8,0"/>

                        <Button Grid.Column="2"
                                Command="{Binding SaveExpirationCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Content="Salvar"/>
                    </Grid>
                </StackPanel>
            </materialDesign:Card>
        </Grid>

    </Grid>
</Page>
