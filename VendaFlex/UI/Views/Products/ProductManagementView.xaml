<Page x:Class="VendaFlex.UI.Views.Products.ProductManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:VendaFlex.Infrastructure.Converters"
             xmlns:entities="clr-namespace:VendaFlex.Data.Entities"
             xmlns:system="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1400"
             Background="{DynamicResource MaterialDesignPaper}">

    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <materialDesign:BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:StringToImageSourceConverter x:Key="StringToImageSourceConverter"/>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
        <converters:BoolToStringConverter x:Key="BoolToStringConverter"/>
        <converters:BoolToIconConverter x:Key="BoolToIconConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <converters:GreaterThanZeroToVisibilityConverter x:Key="GreaterThanZeroToVisibilityConverter"/>
        <converters:ProductStatusToColorConverter x:Key="ProductStatusToColorConverter"/>
        <converters:ProductStatusToStringConverter x:Key="ProductStatusToStringConverter"/>
        <converters:DaysFromNowConverter x:Key="DaysFromNowConverter"/>

        <!-- Product Status to String Converter -->
        <converters:EnumToStringConverter x:Key="ProductStatusConverter"/>
        
        <!-- Movement Type to Color Converter -->
        <converters:EnumToStringConverter x:Key="MovementTypeConverter"/>

        <Style x:Key="StatCardStyle" TargetType="materialDesign:Card">
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="UniformCornerRadius" Value="8"/>
        </Style>

        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock" BasedOn="{StaticResource MaterialDesignHeadline6TextBlock}">
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
    </Page.Resources>

    <Grid>
        <!-- Loading Overlay -->
        <Grid Background="#AA000000" 
              Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
              Panel.ZIndex="1000">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                             Value="0"
                             IsIndeterminate="True"
                             Width="60" Height="60"/>
                <TextBlock Text="Carregando..." 
                           Foreground="White"
                           Margin="0,16,0,0"
                           FontSize="16"/>
            </StackPanel>
        </Grid>

        <!-- Main Content -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <materialDesign:Card Grid.Row="0" Margin="0,0,0,8" Padding="16" UniformCornerRadius="0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Gerenciamento de Produtos" 
                                   Style="{StaticResource MaterialDesignHeadline4TextBlock}"/>
                        <TextBlock Text="Gerencie produtos, categorias, estoque e movimentações" 
                                   Style="{StaticResource MaterialDesignBody2TextBlock}"
                                   Foreground="{DynamicResource MaterialDesignBodyLight}"
                                   Margin="0,4,0,0"/>
                    </StackPanel>

                    <Button Grid.Column="1"
                            Style="{StaticResource MaterialDesignFloatingActionButton}"
                            Command="{Binding RefreshCommand}"
                            ToolTip="Atualizar">
                        <materialDesign:PackIcon Kind="Refresh" Width="24" Height="24"/>
                    </Button>
                </Grid>
            </materialDesign:Card>

            <!-- Statistics Cards -->
            <materialDesign:Card Grid.Row="0" Margin="0,80,0,8" Padding="16" UniformCornerRadius="8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Total Products -->
                    <Border Grid.Column="0" Background="{DynamicResource PrimaryHueMidBrush}" 
                            CornerRadius="8" Padding="16" Margin="4">
                        <StackPanel>
                            <materialDesign:PackIcon Kind="Package" Width="32" Height="32" 
                                                     Foreground="White"/>
                            <TextBlock Text="{Binding TotalProducts}" 
                                       FontSize="28" FontWeight="Bold" 
                                       Foreground="White" Margin="0,8,0,0"/>
                            <TextBlock Text="Total de Produtos" 
                                       Foreground="White" Opacity="0.9"/>
                        </StackPanel>
                    </Border>

                    <!-- Active Products -->
                    <Border Grid.Column="1" Background="#4CAF50" 
                            CornerRadius="8" Padding="16" Margin="4">
                        <StackPanel>
                            <materialDesign:PackIcon Kind="CheckCircle" Width="32" Height="32" 
                                                     Foreground="White"/>
                            <TextBlock Text="{Binding ActiveProducts}" 
                                       FontSize="28" FontWeight="Bold" 
                                       Foreground="White" Margin="0,8,0,0"/>
                            <TextBlock Text="Produtos Ativos" 
                                       Foreground="White" Opacity="0.9"/>
                        </StackPanel>
                    </Border>

                    <!-- Low Stock -->
                    <Border Grid.Column="2" Background="#FF9800" 
                            CornerRadius="8" Padding="16" Margin="4">
                        <StackPanel>
                            <materialDesign:PackIcon Kind="AlertCircle" Width="32" Height="32" 
                                                     Foreground="White"/>
                            <TextBlock Text="{Binding LowStockCount}" 
                                       FontSize="28" FontWeight="Bold" 
                                       Foreground="White" Margin="0,8,0,0"/>
                            <TextBlock Text="Estoque Baixo" 
                                       Foreground="White" Opacity="0.9"/>
                        </StackPanel>
                    </Border>

                    <!-- Expired -->
                    <Border Grid.Column="3" Background="#F44336" 
                            CornerRadius="8" Padding="16" Margin="4">
                        <StackPanel>
                            <materialDesign:PackIcon Kind="CalendarRemove" Width="32" Height="32" 
                                                     Foreground="White"/>
                            <TextBlock Text="{Binding ExpiredCount}" 
                                       FontSize="28" FontWeight="Bold" 
                                       Foreground="White" Margin="0,8,0,0"/>
                            <TextBlock Text="Produtos Vencidos" 
                                       Foreground="White" Opacity="0.9"/>
                        </StackPanel>
                    </Border>

                    <!-- Near Expiration -->
                    <Border Grid.Column="4" Background="#9C27B0" 
                            CornerRadius="8" Padding="16" Margin="4">
                        <StackPanel>
                            <materialDesign:PackIcon Kind="CalendarAlert" Width="32" Height="32" 
                                                     Foreground="White"/>
                            <TextBlock Text="{Binding NearExpirationCount}" 
                                       FontSize="28" FontWeight="Bold" 
                                       Foreground="White" Margin="0,8,0,0"/>
                            <TextBlock Text="Próximo ao Vencimento" 
                                       Foreground="White" Opacity="0.9"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </materialDesign:Card>

            <!-- Tab Control -->
            <TabControl Grid.Row="1" 
                        Style="{StaticResource MaterialDesignNavigationRailTabControl}"
                        TabStripPlacement="Left"
                        Margin="0,0,0,8">

                <!-- Products Tab -->
                <TabItem Header="Produtos" MinWidth="180">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="16,12">
                                <materialDesign:PackIcon Kind="Package" 
                                                         Width="24" Height="24"
                                                         VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding}" 
                                           Margin="12,0,0,0"
                                           VerticalAlignment="Center"
                                           FontSize="14"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Filters and Actions -->
                        <materialDesign:Card Grid.Row="0" Padding="16" Margin="0,0,0,16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Search and Add Button -->
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBox Grid.Column="0"
                                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                             materialDesign:HintAssist.Hint="Buscar por nome, código de barras ou SKU..."
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             Margin="0,0,16,0" >
                                        <TextBox.InputBindings>
                                            <KeyBinding Key="Escape" Command="{Binding ClearFiltersCommand}"/>
                                        </TextBox.InputBindings>
                                    </TextBox>

                                    <Button Grid.Column="1"
                                            Command="{Binding ExportProductsCommand}"
                                            Style="{StaticResource MaterialDesignOutlinedButton}"
                                            Height="40"
                                            Margin="0,0,8,0"
                                            ToolTip="Exportar Produtos">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="FileExport" 
                                                                     VerticalAlignment="Center"
                                                                     Margin="0,0,8,0"/>
                                            <TextBlock Text="Exportar" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>

                                    <Button Grid.Column="2"
                                            Command="{Binding AddProductCommand}"
                                            Style="{StaticResource MaterialDesignRaisedButton}"
                                            Height="40">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="Plus" 
                                                                     VerticalAlignment="Center"
                                                                     Margin="0,0,8,0"/>
                                            <TextBlock Text="Novo Produto" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </Grid>

                                <!-- Filters -->
                                <Grid Grid.Row="1" Margin="0,16,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="Categoria:" 
                                               VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <ComboBox Grid.Column="1"
                                              ItemsSource="{Binding Categories}"
                                              SelectedItem="{Binding SelectedCategory}"
                                              DisplayMemberPath="Name"
                                              materialDesign:HintAssist.Hint="Todas"
                                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                              Margin="0,0,24,0"/>

                                    <TextBlock Grid.Column="2" Text="Status:" 
                                               VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <ComboBox Grid.Column="3"
                                              SelectedItem="{Binding FilterStatus}"
                                              materialDesign:HintAssist.Hint="Todos"
                                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                              Margin="0,0,24,0">
                                        <entities:ProductStatus>Active</entities:ProductStatus>
                                        <entities:ProductStatus>Inactive</entities:ProductStatus>
                                        <entities:ProductStatus>Discontinued</entities:ProductStatus>
                                        <entities:ProductStatus>OutOfStock</entities:ProductStatus>
                                    </ComboBox>

                                    <CheckBox Grid.Column="4" 
                                              Content="Estoque Baixo"
                                              IsChecked="{Binding FilterLowStock}"
                                              Margin="0,0,16,0"/>

                                    <CheckBox Grid.Column="5" 
                                              Content="Em Destaque"
                                              IsChecked="{Binding FilterFeatured}"
                                              Margin="0,0,16,0"/>

                                    <Button Grid.Column="7"
                                            Command="{Binding ClearFiltersCommand}"
                                            Style="{StaticResource MaterialDesignFlatButton}"
                                            Content="Limpar Filtros"/>
                                </Grid>
                            </Grid>
                        </materialDesign:Card>

                        <!-- Products DataGrid -->
                        <materialDesign:Card Grid.Row="1">
                            <DataGrid ItemsSource="{Binding FilteredProducts}"
                                      SelectedItem="{Binding SelectedProduct}"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      IsReadOnly="False"
                                      SelectionMode="Single"
                                      materialDesign:DataGridAssist.CellPadding="8"
                                      materialDesign:DataGridAssist.ColumnHeaderPadding="8">
                                <DataGrid.Columns>
                                    <DataGridTemplateColumn Header="Foto" Width="80" IsReadOnly="True">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Border Width="50" Height="50" 
                                                        Background="{DynamicResource MaterialDesignDivider}"
                                                        CornerRadius="4">
                                                    <Image Source="{Binding PhotoUrl}" 
                                                           Stretch="UniformToFill"/>
                                                </Border>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>

                                    <DataGridTextColumn Header="Código" 
                                                        Binding="{Binding Code}" 
                                                        Width="100"
                                                        IsReadOnly="True"/>

                                    <DataGridTextColumn Header="Nome" 
                                                        Binding="{Binding Name}" 
                                                        Width="*"
                                                        MinWidth="200"
                                                        IsReadOnly="True"/>

                                    <DataGridTextColumn Header="Categoria" 
                                                        Binding="{Binding CategoryName}" 
                                                        Width="150"
                                                        IsReadOnly="True"/>

                                    <DataGridTextColumn Header="SKU" 
                                                        Binding="{Binding SKU}" 
                                                        Width="120"
                                                        IsReadOnly="True"/>

                                    <DataGridTextColumn Header="Código de Barras" 
                                                        Binding="{Binding Barcode}" 
                                                        Width="140"
                                                        IsReadOnly="True"/>

                                    <DataGridTextColumn Header="Preço de Custo" 
                                                        Binding="{Binding CostPrice, StringFormat=C2}" 
                                                        Width="120"
                                                        IsReadOnly="True"/>

                                    <DataGridTextColumn Header="Preço de Venda" 
                                                        Binding="{Binding SalePrice, StringFormat=C2}" 
                                                        Width="120"
                                                        IsReadOnly="True"/>

                                    <DataGridTextColumn Header="Estoque" 
                                                        Binding="{Binding CurrentStock}" 
                                                        Width="80"
                                                        IsReadOnly="True"/>

                                    <DataGridTemplateColumn Header="Status" Width="150">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Border Background="{Binding Status, Converter={StaticResource ProductStatusToColorConverter}}"
                                                        CornerRadius="12" Padding="8,4">
                                                    <TextBlock Text="{Binding Status, Converter={StaticResource ProductStatusToStringConverter}}" 
                                                               Foreground="White"
                                                               HorizontalAlignment="Center"
                                                               FontSize="11"
                                                               FontWeight="Bold"/>
                                                </Border>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                        <DataGridTemplateColumn.CellEditingTemplate>
                                            <DataTemplate>
                                                <ComboBox SelectedItem="{Binding Status, UpdateSourceTrigger=PropertyChanged}"
                                                          materialDesign:HintAssist.IsFloating="False">
                                                    <entities:ProductStatus>Active</entities:ProductStatus>
                                                    <entities:ProductStatus>Inactive</entities:ProductStatus>
                                                    <entities:ProductStatus>Discontinued</entities:ProductStatus>
                                                    <entities:ProductStatus>OutOfStock</entities:ProductStatus>
                                                </ComboBox>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellEditingTemplate>
                                    </DataGridTemplateColumn>

                                    <DataGridTemplateColumn Header="Ações" Width="150" IsReadOnly="True">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <Button Command="{Binding DataContext.EditProductCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            CommandParameter="{Binding}"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            ToolTip="Editar">
                                                        <materialDesign:PackIcon Kind="Pencil"/>
                                                    </Button>
                                                    <Button Command="{Binding DataContext.DeleteProductCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            CommandParameter="{Binding}"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            ToolTip="Excluir"
                                                            Foreground="{DynamicResource ValidationErrorBrush}">
                                                        <materialDesign:PackIcon Kind="Delete"/>
                                                    </Button>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </materialDesign:Card>

                        <!-- Pagination -->
                        <materialDesign:Card Grid.Row="2" Padding="16" Margin="0,8,0,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Info -->
                                <TextBlock Grid.Column="0" VerticalAlignment="Center">
                                    <Run Text="Mostrando"/>
                                    <Run Text="{Binding FilteredProducts.Count, Mode=OneWay}" FontWeight="Bold"/>
                                    <Run Text="de"/>
                                    <Run Text="{Binding TotalRecords, Mode=OneWay}" FontWeight="Bold"/>
                                    <Run Text="registros"/>
                                </TextBlock>

                                <!-- Navigation -->
                                <StackPanel Grid.Column="2" Orientation="Horizontal">
                                    <Button Command="{Binding FirstPageCommand}"
                                            Style="{StaticResource MaterialDesignIconButton}"
                                            ToolTip="Primeira Página">
                                        <materialDesign:PackIcon Kind="PageFirst"/>
                                    </Button>

                                    <Button Command="{Binding PreviousPageCommand}"
                                            Style="{StaticResource MaterialDesignIconButton}"
                                            ToolTip="Página Anterior">
                                        <materialDesign:PackIcon Kind="ChevronLeft"/>
                                    </Button>

                                    <TextBlock VerticalAlignment="Center" Margin="16,0">
                                        <Run Text="Página"/>
                                        <Run Text="{Binding CurrentPage, Mode=OneWay}" FontWeight="Bold"/>
                                        <Run Text="de"/>
                                        <Run Text="{Binding TotalPages, Mode=OneWay}" FontWeight="Bold"/>
                                    </TextBlock>

                                    <Button Command="{Binding NextPageCommand}"
                                            Style="{StaticResource MaterialDesignIconButton}"
                                            ToolTip="Próxima Página">
                                        <materialDesign:PackIcon Kind="ChevronRight"/>
                                    </Button>

                                    <Button Command="{Binding LastPageCommand}"
                                            Style="{StaticResource MaterialDesignIconButton}"
                                            ToolTip="Última Página">
                                        <materialDesign:PackIcon Kind="PageLast"/>
                                    </Button>

                                    <ComboBox SelectedItem="{Binding PageSize}"
                                              Width="80"
                                              Margin="16,0,0,0"
                                              ToolTip="Itens por página">
                                        <ComboBox.Items>
                                            <system:Int32>10</system:Int32>
                                            <system:Int32>20</system:Int32>
                                            <system:Int32>50</system:Int32>
                                            <system:Int32>100</system:Int32>
                                        </ComboBox.Items>
                                    </ComboBox>
                                </StackPanel>
                            </Grid>
                        </materialDesign:Card>
                    </Grid>
                </TabItem>

                <!-- Categories Tab -->
                <TabItem Header="Categorias" MinWidth="180">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="16,12">
                                <materialDesign:PackIcon Kind="FolderMultiple" 
                                                         Width="24" Height="24"
                                                         VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding}" 
                                           Margin="12,0,0,0"
                                           VerticalAlignment="Center"
                                           FontSize="14"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <Grid Grid.Row="0" Margin="0,0,0,16">
                            <Button Command="{Binding AddCategoryCommand}"
                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                    HorizontalAlignment="Right">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Plus" 
                                                             VerticalAlignment="Center"
                                                             Margin="0,0,8,0"/>
                                    <TextBlock Text="Nova Categoria" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </Grid>

                        <!-- Categories Grid -->
                        <materialDesign:Card Grid.Row="1">
                            <DataGrid ItemsSource="{Binding Categories}"
                                      SelectedItem="{Binding SelectedCategory}"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Código" 
                                                        Binding="{Binding Code}" 
                                                        Width="120"/>

                                    <DataGridTextColumn Header="Nome" 
                                                        Binding="{Binding Name}" 
                                                        Width="*"
                                                        MinWidth="200"/>

                                    <DataGridTextColumn Header="Descrição" 
                                                        Binding="{Binding Description}" 
                                                        Width="*"
                                                        MinWidth="250"/>

                                    <DataGridTextColumn Header="Produtos" 
                                                        Binding="{Binding ProductCount}" 
                                                        Width="100"/>

                                    <DataGridTemplateColumn Header="Status" Width="100">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <materialDesign:PackIcon Kind="{Binding IsActive, Converter={StaticResource BoolToIconConverter}, ConverterParameter=CheckCircle|CloseCircle}"
                                                                         Foreground="{Binding IsActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#4CAF50|#F44336}"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>

                                    <DataGridTemplateColumn Header="Ações" Width="150">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <Button Command="{Binding DataContext.EditCategoryCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            ToolTip="Editar">
                                                        <materialDesign:PackIcon Kind="Pencil"/>
                                                    </Button>
                                                    <Button Command="{Binding DataContext.DeleteCategoryCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            ToolTip="Excluir"
                                                            Foreground="{DynamicResource ValidationErrorBrush}">
                                                        <materialDesign:PackIcon Kind="Delete"/>
                                                    </Button>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </materialDesign:Card>
                    </Grid>
                </TabItem>

                <!-- Low Stock Tab -->
                <TabItem Header="Estoque Baixo" MinWidth="180">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="16,12">
                                <materialDesign:PackIcon Kind="AlertCircle" 
                                                         Width="24" Height="24"
                                                         VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding}" 
                                           Margin="12,0,0,0"
                                           VerticalAlignment="Center"
                                           FontSize="14"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <materialDesign:Card Margin="16">
                        <DataGrid ItemsSource="{Binding LowStockProducts}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Produto" 
                                                    Binding="{Binding ProductName}" 
                                                    Width="*"
                                                    MinWidth="200"/>

                                <DataGridTextColumn Header="Quantidade Atual" 
                                                    Binding="{Binding Quantity}" 
                                                    Width="140"/>

                                <DataGridTextColumn Header="Quantidade Mínima" 
                                                    Binding="{Binding MinimumStock}" 
                                                    Width="140"/>

                                <DataGridTextColumn Header="Ponto de Reposição" 
                                                    Binding="{Binding ReorderPoint}" 
                                                    Width="140"/>

                                <DataGridTextColumn Header="Disponível" 
                                                    Binding="{Binding AvailableQuantity}" 
                                                    Width="120"/>

                                <DataGridTemplateColumn Header="Ação" Width="150">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Command="{Binding DataContext.AddMovementCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                                    Content="Adicionar Estoque"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </materialDesign:Card>
                </TabItem>

                <!-- Expirations Tab -->
                <TabItem Header="Validades" MinWidth="180">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="16,12">
                                <materialDesign:PackIcon Kind="CalendarClock" 
                                                         Width="24" Height="24"
                                                         VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding}" 
                                           Margin="12,0,0,0"
                                           VerticalAlignment="Center"
                                           FontSize="14"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Near Expiration Alert -->
                        <materialDesign:Card Grid.Row="0" 
                                             Background="#FFF3E0" 
                                             Margin="0,0,0,16"
                                             Padding="16"
                                             Visibility="{Binding NearExpirationCount, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <materialDesign:PackIcon Kind="AlertCircle" 
                                                         Width="32" Height="32"
                                                         Foreground="#FF6F00"
                                                         VerticalAlignment="Center"/>

                                <StackPanel Grid.Column="1" Margin="16,0,0,0">
                                    <TextBlock Text="Atenção: Produtos Próximos ao Vencimento" 
                                               FontWeight="Bold"
                                               Foreground="#FF6F00"/>
                                    <TextBlock Foreground="#E65100">
                                        <Run Text="{Binding NearExpirationCount, Mode=OneWay}"/>
                                        <Run Text="produto(s) com validade próxima. Verifique e tome as medidas necessárias."/>
                                    </TextBlock>
                                </StackPanel>
                            </Grid>
                        </materialDesign:Card>

                        <!-- Expirations Grid -->
                        <materialDesign:Card Grid.Row="1">
                            <DataGrid ItemsSource="{Binding Expirations}"
                                      SelectedItem="{Binding SelectedExpiration}"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Produto" 
                                                        Binding="{Binding ProductName}" 
                                                        Width="*"
                                                        MinWidth="180"/>

                                    <DataGridTextColumn Header="Lote" 
                                                        Binding="{Binding BatchNumber}" 
                                                        Width="100"/>

                                    <DataGridTextColumn Header="Data de Validade" 
                                                        Binding="{Binding ExpirationDate, StringFormat=dd/MM/yyyy}" 
                                                        Width="120"/>

                                    <DataGridTextColumn Header="Dias Restantes" 
                                                        Width="120">
                                        <DataGridTextColumn.Binding>
                                            <Binding Path="DaysUntilExpiration">
                                                <Binding.StringFormat>{0} dias</Binding.StringFormat>
                                            </Binding>
                                        </DataGridTextColumn.Binding>
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsExpired}" Value="True">
                                                        <Setter Property="Foreground" Value="#F44336"/>
                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsNearExpiration}" Value="True">
                                                        <Setter Property="Foreground" Value="#FF9800"/>
                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>

                                    <DataGridTextColumn Header="Quantidade" 
                                                        Binding="{Binding Quantity}" 
                                                        Width="90"/>

                                    <DataGridTemplateColumn Header="Status" Width="140">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Border Background="{Binding StatusColor}"
                                                        CornerRadius="12" Padding="8,4">
                                                    <TextBlock Text="{Binding StatusText}" 
                                                               Foreground="White"
                                                               HorizontalAlignment="Center"
                                                               FontWeight="SemiBold"
                                                               FontSize="11"/>
                                                </Border>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>

                                    <DataGridTemplateColumn Header="Ações" Width="120">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <Button Command="{Binding DataContext.EditExpirationCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            ToolTip="Editar">
                                                        <materialDesign:PackIcon Kind="Pencil"/>
                                                    </Button>
                                                    <Button Command="{Binding DataContext.DeleteExpirationCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            ToolTip="Excluir"
                                                            Foreground="{DynamicResource ValidationErrorBrush}">
                                                        <materialDesign:PackIcon Kind="Delete"/>
                                                    </Button>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </materialDesign:Card>
                    </Grid>
                </TabItem>

                <!-- Stock Movements Tab -->
                <TabItem Header="Movimentações" MinWidth="180">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="16,12">
                                <materialDesign:PackIcon Kind="SwapHorizontal" 
                                                         Width="24" Height="24"
                                                         VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding}" 
                                           Margin="12,0,0,0"
                                           VerticalAlignment="Center"
                                           FontSize="14"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <materialDesign:Card Margin="16">
                        <DataGrid ItemsSource="{Binding StockMovements}"
                                  SelectedItem="{Binding SelectedStockMovement}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Data" 
                                                    Binding="{Binding Date, StringFormat=dd/MM/yyyy HH:mm}" 
                                                    Width="140"/>

                                <DataGridTextColumn Header="Produto" 
                                                    Binding="{Binding ProductName}" 
                                                    Width="*"
                                                    MinWidth="200"/>

                                <DataGridTemplateColumn Header="Tipo" Width="120">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Background="{Binding Type, Converter={StaticResource MovementTypeConverter}}"
                                                    CornerRadius="12" Padding="8,4">
                                                <TextBlock Text="{Binding Type}" 
                                                           Foreground="White"
                                                           HorizontalAlignment="Center"
                                                           FontSize="11"/>
                                            </Border>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTextColumn Header="Quantidade" 
                                                    Binding="{Binding Quantity}" 
                                                    Width="100"/>

                                <DataGridTextColumn Header="Anterior" 
                                                    Binding="{Binding PreviousQuantity}" 
                                                    Width="100"/>

                                <DataGridTextColumn Header="Novo" 
                                                    Binding="{Binding NewQuantity}" 
                                                    Width="100"/>

                                <DataGridTextColumn Header="Custo Total" 
                                                    Binding="{Binding TotalCost, StringFormat=C2}" 
                                                    Width="120"/>

                                <DataGridTextColumn Header="Usuário" 
                                                    Binding="{Binding UserName}" 
                                                    Width="150"/>

                                <DataGridTextColumn Header="Observações" 
                                                    Binding="{Binding Notes}" 
                                                    Width="*"
                                                    MinWidth="150"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </materialDesign:Card>
                </TabItem>

                <!-- Price History Tab -->
                <TabItem Header="Histórico de Preços" MinWidth="180">
                    <TabItem.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="16,12">
                                <materialDesign:PackIcon Kind="ChartLine" 
                                                         Width="24" Height="24"
                                                         VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding}" 
                                           Margin="12,0,0,0"
                                           VerticalAlignment="Center"
                                           FontSize="14"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.HeaderTemplate>

                    <Grid Margin="16">
                        <materialDesign:Card>
                            <DataGrid ItemsSource="{Binding PriceHistories}"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Data" 
                                                        Binding="{Binding ChangeDate, StringFormat=dd/MM/yyyy HH:mm}" 
                                                        Width="140"/>

                                    <DataGridTextColumn Header="Produto" 
                                                        Binding="{Binding ProductName}" 
                                                        Width="*"
                                                        MinWidth="200"/>

                                    <DataGridTextColumn Header="Preço Venda Anterior" 
                                                        Binding="{Binding OldSalePrice, StringFormat=C2}" 
                                                        Width="150"/>

                                    <DataGridTextColumn Header="Novo Preço Venda" 
                                                        Binding="{Binding NewSalePrice, StringFormat=C2}" 
                                                        Width="150"/>

                                    <DataGridTextColumn Header="Preço Custo Anterior" 
                                                        Binding="{Binding OldCostPrice, StringFormat=C2}" 
                                                        Width="150"/>

                                    <DataGridTextColumn Header="Novo Preço Custo" 
                                                        Binding="{Binding NewCostPrice, StringFormat=C2}" 
                                                        Width="150"/>

                                    <DataGridTextColumn Header="Motivo" 
                                                        Binding="{Binding Reason}" 
                                                        Width="*"
                                                        MinWidth="200"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </materialDesign:Card>
                    </Grid>
                </TabItem>
            </TabControl>

            <!-- Status Message -->
            <materialDesign:Card Grid.Row="2" 
                                 Padding="16" 
                                 Margin="0"
                                 Background="{Binding IsStatusError, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#FFEBEE|#E8F5E9}"
                                 Visibility="{Binding StatusMessage, Converter={StaticResource NullToVisibilityConverter}}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <materialDesign:PackIcon Grid.Column="0"
                                             Kind="{Binding IsStatusError, Converter={StaticResource BoolToIconConverter}, ConverterParameter=AlertCircle|CheckCircle}"
                                             Foreground="{Binding IsStatusError, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#D32F2F|#388E3C}"
                                             Width="24" Height="24"
                                             VerticalAlignment="Center"
                                             Margin="0,0,12,0"/>

                    <TextBlock Grid.Column="1" 
                               Text="{Binding StatusMessage}"
                               Foreground="{Binding IsStatusError, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#D32F2F|#388E3C}"
                               VerticalAlignment="Center"
                               TextWrapping="Wrap"/>
                </Grid>
            </materialDesign:Card>
        </Grid>

        <!-- Product Form Dialog -->
        <Grid Background="#AA000000" 
              Visibility="{Binding IsProductFormOpen, Converter={StaticResource BooleanToVisibilityConverter}}"
              Panel.ZIndex="999">
            <materialDesign:Card Width="850" 
                                 MaxHeight="700"
                                 VerticalAlignment="Center"
                                 Padding="24">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="{Binding ProductId, Converter={StaticResource BoolToStringConverter}, ConverterParameter=Editar Produto|Novo Produto}"
                                   Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                                   Margin="0,0,0,24"/>

                        <!-- Informações Básicas -->
                        <TextBlock Text="Informações Básicas" 
                                   Style="{StaticResource SectionHeaderStyle}"/>
                        
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                <TextBox Text="{Binding ProductCode}"
                                         materialDesign:HintAssist.Hint="Código*"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Margin="0,0,0,16"/>

                                <TextBox Text="{Binding ProductName, UpdateSourceTrigger=PropertyChanged}"
                                         materialDesign:HintAssist.Hint="Nome do Produto*"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Margin="0,0,0,16"/>

                                <TextBox Text="{Binding ProductBarcode}"
                                         materialDesign:HintAssist.Hint="Código de Barras"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Margin="0,0,0,16"/>

                                <TextBox Text="{Binding ProductSKU}"
                                         materialDesign:HintAssist.Hint="SKU"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Margin="0,0,0,16"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                <ComboBox ItemsSource="{Binding Categories}"
                                          SelectedValue="{Binding ProductCategoryId}"
                                          SelectedValuePath="CategoryId"
                                          DisplayMemberPath="Name"
                                          materialDesign:HintAssist.Hint="Categoria*"
                                          Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                          Margin="0,0,0,16"/>

                                <ComboBox ItemsSource="{Binding Suppliers}"
                                          SelectedValue="{Binding ProductSupplierId}"
                                          SelectedValuePath="PersonId"
                                          DisplayMemberPath="Name"
                                          materialDesign:HintAssist.Hint="Fornecedor*"
                                          Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                          Margin="0,0,0,16"/>

                                <ComboBox SelectedItem="{Binding ProductStatus}"
                                          materialDesign:HintAssist.Hint="Status*"
                                          Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                          Margin="0,0,0,16">
                                    <entities:ProductStatus>Active</entities:ProductStatus>
                                    <entities:ProductStatus>Inactive</entities:ProductStatus>
                                    <entities:ProductStatus>Discontinued</entities:ProductStatus>
                                    <entities:ProductStatus>OutOfStock</entities:ProductStatus>
                                </ComboBox>

                                <TextBox Text="{Binding ProductDisplayOrder}"
                                         materialDesign:HintAssist.Hint="Ordem de Exibição"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Margin="0,0,0,16"/>
                            </StackPanel>
                        </Grid>

                        <!-- Descrições -->
                        <TextBlock Text="Descrições" 
                                   Style="{StaticResource SectionHeaderStyle}"/>
                        
                        <TextBox Text="{Binding ProductShortDescription}"
                                 materialDesign:HintAssist.Hint="Descrição Curta"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 AcceptsReturn="True"
                                 MinLines="2"
                                 MaxLines="3"
                                 Margin="0,0,0,16"/>

                        <TextBox Text="{Binding ProductDescription}"
                                 materialDesign:HintAssist.Hint="Descrição Completa"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 AcceptsReturn="True"
                                 MinLines="3"
                                 MaxLines="5"
                                 Margin="0,0,0,16"/>

                        <!-- Preços e Impostos -->
                        <TextBlock Text="Preços e Impostos" 
                                   Style="{StaticResource SectionHeaderStyle}"/>
                        
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                <TextBox Text="{Binding ProductCostPrice, StringFormat=N2}"
                                         materialDesign:HintAssist.Hint="Preço de Custo*"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Margin="0,0,0,16"/>

                                <TextBox Text="{Binding ProductSalePrice, StringFormat=N2}"
                                         materialDesign:HintAssist.Hint="Preço de Venda*"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Margin="0,0,0,16"/>

                                <TextBox Text="{Binding ProductDiscountPercentage, StringFormat=N2}"
                                         materialDesign:HintAssist.Hint="Desconto (%)"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Margin="0,0,0,16"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                <TextBox Text="{Binding ProductTaxRate, StringFormat=N2}"
                                         materialDesign:HintAssist.Hint="Taxa de Imposto (%)"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Margin="0,0,0,16"/>

                                <TextBox Text="{Binding ProfitMargin, StringFormat=N2}"
                                         materialDesign:HintAssist.Hint="Margem de Lucro (%)"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         IsReadOnly="True"
                                         Margin="0,0,0,16"/>

                                <TextBox Text="{Binding FinalPrice, StringFormat=C2}"
                                         materialDesign:HintAssist.Hint="Preço Final"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         IsReadOnly="True"
                                         Margin="0,0,0,16"/>
                            </StackPanel>
                        </Grid>

                        <!-- Características Físicas -->
                        <TextBlock Text="Características Físicas" 
                                   Style="{StaticResource SectionHeaderStyle}"/>
                        
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                <TextBox Text="{Binding ProductWeight}"
                                         materialDesign:HintAssist.Hint="Peso (ex: 1.5kg, 500g)"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Margin="0,0,0,16"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                <TextBox Text="{Binding ProductDimensions}"
                                         materialDesign:HintAssist.Hint="Dimensões (ex: 10x20x30cm)"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Margin="0,0,0,16"/>
                            </StackPanel>
                        </Grid>

                        <!-- Controle de Estoque -->
                        <TextBlock Text="Controle de Estoque" 
                                   Style="{StaticResource SectionHeaderStyle}"/>
                        
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                <TextBox Text="{Binding ProductMinimumStock}"
                                         materialDesign:HintAssist.Hint="Estoque Mínimo"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="4,0">
                                <TextBox Text="{Binding ProductMaximumStock}"
                                         materialDesign:HintAssist.Hint="Estoque Máximo"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2" Margin="8,0,0,0">
                                <TextBox Text="{Binding ProductReorderPoint}"
                                         materialDesign:HintAssist.Hint="Ponto de Reposição"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                            </StackPanel>
                        </Grid>

                        <!-- Controle de Validade -->
                        <TextBlock Text="Controle de Validade" 
                                   Style="{StaticResource SectionHeaderStyle}"/>
                        
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                <TextBox Text="{Binding ProductExpirationDays}"
                                         materialDesign:HintAssist.Hint="Dias até Validade"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Margin="0,0,0,16"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                <TextBox Text="{Binding ProductExpirationWarningDays}"
                                         materialDesign:HintAssist.Hint="Dias de Aviso de Validade"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Margin="0,0,0,16"/>
                            </StackPanel>
                        </Grid>

                        <!-- Imagem -->
                        <TextBlock Text="Imagem do Produto" 
                                   Style="{StaticResource SectionHeaderStyle}"/>

                            <Border >
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Logo Preview -->
                                    <Border Grid.Column="0"
                                           Width="120" 
                                           Height="120"
                                           Background="#F1F5F9"
                                           CornerRadius="12"
                                           BorderBrush="#E2E8F0"
                                           BorderThickness="2"
                                           Margin="0,0,24,0">
                                        <Grid>
                                            <!-- Placeholder -->
                                            <StackPanel VerticalAlignment="Center" 
                                                       HorizontalAlignment="Center"
                                                       Visibility="{Binding HasImage, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                                <materialDesign:PackIcon Kind="ImageOutline" 
                                                                        Width="48" 
                                                                        Height="48"
                                                                        Foreground="#94A3B8"/>
                                                <TextBlock Text="Sem Imagem" 
                                                          FontSize="11" 
                                                          Foreground="#94A3B8"
                                                          HorizontalAlignment="Center"
                                                          Margin="0,8,0,0"/>
                                            </StackPanel>

                                            <!-- Logo Image -->
                                            <Image Source="{Binding ProductPhotoUrl, Converter={StaticResource StringToImageSourceConverter}}"
                                                  Stretch="Uniform"
                                                  Visibility="{Binding HasImage, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        </Grid>
                                    </Border>

                                    <!-- Logo Actions -->
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <TextBlock Text="Imagem do produto" 
                                                  Margin="0,0,0,8"/>
                                        <TextBlock Text="Adicione a imagem do produto"
                                                  FontSize="13"
                                                  Foreground="#64748B"
                                                  TextWrapping="Wrap"
                                                  Margin="0,0,0,16"/>

                                        <StackPanel Orientation="Horizontal">
                                            <Button Command="{Binding  UploadProductPhotoCommand}"
                                                   Style="{StaticResource MaterialDesignOutlinedButton}"
                                                   Height="40"
                                                   Padding="20,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="Upload" 
                                                                            Width="18" 
                                                                            Height="18"
                                                                            VerticalAlignment="Center"/>
                                                    <TextBlock Text="Selecionar Logo" 
                                                              Margin="8,0,0,0"
                                                              VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Button>

                                            <Button Command="{Binding RemoveProductPhotoCommand}"
                                                   Style="{StaticResource MaterialDesignOutlinedButton}"
                                                   Height="40"
                                                   Padding="20,0"
                                                   Margin="12,0,0,0"
                                                   Visibility="{Binding HasLogo, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="Delete" 
                                                                            Width="18" 
                                                                            Height="18"
                                                                            VerticalAlignment="Center"/>
                                                    <TextBlock Text="Remover" 
                                                              Margin="8,0,0,0"
                                                              VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Button>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                            </Border>

                        <!-- Opções Adicionais -->
                        <TextBlock Text="Opções Adicionais" 
                                   Style="{StaticResource SectionHeaderStyle}"/>
                        
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                <CheckBox Content="Controla Estoque"
                                          IsChecked="{Binding ProductControlsStock}"
                                          Margin="0,0,0,8"/>

                                <CheckBox Content="Possui Data de Validade"
                                          IsChecked="{Binding ProductHasExpirationDate}"
                                          Margin="0,0,0,8"/>

                                <CheckBox Content="Produto em Destaque"
                                          IsChecked="{Binding ProductIsFeatured}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                <CheckBox Content="Permite Pedido em Falta (Backorder)"
                                          IsChecked="{Binding ProductAllowBackorder}"
                                          Margin="0,0,0,8"/>
                            </StackPanel>
                        </Grid>

                        <!-- Botões de Ação -->
                        <Grid Margin="0,16,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Button Grid.Column="1"
                                    Command="{Binding CancelProductCommand}"
                                    Style="{StaticResource MaterialDesignFlatButton}"
                                    Content="Cancelar"
                                    Margin="0,0,8,0"/>

                            <Button Grid.Column="2"
                                    Command="{Binding SaveProductCommand}"
                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                    Content="Salvar"/>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </materialDesign:Card>
        </Grid>

        <!-- Category Form Dialog -->
        <Grid Background="#AA000000" 
              Visibility="{Binding IsCategoryFormOpen, Converter={StaticResource BooleanToVisibilityConverter}}"
              Panel.ZIndex="999">
            <materialDesign:Card Width="500" 
                                 VerticalAlignment="Center"
                                 Padding="24">
                <StackPanel>
                    <TextBlock Text="{Binding CategoryId, Converter={StaticResource BoolToStringConverter}, ConverterParameter=Editar Categoria|Nova Categoria}"
                               Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                               Margin="0,0,0,24"/>

                    <TextBox Text="{Binding CategoryName, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="Nome da Categoria*"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"/>

                    <TextBox Text="{Binding CategoryCode}"
                             materialDesign:HintAssist.Hint="Código"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"/>

                    <TextBox Text="{Binding CategoryDescription}"
                             materialDesign:HintAssist.Hint="Descrição"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             AcceptsReturn="True"
                             MinLines="3"
                             Margin="0,0,0,16"/>

                    <CheckBox Content="Categoria Ativa"
                              IsChecked="{Binding CategoryIsActive}"
                              Margin="0,0,0,24"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="1"
                                Command="{Binding CancelCategoryCommand}"
                                Style="{StaticResource MaterialDesignFlatButton}"
                                Content="Cancelar"
                                Margin="0,0,8,0"/>

                        <Button Grid.Column="2"
                                Command="{Binding SaveCategoryCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Content="Salvar"/>
                    </Grid>
                </StackPanel>
            </materialDesign:Card>
        </Grid>

        <!-- Expiration Form Dialog -->
        <Grid Background="#AA000000" 
              Visibility="{Binding IsExpirationFormOpen, Converter={StaticResource BooleanToVisibilityConverter}}"
              Panel.ZIndex="999">
            <materialDesign:Card Width="500" 
                                 VerticalAlignment="Center"
                                 Padding="24">
                <StackPanel>
                    <TextBlock Text="{Binding ExpirationId, Converter={StaticResource BoolToStringConverter}, ConverterParameter=Editar Validade|Nova Validade}"
                               Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                               Margin="0,0,0,24"/>

                    <DatePicker SelectedDate="{Binding ExpirationDate}"
                                materialDesign:HintAssist.Hint="Data de Validade*"
                                Style="{StaticResource MaterialDesignOutlinedDatePicker}"
                                Margin="0,0,0,8"/>

                    <!-- Calculadora de dias -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <materialDesign:PackIcon Kind="CalendarClock" 
                                                 VerticalAlignment="Center"
                                                 Margin="0,0,8,0"
                                                 Foreground="#757575"/>
                        <TextBlock VerticalAlignment="Center" Foreground="#757575" FontSize="12">
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}Vence em {0} dias a partir de hoje">
                                    <Binding Path="ExpirationDate" Converter="{StaticResource DaysFromNowConverter}"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </StackPanel>

                    <TextBox Text="{Binding ExpirationQuantity}"
                             materialDesign:HintAssist.Hint="Quantidade*"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"/>

                    <TextBox Text="{Binding BatchNumber}"
                             materialDesign:HintAssist.Hint="Número do Lote"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"/>

                    <TextBox Text="{Binding ExpirationNotes}"
                             materialDesign:HintAssist.Hint="Observações"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             AcceptsReturn="True"
                             MinLines="3"
                             Margin="0,0,0,24"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="1"
                                Command="{Binding CancelExpirationCommand}"
                                Style="{StaticResource MaterialDesignFlatButton}"
                                Content="Cancelar"
                                Margin="0,0,8,0"/>

                        <Button Grid.Column="2"
                                Command="{Binding SaveExpirationCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Content="Salvar"/>
                    </Grid>
                </StackPanel>
            </materialDesign:Card>
        </Grid>

        <!-- Stock Movement Form Dialog -->
        <Grid Background="#AA000000" 
              Visibility="{Binding IsMovementFormOpen, Converter={StaticResource BooleanToVisibilityConverter}}"
              Panel.ZIndex="999">
            <materialDesign:Card Width="500" 
                                 VerticalAlignment="Center"
                                 Padding="24">
                <StackPanel>
                    <TextBlock Text="Nova Movimentação de Estoque"
                               Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                               Margin="0,0,0,24"/>

                    <ComboBox SelectedItem="{Binding MovementType}"
                              materialDesign:HintAssist.Hint="Tipo de Movimentação*"
                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                              Margin="0,0,0,16">
                        <entities:StockMovementType>Entry</entities:StockMovementType>
                        <entities:StockMovementType>Exit</entities:StockMovementType>
                        <entities:StockMovementType>Adjustment</entities:StockMovementType>
                        <entities:StockMovementType>Transfer</entities:StockMovementType>
                        <entities:StockMovementType>Return</entities:StockMovementType>
                        <entities:StockMovementType>Loss</entities:StockMovementType>
                    </ComboBox>

                    <TextBox Text="{Binding MovementQuantity}"
                             materialDesign:HintAssist.Hint="Quantidade*"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"/>

                    <TextBox Text="{Binding MovementUnitCost, StringFormat=N2}"
                             materialDesign:HintAssist.Hint="Custo Unitário"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"/>

                    <TextBox Text="{Binding MovementTotalCost, StringFormat=N2}"
                             materialDesign:HintAssist.Hint="Custo Total"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             IsReadOnly="True"
                             Margin="0,0,0,16"/>

                    <TextBox Text="{Binding MovementNotes}"
                             materialDesign:HintAssist.Hint="Observações"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             AcceptsReturn="True"
                             MinLines="3"
                             Margin="0,0,0,24"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="1"
                                Command="{Binding CancelMovementCommand}"
                                Style="{StaticResource MaterialDesignFlatButton}"
                                Content="Cancelar"
                                Margin="0,0,8,0"/>

                        <Button Grid.Column="2"
                                Command="{Binding SaveMovementCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Content="Salvar"/>
                    </Grid>
                </StackPanel>
            </materialDesign:Card>
        </Grid>
    </Grid>
</Page>
