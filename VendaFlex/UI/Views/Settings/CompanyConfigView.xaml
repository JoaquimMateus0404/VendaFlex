<Page x:Class="VendaFlex.UI.Views.Settings.CompanyConfigView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:converters="clr-namespace:VendaFlex.Infrastructure.Converters"
      mc:Ignorable="d" 
      d:DesignHeight="800" d:DesignWidth="1200"
      Background="#F5F7FA"
      TextOptions.TextFormattingMode="Display"
      TextOptions.TextRenderingMode="ClearType"
      UseLayoutRounding="True"
      SnapsToDevicePixels="True"
      Loaded="Page_Loaded">

    <Page.Resources>
        <converters:StringToImageSourceConverter x:Key="StringToImageSourceConverter"/>
        <materialDesign:BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <converters:BoolToStringConverter x:Key="BoolToStringConverter"/>
        <converters:BoolToIconConverter x:Key="BoolToIconConverter"/>


        <!-- Modern Card Style -->
        <Style x:Key="ConfigCard" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="24"/>
            <Setter Property="Margin" Value="0,0,0,20"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.08" Color="#000000"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Section Title Style -->
        <Style x:Key="SectionTitle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#1E293B"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
        </Style>

        <!-- Input Label Style -->
        <Style x:Key="InputLabel" TargetType="TextBlock" BasedOn="{StaticResource MaterialDesignBodyMediumTextBlock}">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="#475569"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
        </Style>

        <!-- TextBox Style -->
        <Style x:Key="ModernTextBox" TargetType="TextBox" BasedOn="{StaticResource MaterialDesignOutlinedTextBox}">
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="FontSize" Value="14"/> 
            <Setter Property="materialDesign:TextFieldAssist.UnderlineBrush" Value="#3B82F6"/>
        </Style>

        <!-- ComboBox Style -->
        <Style x:Key="ModernComboBox" TargetType="ComboBox" BasedOn="{StaticResource MaterialDesignFloatingHintComboBox}">
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>

        <!-- Tab Header Style -->
        <Style x:Key="TabHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="8,0,0,0"/>
        </Style>
    </Page.Resources>

    <Grid>
        <!-- Main Container -->
        <Grid Margin="32">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Margin="0,0,0,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Title Section -->
                <StackPanel Grid.Column="0">
                    <TextBlock Text="Configurações da Empresa" 
                               FontSize="32" 
                               FontWeight="Bold" 
                               Foreground="#1E293B"/>
                    <TextBlock Text="Gerencie as informações e preferências da sua empresa" 
                               FontSize="14" 
                               Foreground="#64748B" 
                               Margin="0,4,0,0"/>
                </StackPanel>

                <!-- Status Badge -->
                <Border Grid.Column="1" 
                        VerticalAlignment="Center"
                        Background="{Binding IsActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#10B981|#EF4444'}"
                        CornerRadius="16"
                        Padding="16,8">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="{Binding IsActive, Converter={StaticResource BoolToIconConverter}, ConverterParameter='CheckCircle|AlertCircle'}" 
                                                Width="18" 
                                                Height="18"
                                                Foreground="White"
                                                VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding IsActive, Converter={StaticResource BoolToStringConverter}, ConverterParameter='Ativa|Inativa'}" 
                                   FontWeight="SemiBold"
                                   FontSize="13"
                                   Foreground="White"
                                   Margin="8,0,0,0"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Tabs Content -->
            <TabControl Grid.Row="1" 
                       Style="{StaticResource MaterialDesignNavigationRailTabControl}"
                       SelectedIndex="{Binding SelectedTabIndex, Mode=TwoWay}">

                <!-- Tab 1: Informações Gerais -->
                <TabItem Height="82" Width="144">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal" Margin="8">
                            <materialDesign:PackIcon Kind="Domain" 
                                                    Width="20" 
                                                    Height="20"
                                                    VerticalAlignment="Center"/>
                            <TextBlock Text="Geral" Style="{StaticResource TabHeaderStyle}"/>
                        </StackPanel>
                    </TabItem.Header>

                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                        <StackPanel MaxWidth="900">
                            <!-- Logo Section -->
                            <Border Style="{StaticResource ConfigCard}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Logo Preview -->
                                    <Border Grid.Column="0"
                                           Width="120" 
                                           Height="120"
                                           Background="#F1F5F9"
                                           CornerRadius="12"
                                           BorderBrush="#E2E8F0"
                                           BorderThickness="2"
                                           Margin="0,0,24,0">
                                        <Grid>
                                            <!-- Placeholder -->
                                            <StackPanel VerticalAlignment="Center" 
                                                       HorizontalAlignment="Center"
                                                       Visibility="{Binding HasLogo, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                                <materialDesign:PackIcon Kind="ImageOutline" 
                                                                        Width="48" 
                                                                        Height="48"
                                                                        Foreground="#94A3B8"/>
                                                <TextBlock Text="Sem Logo" 
                                                          FontSize="11" 
                                                          Foreground="#94A3B8"
                                                          HorizontalAlignment="Center"
                                                          Margin="0,8,0,0"/>
                                            </StackPanel>

                                            <!-- Logo Image -->
                                            <Image Source="{Binding LogoUrl, Converter={StaticResource StringToImageSourceConverter}}"
                                                  Stretch="Uniform"
                                                  Visibility="{Binding HasLogo, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        </Grid>
                                    </Border>

                                    <!-- Logo Actions -->
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <TextBlock Text="Logo da Empresa" 
                                                  Style="{StaticResource SectionTitle}"
                                                  Margin="0,0,0,8"/>
                                        <TextBlock Text="Adicione o logotipo da sua empresa para aparecer nas faturas e documentos."
                                                  FontSize="13"
                                                  Foreground="#64748B"
                                                  TextWrapping="Wrap"
                                                  Margin="0,0,0,16"/>

                                        <StackPanel Orientation="Horizontal">
                                            <Button Command="{Binding UploadLogoCommand}"
                                                   Style="{StaticResource MaterialDesignOutlinedButton}"
                                                   Height="40"
                                                   Padding="20,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="Upload" 
                                                                            Width="18" 
                                                                            Height="18"
                                                                            VerticalAlignment="Center"/>
                                                    <TextBlock Text="Selecionar Logo" 
                                                              Margin="8,0,0,0"
                                                              VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Button>

                                            <Button Command="{Binding RemoveLogoCommand}"
                                                   Style="{StaticResource MaterialDesignOutlinedButton}"
                                                   Height="40"
                                                   Padding="20,0"
                                                   Margin="12,0,0,0"
                                                   Visibility="{Binding HasLogo, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="Delete" 
                                                                            Width="18" 
                                                                            Height="18"
                                                                            VerticalAlignment="Center"/>
                                                    <TextBlock Text="Remover" 
                                                              Margin="8,0,0,0"
                                                              VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Button>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- Company Information -->
                            <Border Style="{StaticResource ConfigCard}">
                                <StackPanel>
                                    <TextBlock Text="Informações da Empresa" Style="{StaticResource SectionTitle}"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="16"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Left Column -->
                                        <StackPanel Grid.Column="0">
                                            <!-- Company Name -->
                                            <TextBlock Text="Nome da Empresa *" Style="{StaticResource InputLabel}"/>
                                            <TextBox Text="{Binding CompanyName, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource ModernTextBox}"
                                                    materialDesign:HintAssist.Hint="Digite o nome da empresa"/>
                                            <TextBlock Text="{Binding CompanyNameError}"
                                                      Foreground="#EF4444"
                                                      FontSize="12"
                                                      Margin="0,-12,0,8"
                                                      Visibility="{Binding CompanyNameError, Converter={StaticResource NullToVisibilityConverter}}"/>

                                            <!-- Industry Type -->
                                            <TextBlock Text="Tipo de Negócio" Style="{StaticResource InputLabel}"/>
                                            <ComboBox ItemsSource="{Binding IndustryTypes}"
                                                     SelectedItem="{Binding IndustryType}"
                                                     Style="{StaticResource ModernComboBox}"
                                                     materialDesign:HintAssist.Hint="Selecione o setor"
                                                     IsEditable="True"/>

                                            <!-- Tax ID -->
                                            <TextBlock Text="NIF / Número Fiscal" Style="{StaticResource InputLabel}"/>
                                            <TextBox Text="{Binding TaxId, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource ModernTextBox}"
                                                    materialDesign:HintAssist.Hint="Ex: 5000123456"/>
                                        </StackPanel>

                                        <!-- Right Column -->
                                        <StackPanel Grid.Column="2">
                                            <!-- Tax Regime -->
                                            <TextBlock Text="Regime Fiscal" Style="{StaticResource InputLabel}"/>
                                            <ComboBox ItemsSource="{Binding TaxRegimes}"
                                                     SelectedItem="{Binding TaxRegime}"
                                                     Style="{StaticResource ModernComboBox}"
                                                     materialDesign:HintAssist.Hint="Selecione o regime"
                                                     IsEditable="True"/>

                                            <!-- Business Hours -->
                                            <TextBlock Text="Horário de Funcionamento" Style="{StaticResource InputLabel}"/>
                                            <TextBox Text="{Binding BusinessHours, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource ModernTextBox}"
                                                    materialDesign:HintAssist.Hint="Ex: Seg-Sex 8h-18h"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Contact Information -->
                            <Border Style="{StaticResource ConfigCard}">
                                <StackPanel>
                                    <TextBlock Text="Informações de Contato" Style="{StaticResource SectionTitle}"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="16"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Left Column -->
                                        <StackPanel Grid.Column="0">
                                            <!-- Phone -->
                                            <TextBlock Text="Telefone" Style="{StaticResource InputLabel}"/>
                                            <TextBox Text="{Binding PhoneNumber, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource ModernTextBox}"
                                                    materialDesign:HintAssist.Hint="Ex: +244 123 456 789"/>

                                            <!-- Website -->
                                            <TextBlock Text="Website" Style="{StaticResource InputLabel}"/>
                                            <TextBox Text="{Binding Website, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource ModernTextBox}"
                                                    materialDesign:HintAssist.Hint="Ex: www.empresa.ao"/>
                                        </StackPanel>

                                        <!-- Right Column -->
                                        <StackPanel Grid.Column="2">
                                            <!-- Email -->
                                            <TextBlock Text="Email" Style="{StaticResource InputLabel}"/>
                                            <TextBox Text="{Binding Email, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource ModernTextBox}"
                                                    materialDesign:HintAssist.Hint="contato@empresa.ao"/>
                                            <TextBlock Text="{Binding EmailError}"
                                                      Foreground="#EF4444"
                                                      FontSize="12"
                                                      Margin="0,-12,0,8"
                                                      Visibility="{Binding EmailError, Converter={StaticResource NullToVisibilityConverter}}"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Tab 2: Endereço -->
                <TabItem Height="86" Width="140">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal" Margin="8">
                            <materialDesign:PackIcon Kind="MapMarker" 
                                                    Width="20" 
                                                    Height="20"
                                                    VerticalAlignment="Center"/>
                            <TextBlock Text="Endereço" Style="{StaticResource TabHeaderStyle}"/>
                        </StackPanel>
                    </TabItem.Header>

                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                        <StackPanel MaxWidth="900">
                            <Border Style="{StaticResource ConfigCard}">
                                <StackPanel>
                                    <TextBlock Text="Localização" Style="{StaticResource SectionTitle}"/>

                                    <!-- Address -->
                                    <TextBlock Text="Endereço Completo" Style="{StaticResource InputLabel}"/>
                                    <TextBox Text="{Binding Address, UpdateSourceTrigger=PropertyChanged}"
                                            Style="{StaticResource ModernTextBox}"
                                            materialDesign:HintAssist.Hint="Rua, Avenida, Número"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="16"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Left Column -->
                                        <StackPanel Grid.Column="0">
                                            <!-- City -->
                                            <TextBlock Text="Cidade" Style="{StaticResource InputLabel}"/>
                                            <TextBox Text="{Binding City, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource ModernTextBox}"
                                                    materialDesign:HintAssist.Hint="Ex: Luanda"/>

                                            <!-- Country -->
                                            <TextBlock Text="País" Style="{StaticResource InputLabel}"/>
                                            <ComboBox ItemsSource="{Binding Countries}"
                                                     SelectedItem="{Binding Country}"
                                                     Style="{StaticResource ModernComboBox}"
                                                     materialDesign:HintAssist.Hint="Selecione o país"
                                                     IsEditable="True"/>
                                        </StackPanel>

                                        <!-- Right Column -->
                                        <StackPanel Grid.Column="2">
                                            <!-- Postal Code -->
                                            <TextBlock Text="Código Postal" Style="{StaticResource InputLabel}"/>
                                            <TextBox Text="{Binding PostalCode, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource ModernTextBox}"
                                                    materialDesign:HintAssist.Hint="Ex: 1000"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Map Placeholder (Future Enhancement) -->
                            <Border Style="{StaticResource ConfigCard}" 
                                   Height="300"
                                   Background="#F8FAFC">
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <materialDesign:PackIcon Kind="Map" 
                                                            Width="64" 
                                                            Height="64"
                                                            Foreground="#CBD5E1"/>
                                    <TextBlock Text="Visualização de Mapa" 
                                              FontSize="16"
                                              Foreground="#94A3B8"
                                              Margin="0,16,0,4"/>
                                    <TextBlock Text="Recurso disponível em breve" 
                                              FontSize="13"
                                              Foreground="#CBD5E1"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Tab 3: Configurações Fiscais -->
                <TabItem Width="144">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal" Margin="8">
                            <materialDesign:PackIcon Kind="CurrencyUsd" 
                                                    Width="20" 
                                                    Height="20"
                                                    VerticalAlignment="Center"/>
                            <TextBlock Text="Fiscal" Style="{StaticResource TabHeaderStyle}"/>
                        </StackPanel>
                    </TabItem.Header>

                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                        <StackPanel MaxWidth="900">
                            <!-- Currency Settings -->
                            <Border Style="{StaticResource ConfigCard}">
                                <StackPanel>
                                    <TextBlock Text="Moeda e Impostos" Style="{StaticResource SectionTitle}"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="16"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Left Column -->
                                        <StackPanel Grid.Column="0">
                                            <!-- Currency -->
                                            <TextBlock Text="Moeda" Style="{StaticResource InputLabel}"/>
                                            <ComboBox ItemsSource="{Binding Currencies}"
                                                     SelectedItem="{Binding SelectedCurrency}"
                                                     DisplayMemberPath="DisplayText"
                                                     Style="{StaticResource ModernComboBox}"
                                                     materialDesign:HintAssist.Hint="Selecione a moeda"/>

                                            <!-- Tax Rate -->
                                            <TextBlock Text="Taxa de Imposto Padrão (%)" Style="{StaticResource InputLabel}"/>
                                            <TextBox Text="{Binding DefaultTaxRate, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"
                                                    Style="{StaticResource ModernTextBox}"
                                                    materialDesign:HintAssist.Hint="Ex: 14.00"/>
                                            <TextBlock Text="{Binding TaxRateError}"
                                                      Foreground="#EF4444"
                                                      FontSize="12"
                                                      Margin="0,-12,0,8"
                                                      Visibility="{Binding TaxRateError, Converter={StaticResource NullToVisibilityConverter}}"/>
                                        </StackPanel>

                                        <!-- Right Column -->
                                        <StackPanel Grid.Column="2">
                                            <!-- Info Panel -->
                                            <Border Background="#EFF6FF"
                                                   BorderBrush="#3B82F6"
                                                   BorderThickness="1"
                                                   CornerRadius="8"
                                                   Padding="16"
                                                   Margin="0,28,0,0">
                                                <StackPanel>
                                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                        <materialDesign:PackIcon Kind="InformationOutline" 
                                                                                Width="20" 
                                                                                Height="20"
                                                                                Foreground="#3B82F6"
                                                                                VerticalAlignment="Top"
                                                                                Margin="0,2,0,0"/>
                                                        <TextBlock Text="Informações Fiscais" 
                                                                  FontWeight="SemiBold"
                                                                  FontSize="14"
                                                                  Foreground="#1E40AF"
                                                                  Margin="8,0,0,0"/>
                                                    </StackPanel>
                                                    <TextBlock TextWrapping="Wrap"
                                                              FontSize="13"
                                                              Foreground="#1E40AF">
                                                        <Run Text="A taxa de imposto padrão será aplicada automaticamente nas vendas. "/>
                                                        <Run Text="Você pode alterar a taxa individualmente em cada produto ou fatura."/>
                                                    </TextBlock>
                                                </StackPanel>
                                            </Border>

                                            <!-- Currency Preview -->
                                            <Border Background="#F8FAFC"
                                                   BorderBrush="#E2E8F0"
                                                   BorderThickness="1"
                                                   CornerRadius="8"
                                                   Padding="16"
                                                   Margin="0,16,0,0">
                                                <StackPanel>
                                                    <TextBlock Text="Exemplo de Formatação" 
                                                              FontWeight="SemiBold"
                                                              FontSize="13"
                                                              Foreground="#475569"
                                                              Margin="0,0,0,8"/>
                                                    <TextBlock FontSize="24"
                                                              FontWeight="Bold"
                                                              Foreground="#1E293B"
                                                              HorizontalAlignment="Center">
                                                        <Run Text="{Binding CurrencySymbol}"/>
                                                        <Run Text=" 1.000,00"/>
                                                    </TextBlock>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Tab 4: Configurações de Fatura -->
                <TabItem Height="86" Width="144">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal" Margin="8">
                            <materialDesign:PackIcon Kind="Receipt" 
                                                    Width="20" 
                                                    Height="20"
                                                    VerticalAlignment="Center"/>
                            <TextBlock Text="Faturas" Style="{StaticResource TabHeaderStyle}"/>
                        </StackPanel>
                    </TabItem.Header>

                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                        <StackPanel MaxWidth="900">
                            <!-- Invoice Numbering -->
                            <Border Style="{StaticResource ConfigCard}">
                                <StackPanel>
                                    <TextBlock Text="Numeração de Faturas" Style="{StaticResource SectionTitle}"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="16"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Left Column -->
                                        <StackPanel Grid.Column="0">
                                            <!-- Prefix -->
                                            <TextBlock Text="Prefixo da Fatura" Style="{StaticResource InputLabel}"/>
                                            <TextBox Text="{Binding InvoicePrefix, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource ModernTextBox}"
                                                    materialDesign:HintAssist.Hint="Ex: INV, FAT, FT"
                                                    MaxLength="10"/>

                                            <!-- Next Number -->
                                            <TextBlock Text="Próximo Número" Style="{StaticResource InputLabel}"/>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBox Grid.Column="0"
                                                        Text="{Binding NextInvoiceNumber, UpdateSourceTrigger=PropertyChanged}"
                                                        Style="{StaticResource ModernTextBox}"
                                                        materialDesign:HintAssist.Hint="Ex: 1"/>

                                                <Button Grid.Column="1"
                                                       Command="{Binding TestInvoiceNumberCommand}"
                                                       Style="{StaticResource MaterialDesignIconButton}"
                                                       ToolTip="Testar Numeração"
                                                       Margin="8,0,0,16"
                                                       Height="40"
                                                       Width="40">
                                                    <materialDesign:PackIcon Kind="TestTube" 
                                                                            Width="20" 
                                                                            Height="20"/>
                                                </Button>
                                            </Grid>
                                        </StackPanel>

                                        <!-- Right Column -->
                                        <StackPanel Grid.Column="2">
                                            <!-- Preview -->
                                            <TextBlock Text="Visualização" Style="{StaticResource InputLabel}"/>
                                            <Border Background="#F8FAFC"
                                                   BorderBrush="#3B82F6"
                                                   BorderThickness="2"
                                                   CornerRadius="8"
                                                   Padding="24"
                                                   Height="80"
                                                   Margin="0,0,0,16">
                                                <TextBlock Text="{Binding InvoicePreview}"
                                                          FontSize="28"
                                                          FontWeight="Bold"
                                                          Foreground="#3B82F6"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                            </Border>

                                            <TextBlock Text="Este será o formato das próximas faturas"
                                                      FontSize="12"
                                                      Foreground="#64748B"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,-12,0,0"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Invoice Format -->
                            <Border Style="{StaticResource ConfigCard}">
                                <StackPanel>
                                    <TextBlock Text="Formato de Impressão" Style="{StaticResource SectionTitle}"/>

                                    <!-- Format Selection -->
                                    <TextBlock Text="Tipo de Impressora" Style="{StaticResource InputLabel}"/>
                                    <ComboBox ItemsSource="{Binding InvoiceFormats}"
                                             SelectedItem="{Binding SelectedInvoiceFormat}"
                                             DisplayMemberPath="Name"
                                             Style="{StaticResource ModernComboBox}"
                                             materialDesign:HintAssist.Hint="Selecione o formato"/>

                                    <!-- Format Description -->
                                    <Border Background="#F1F5F9"
                                           BorderBrush="#E2E8F0"
                                           BorderThickness="1"
                                           CornerRadius="8"
                                           Padding="16"
                                           Margin="0,0,0,16"
                                           Visibility="{Binding SelectedInvoiceFormat, Converter={StaticResource NullToVisibilityConverter}}">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="Printer" 
                                                                    Width="20" 
                                                                    Height="20"
                                                                    Foreground="#64748B"
                                                                    VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding SelectedInvoiceFormat.Description}"
                                                      FontSize="13"
                                                      Foreground="#475569"
                                                      Margin="12,0,0,0"
                                                      VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Border>

                            <!-- Invoice Options -->
                            <Border Style="{StaticResource ConfigCard}">
                                <StackPanel>
                                    <TextBlock Text="Opções de Fatura" Style="{StaticResource SectionTitle}"/>

                                    <!-- Include Customer Data -->
                                    <CheckBox IsChecked="{Binding IncludeCustomerData}"
                                             Margin="0,0,0,16">
                                        <StackPanel Margin="8,0,0,0">
                                            <TextBlock Text="Incluir Dados do Cliente"
                                                      FontWeight="Medium"
                                                      FontSize="14"/>
                                            <TextBlock Text="Exibe nome, NIF e endereço do cliente na fatura"
                                                      FontSize="12"
                                                      Foreground="#64748B"
                                                      Margin="0,2,0,0"/>
                                        </StackPanel>
                                    </CheckBox>

                                    <!-- Allow Anonymous Invoice -->
                                    <CheckBox IsChecked="{Binding AllowAnonymousInvoice}"
                                             Margin="0,0,0,16">
                                        <StackPanel Margin="8,0,0,0">
                                            <TextBlock Text="Permitir Faturas Anônimas"
                                                      FontWeight="Medium"
                                                      FontSize="14"/>
                                            <TextBlock Text="Permite emitir faturas sem identificação do cliente"
                                                      FontSize="12"
                                                      Foreground="#64748B"
                                                      Margin="0,2,0,0"/>
                                        </StackPanel>
                                    </CheckBox>

                                    <!-- Footer Text -->
                                    <TextBlock Text="Texto do Rodapé" Style="{StaticResource InputLabel}"/>
                                    <TextBox Text="{Binding InvoiceFooterText, UpdateSourceTrigger=PropertyChanged}"
                                            Style="{StaticResource ModernTextBox}"
                                            materialDesign:HintAssist.Hint="Mensagem personalizada no rodapé da fatura"
                                            AcceptsReturn="True"
                                            TextWrapping="Wrap"
                                            MinLines="3"
                                            MaxLength="1000"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Tab 5: Preferências -->
                <TabItem Height="76" Width="143">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal" Margin="8">
                            <materialDesign:PackIcon Kind="Cog" 
                                                    Width="20" 
                                                    Height="20"
                                                    VerticalAlignment="Center"/>
                            <TextBlock Text="Preferências" Style="{StaticResource TabHeaderStyle}"/>
                        </StackPanel>
                    </TabItem.Header>

                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                        <StackPanel MaxWidth="900">
                            <!-- Status Settings -->
                            <Border Style="{StaticResource ConfigCard}">
                                <StackPanel>
                                    <TextBlock Text="Estado da Configuração" Style="{StaticResource SectionTitle}"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Status Icon -->
                                        <Border Grid.Column="0"
                                               Width="80"
                                               Height="80"
                                               Background="{Binding IsActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#DCFCE7|#FEE2E2'}"
                                               CornerRadius="40"
                                               Margin="0,0,24,0">
                                            <materialDesign:PackIcon Kind="{Binding IsActive, Converter={StaticResource BoolToIconConverter}, ConverterParameter='CheckCircle|AlertCircle'}"
                                                                    Width="40"
                                                                    Height="40"
                                                                    Foreground="{Binding IsActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#16A34A|#DC2626'}"
                                                                    HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center"/>
                                        </Border>

                                        <!-- Status Actions -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock FontSize="18"
                                                      FontWeight="SemiBold"
                                                      Foreground="#1E293B"
                                                      Margin="0,0,0,8">
                                                <Run Text="Configuração"/>
                                                <Run Text="{Binding IsActive, Converter={StaticResource BoolToStringConverter}, ConverterParameter='Ativa|Inativa'}"/>
                                            </TextBlock>

                                            <TextBlock Text="{Binding IsActive, Converter={StaticResource BoolToStringConverter}, ConverterParameter='O sistema está operando normalmente com esta configuração.|Esta configuração está desativada e não será utilizada pelo sistema.'}"
                                                      FontSize="13"
                                                      Foreground="#64748B"
                                                      TextWrapping="Wrap"
                                                      Margin="0,0,0,16"/>

                                            <StackPanel Orientation="Horizontal">
                                                <Button Command="{Binding ActivateCommand}"
                                                       Style="{StaticResource MaterialDesignRaisedButton}"
                                                       Background="#10B981"
                                                       BorderBrush="#10B981"
                                                       Height="40"
                                                       Padding="24,0"
                                                       Visibility="{Binding IsActive, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <materialDesign:PackIcon Kind="CheckCircle" 
                                                                                Width="18" 
                                                                                Height="18"
                                                                                VerticalAlignment="Center"/>
                                                        <TextBlock Text="Ativar Configuração" 
                                                                  Margin="8,0,0,0"
                                                                  VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Button>

                                                <Button Command="{Binding DeactivateCommand}"
                                                       Style="{StaticResource MaterialDesignOutlinedButton}"
                                                       Foreground="#EF4444"
                                                       BorderBrush="#EF4444"
                                                       Height="40"
                                                       Padding="24,0"
                                                       Visibility="{Binding IsActive, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <materialDesign:PackIcon Kind="Cancel" 
                                                                                Width="18" 
                                                                                Height="18"
                                                                                VerticalAlignment="Center"/>
                                                        <TextBlock Text="Desativar" 
                                                                  Margin="8,0,0,0"
                                                                  VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Button>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- System Info -->
                            <Border Style="{StaticResource ConfigCard}">
                                <StackPanel>
                                    <TextBlock Text="Informações do Sistema" Style="{StaticResource SectionTitle}"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Info Item 1 -->
                                        <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                            <Border Background="#F8FAFC"
                                                   BorderBrush="#E2E8F0"
                                                   BorderThickness="1"
                                                   CornerRadius="8"
                                                   Padding="16">
                                                <StackPanel>
                                                    <TextBlock Text="Versão do Sistema" 
                                                              FontSize="12"
                                                              Foreground="#64748B"
                                                              Margin="0,0,0,4"/>
                                                    <TextBlock Text="1.0.0" 
                                                              FontSize="18"
                                                              FontWeight="SemiBold"
                                                              Foreground="#1E293B"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>

                                        <!-- Info Item 2 -->
                                        <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                            <Border Background="#F8FAFC"
                                                   BorderBrush="#E2E8F0"
                                                   BorderThickness="1"
                                                   CornerRadius="8"
                                                   Padding="16">
                                                <StackPanel>
                                                    <TextBlock Text="Última Atualização" 
                                                              FontSize="12"
                                                              Foreground="#64748B"
                                                              Margin="0,0,0,4"/>
                                                    <TextBlock Text="Há alguns instantes" 
                                                              FontSize="18"
                                                              FontWeight="SemiBold"
                                                              Foreground="#1E293B"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
            </TabControl>

            <!-- Footer Actions -->
            <Border Grid.Row="2" 
                   Background="White"
                   BorderBrush="#E2E8F0"
                   BorderThickness="0,1,0,0"
                   Padding="24,20"
                   Margin="-32,24,-32,-32">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Status Message -->
                    <StackPanel Grid.Column="0" 
                               VerticalAlignment="Center"
                               Orientation="Horizontal"
                               Visibility="{Binding StatusMessage, Converter={StaticResource NullToVisibilityConverter}}">
                        <materialDesign:PackIcon Kind="{Binding IsStatusError, Converter={StaticResource BoolToIconConverter}, ConverterParameter='AlertCircle|CheckCircle'}"
                                                Width="20"
                                                Height="20"
                                                Foreground="{Binding IsStatusError, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#EF4444|#10B981'}"
                                                VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding StatusMessage}"
                                  FontSize="14"
                                  Foreground="{Binding IsStatusError, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#EF4444|#10B981'}"
                                  Margin="8,0,0,0"
                                  VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Action Buttons -->
                    <StackPanel Grid.Column="1" 
                               Orientation="Horizontal"
                               HorizontalAlignment="Right">
                        <!-- Cancel Button -->
                        <Button Command="{Binding CancelCommand}"
                               Style="{StaticResource MaterialDesignOutlinedButton}"
                               Height="44"
                               Padding="32,0"
                               Margin="0,0,12,0">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Close" 
                                                        Width="18" 
                                                        Height="18"
                                                        VerticalAlignment="Center"/>
                                <TextBlock Text="Cancelar" 
                                          Margin="8,0,0,0"
                                          VerticalAlignment="Center"
                                          FontSize="14"/>
                            </StackPanel>
                        </Button>

                        <!-- Save Button -->
                        <Button Command="{Binding SaveCommand}"
                               Style="{StaticResource MaterialDesignRaisedButton}"
                               Background="#3B82F6"
                               BorderBrush="#3B82F6"
                               Height="44"
                               Padding="32,0">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="ContentSave" 
                                                        Width="18" 
                                                        Height="18"
                                                        VerticalAlignment="Center"/>
                                <TextBlock Text="Salvar Alterações" 
                                          Margin="8,0,0,0"
                                          VerticalAlignment="Center"
                                          FontSize="14"
                                          FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Loading Overlay -->
        <Border Background="#80000000"
               Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                            Value="0"
                            IsIndeterminate="True"
                            Width="60"
                            Height="60"
                            Foreground="White"/>
                <TextBlock Text="Carregando configurações..."
                          FontSize="16"
                          Foreground="White"
                          Margin="0,16,0,0"
                          HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</Page>
