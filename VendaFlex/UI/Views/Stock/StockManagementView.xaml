<Page x:Class="VendaFlex.UI.Views.Stock.StockManagementView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:converters="clr-namespace:VendaFlex.Infrastructure.Converters"
      xmlns:entities="clr-namespace:VendaFlex.Data.Entities"
      xmlns:sys="clr-namespace:System;assembly=mscorlib"
      mc:Ignorable="d"
      d:DesignHeight="800" d:DesignWidth="1400"
      Background="{DynamicResource MaterialDesignPaper}">

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
        <converters:GreaterThanZeroToVisibilityConverter x:Key="GreaterThanZeroConverter"/>
        <converters:EnumToStringConverter x:Key="EnumToStringConverter"/>

        <ObjectDataProvider x:Key="MovementTypeValues" MethodName="GetValues"
                            ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="entities:StockMovementType"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <materialDesign:Card Grid.Row="0" Margin="16,16,16,8" Padding="20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Gerenciamento de Estoque"
                               Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                               FontWeight="Bold"/>
                    <TextBlock Text="Controle completo de estoque, movimentações e ajustes"
                               Style="{StaticResource MaterialDesignBody2TextBlock}"
                               Foreground="{DynamicResource MaterialDesignBodyLight}"
                               Margin="0,4,0,0"/>
                </StackPanel>

                <Button Grid.Column="1"
                        Command="{Binding RefreshCommand}"
                        Style="{StaticResource MaterialDesignIconButton}"
                        ToolTip="Atualizar dados"
                        Width="40" Height="40">
                    <materialDesign:PackIcon Kind="Refresh" Width="24" Height="24"/>
                </Button>
            </Grid>
        </materialDesign:Card>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="16,0,16,16">
            <materialDesign:Card>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Statistics Cards -->
                    <UniformGrid Grid.Row="0" Rows="1" Columns="5" Margin="16,16,16,8">
                        <!-- Total Products -->
                        <materialDesign:Card Margin="4" Background="#2196F3" Padding="16">
                            <StackPanel>
                                <materialDesign:PackIcon Kind="Package" 
                                                         Width="32" Height="32"
                                                         Foreground="White"
                                                         HorizontalAlignment="Left"/>
                                <TextBlock Text="{Binding TotalProducts}" 
                                           FontSize="28" FontWeight="Bold"
                                           Foreground="White" Margin="0,8,0,0"/>
                                <TextBlock Text="Total de Produtos" 
                                           FontSize="12" Foreground="White"
                                           Opacity="0.9"/>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- Low Stock -->
                        <materialDesign:Card Margin="4" Background="#FF9800" Padding="16">
                            <StackPanel>
                                <materialDesign:PackIcon Kind="AlertCircle" 
                                                         Width="32" Height="32"
                                                         Foreground="White"
                                                         HorizontalAlignment="Left"/>
                                <TextBlock Text="{Binding LowStockCount}" 
                                           FontSize="28" FontWeight="Bold"
                                           Foreground="White" Margin="0,8,0,0"/>
                                <TextBlock Text="Estoque Baixo" 
                                           FontSize="12" Foreground="White"
                                           Opacity="0.9"/>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- Out of Stock -->
                        <materialDesign:Card Margin="4" Background="#F44336" Padding="16">
                            <StackPanel>
                                <materialDesign:PackIcon Kind="AlertOctagon" 
                                                         Width="32" Height="32"
                                                         Foreground="White"
                                                         HorizontalAlignment="Left"/>
                                <TextBlock Text="{Binding OutOfStockCount}" 
                                           FontSize="28" FontWeight="Bold"
                                           Foreground="White" Margin="0,8,0,0"/>
                                <TextBlock Text="Sem Estoque" 
                                           FontSize="12" Foreground="White"
                                           Opacity="0.9"/>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- Total Value -->
                        <materialDesign:Card Margin="4" Background="#4CAF50" Padding="16">
                            <StackPanel>
                                <materialDesign:PackIcon Kind="CurrencyUsd" 
                                                         Width="32" Height="32"
                                                         Foreground="White"
                                                         HorizontalAlignment="Left"/>
                                <TextBlock Text="{Binding TotalStockValue, StringFormat={}{0:C2}}" 
                                           FontSize="28" FontWeight="Bold"
                                           Foreground="White" Margin="0,8,0,0"/>
                                <TextBlock Text="Valor Total" 
                                           FontSize="12" Foreground="White"
                                           Opacity="0.9"/>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- Today's Movements -->
                        <materialDesign:Card Margin="4" Background="#9C27B0" Padding="16">
                            <StackPanel>
                                <materialDesign:PackIcon Kind="TrendingUp" 
                                                         Width="32" Height="32"
                                                         Foreground="White"
                                                         HorizontalAlignment="Left"/>
                                <TextBlock Text="{Binding TotalMovementsToday}" 
                                           FontSize="28" FontWeight="Bold"
                                           Foreground="White" Margin="0,8,0,0"/>
                                <TextBlock Text="Movimentações Hoje" 
                                           FontSize="12" Foreground="White"
                                           Opacity="0.9"/>
                            </StackPanel>
                        </materialDesign:Card>
                    </UniformGrid>

                    <!-- Tabs -->
                    <TabControl Grid.Row="1" 
                                Style="{StaticResource MaterialDesignFilledTabControl}"
                                Margin="16,8,16,16">

                        <!-- Stocks Tab -->
                        <TabItem Header="Estoque Geral">
                            <Grid Margin="8">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Filters -->
                                <materialDesign:Card Grid.Row="0" Padding="16" Margin="0,0,0,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBox Grid.Column="0"
                                                 Text="{Binding SearchTerm, UpdateSourceTrigger=PropertyChanged}"
                                                 materialDesign:HintAssist.Hint="Buscar produto..."
                                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                                 Margin="0,0,8,0">
                                            <TextBox.InputBindings>
                                                <KeyBinding Key="Enter" Command="{Binding LoadStocksCommand}"/>
                                            </TextBox.InputBindings>
                                        </TextBox>

                                        <CheckBox Grid.Column="1"
                                                  IsChecked="{Binding ShowLowStockOnly}"
                                                  Content="Apenas Estoque Baixo"
                                                  Margin="8,0"/>

                                        <CheckBox Grid.Column="2"
                                                  IsChecked="{Binding ShowOutOfStockOnly}"
                                                  Content="Apenas Sem Estoque"
                                                  Margin="8,0"/>

                                        <Button Grid.Column="3"
                                                Command="{Binding ClearFiltersCommand}"
                                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                                Margin="8,0">
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="FilterRemove" 
                                                                         VerticalAlignment="Center"/>
                                                <TextBlock Text="Limpar" Margin="4,0,0,0"/>
                                            </StackPanel>
                                        </Button>

                                        <Button Grid.Column="4"
                                                Command="{Binding ExportStocksCommand}"
                                                Style="{StaticResource MaterialDesignRaisedButton}"
                                                Margin="8,0,0,0">
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="FileExport" 
                                                                         VerticalAlignment="Center"/>
                                                <TextBlock Text="Exportar" Margin="4,0,0,0"/>
                                            </StackPanel>
                                        </Button>
                                    </Grid>
                                </materialDesign:Card>

                                <!-- DataGrid -->
                                <materialDesign:Card Grid.Row="1" Padding="0">
                                    <DataGrid ItemsSource="{Binding FilteredStocks}"
                                              SelectedItem="{Binding SelectedStock}"
                                              AutoGenerateColumns="False"
                                              IsReadOnly="True"
                                              CanUserAddRows="False"
                                              CanUserDeleteRows="False"
                                              SelectionMode="Single"
                                              materialDesign:DataGridAssist.CellPadding="8"
                                              materialDesign:DataGridAssist.ColumnHeaderPadding="8">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Produto" 
                                                                Binding="{Binding ProductName}" 
                                                                Width="*"
                                                                MinWidth="200"/>

                                            <DataGridTextColumn Header="Quantidade" 
                                                                Binding="{Binding Quantity}" 
                                                                Width="100">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <DataGridTextColumn Header="Reservado" 
                                                                Binding="{Binding ReservedQuantity}" 
                                                                Width="100">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <DataGridTextColumn Header="Disponível" 
                                                                Binding="{Binding AvailableQuantity}" 
                                                                Width="100">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                        <Setter Property="Foreground" Value="{DynamicResource PrimaryHueMidBrush}"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <DataGridTextColumn Header="Mínimo" 
                                                                Binding="{Binding MinimumStock}" 
                                                                Width="100">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <DataGridTextColumn Header="Ponto de Reposição" 
                                                                Binding="{Binding ReorderPoint}" 
                                                                Width="150">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <DataGridTextColumn Header="Última Atualização" 
                                                                Binding="{Binding LastStockUpdate, StringFormat={}{0:dd/MM/yyyy HH:mm}}" 
                                                                Width="150"/>

                                            <DataGridTemplateColumn Header="Status" Width="120">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{Binding Quantity, Converter={StaticResource BoolToColorConverter}}"
                                                                CornerRadius="12" Padding="8,4">
                                                            <TextBlock Foreground="White"
                                                                       HorizontalAlignment="Center"
                                                                       FontSize="11"
                                                                       FontWeight="Bold">
                                                                <TextBlock.Style>
                                                                    <Style TargetType="TextBlock">
                                                                        <Setter Property="Text" Value="Normal"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding Quantity}" Value="0">
                                                                                <Setter Property="Text" Value="Sem Estoque"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </TextBlock.Style>
                                                            </TextBlock>
                                                        </Border>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>

                                            <DataGridTemplateColumn Header="Ações" Width="100">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Button Command="{Binding DataContext.AdjustStockCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                                CommandParameter="{Binding}"
                                                                Style="{StaticResource MaterialDesignIconButton}"
                                                                ToolTip="Ajustar Estoque">
                                                            <materialDesign:PackIcon Kind="Adjust"/>
                                                        </Button>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </materialDesign:Card>

                                <!-- Pagination -->
                                <materialDesign:Card Grid.Row="2" Padding="16" Margin="0,8,0,0">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" 
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,16,0">
                                            <Run Text="Mostrando"/>
                                            <Run Text="{Binding FilteredStocks.Count, Mode=OneWay}" FontWeight="Bold"/>
                                            <Run Text="de"/>
                                            <Run Text="{Binding TotalRecords, Mode=OneWay}" FontWeight="Bold"/>
                                            <Run Text="registros"/>
                                        </TextBlock>

                                        <StackPanel Grid.Column="1" 
                                                    Orientation="Horizontal"
                                                    HorizontalAlignment="Center">
                                            <Button Command="{Binding FirstPageCommand}"
                                                    Style="{StaticResource MaterialDesignIconButton}"
                                                    ToolTip="Primeira Página">
                                                <materialDesign:PackIcon Kind="PageFirst"/>
                                            </Button>
                                            <Button Command="{Binding PreviousPageCommand}"
                                                    Style="{StaticResource MaterialDesignIconButton}"
                                                    ToolTip="Página Anterior">
                                                <materialDesign:PackIcon Kind="ChevronLeft"/>
                                            </Button>

                                            <TextBlock VerticalAlignment="Center" Margin="16,0">
                                                <Run Text="Página"/>
                                                <Run Text="{Binding CurrentPage, Mode=OneWay}" FontWeight="Bold"/>
                                                <Run Text="de"/>
                                                <Run Text="{Binding TotalPages, Mode=OneWay}" FontWeight="Bold"/>
                                            </TextBlock>

                                            <Button Command="{Binding NextPageCommand}"
                                                    Style="{StaticResource MaterialDesignIconButton}"
                                                    ToolTip="Próxima Página">
                                                <materialDesign:PackIcon Kind="ChevronRight"/>
                                            </Button>
                                            <Button Command="{Binding LastPageCommand}"
                                                    Style="{StaticResource MaterialDesignIconButton}"
                                                    ToolTip="Última Página">
                                                <materialDesign:PackIcon Kind="PageLast"/>
                                            </Button>
                                        </StackPanel>

                                        <TextBlock Grid.Column="2" 
                                                   Text="Itens por página:" 
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>

                                        <ComboBox Grid.Column="3"
                                                  SelectedValue="{Binding PageSize}"
                                                  Width="80"
                                                  Style="{StaticResource MaterialDesignOutlinedComboBox}">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding}"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                            <sys:Int32>10</sys:Int32>
                                            <sys:Int32>20</sys:Int32>
                                            <sys:Int32>50</sys:Int32>
                                            <sys:Int32>100</sys:Int32>
                                        </ComboBox>
                                    </Grid>
                                </materialDesign:Card>
                            </Grid>
                        </TabItem>

                        <!-- Movements Tab -->
                        <TabItem Header="Movimentações">
                            <Grid Margin="8">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Filters & Actions -->
                                <materialDesign:Card Grid.Row="0" Padding="16" Margin="0,0,0,8">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Grid Grid.Row="0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="200"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBox Grid.Column="0"
                                                     Text="{Binding MovementSearchTerm, UpdateSourceTrigger=PropertyChanged}"
                                                     materialDesign:HintAssist.Hint="Buscar movimentação..."
                                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                                     Margin="0,0,8,0"/>

                                            <ComboBox Grid.Column="1"
                                                      ItemsSource="{Binding Source={StaticResource MovementTypeValues}}"
                                                      SelectedItem="{Binding SelectedMovementType}"
                                                      materialDesign:HintAssist.Hint="Tipo"
                                                      Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                                      Margin="0,0,8,0">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Converter={StaticResource EnumToStringConverter}}"/>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>

                                            <Button Grid.Column="2"
                                                    Command="{Binding ClearMovementFiltersCommand}"
                                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                                    Margin="0,0,8,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="FilterRemove" 
                                                                             VerticalAlignment="Center"/>
                                                    <TextBlock Text="Limpar" Margin="4,0,0,0"/>
                                                </StackPanel>
                                            </Button>

                                            <Button Grid.Column="3"
                                                    Command="{Binding ExportMovementsCommand}"
                                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                                    Margin="0,0,8,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="FileExport" 
                                                                             VerticalAlignment="Center"/>
                                                    <TextBlock Text="Exportar" Margin="4,0,0,0"/>
                                                </StackPanel>
                                            </Button>
                                        </Grid>

                                        <Grid Grid.Row="1" Margin="0,8,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <DatePicker Grid.Column="0"
                                                        SelectedDate="{Binding MovementStartDate}"
                                                        materialDesign:HintAssist.Hint="Data Inicial"
                                                        Style="{StaticResource MaterialDesignOutlinedDatePicker}"
                                                        Margin="0,0,8,0"/>

                                            <DatePicker Grid.Column="1"
                                                        SelectedDate="{Binding MovementEndDate}"
                                                        materialDesign:HintAssist.Hint="Data Final"
                                                        Style="{StaticResource MaterialDesignOutlinedDatePicker}"
                                                        Margin="0,0,8,0"/>
                                        </Grid>
                                    </Grid>
                                </materialDesign:Card>

                                <!-- DataGrid -->
                                <materialDesign:Card Grid.Row="1" Padding="0">
                                    <DataGrid ItemsSource="{Binding FilteredMovements}"
                                              SelectedItem="{Binding SelectedMovement}"
                                              AutoGenerateColumns="False"
                                              IsReadOnly="True"
                                              CanUserAddRows="False"
                                              CanUserDeleteRows="False"
                                              SelectionMode="Single"
                                              materialDesign:DataGridAssist.CellPadding="8"
                                              materialDesign:DataGridAssist.ColumnHeaderPadding="8">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Data" 
                                                                Binding="{Binding Date, StringFormat={}{0:dd/MM/yyyy HH:mm}}" 
                                                                Width="140"/>

                                            <DataGridTextColumn Header="Produto" 
                                                                Binding="{Binding ProductName}" 
                                                                Width="*"
                                                                MinWidth="200"/>

                                            <DataGridTemplateColumn Header="Tipo" Width="100">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Border CornerRadius="12" Padding="8,4">
                                                            <Border.Style>
                                                                <Style TargetType="Border">
                                                                    <Setter Property="Background" Value="#4CAF50"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Out">
                                                                            <Setter Property="Background" Value="#F44336"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Adjustment">
                                                                            <Setter Property="Background" Value="#2196F3"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Border.Style>
                                                            <TextBlock Text="{Binding Type, Converter={StaticResource EnumToStringConverter}}"
                                                                       Foreground="White"
                                                                       HorizontalAlignment="Center"
                                                                       FontSize="11"
                                                                       FontWeight="Bold"/>
                                                        </Border>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>

                                            <DataGridTextColumn Header="Quantidade" 
                                                                Binding="{Binding Quantity}" 
                                                                Width="100">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <DataGridTextColumn Header="Anterior" 
                                                    Binding="{Binding PreviousQuantity}" 
                                                    Width="100"/>

                                            <DataGridTextColumn Header="Novo" 
                                                    Binding="{Binding NewQuantity}" 
                                                    Width="100"/>

                                            <DataGridTextColumn Header="Usuário" 
                                                                Binding="{Binding UserName}" 
                                                                Width="150"/>

                                            <DataGridTextColumn Header="Motivo" 
                                                                Binding="{Binding Notes}" 
                                                                Width="200"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </materialDesign:Card>

                                <!-- Pagination -->
                                <materialDesign:Card Grid.Row="2" Padding="16" Margin="0,8,0,0">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" 
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,16,0">
                                            <Run Text="Mostrando"/>
                                            <Run Text="{Binding FilteredMovements.Count, Mode=OneWay}" FontWeight="Bold"/>
                                            <Run Text="de"/>
                                            <Run Text="{Binding MovementTotalRecords, Mode=OneWay}" FontWeight="Bold"/>
                                            <Run Text="registros"/>
                                        </TextBlock>

                                        <StackPanel Grid.Column="1" 
                                                    Orientation="Horizontal"
                                                    HorizontalAlignment="Center">
                                            <Button Command="{Binding MovementFirstPageCommand}"
                                                    Style="{StaticResource MaterialDesignIconButton}"
                                                    ToolTip="Primeira Página">
                                                <materialDesign:PackIcon Kind="PageFirst"/>
                                            </Button>
                                            <Button Command="{Binding MovementPreviousPageCommand}"
                                                    Style="{StaticResource MaterialDesignIconButton}"
                                                    ToolTip="Página Anterior">
                                                <materialDesign:PackIcon Kind="ChevronLeft"/>
                                            </Button>

                                            <TextBlock VerticalAlignment="Center" Margin="16,0">
                                                <Run Text="Página"/>
                                                <Run Text="{Binding MovementCurrentPage, Mode=OneWay}" FontWeight="Bold"/>
                                                <Run Text="de"/>
                                                <Run Text="{Binding MovementTotalPages, Mode=OneWay}" FontWeight="Bold"/>
                                            </TextBlock>

                                            <Button Command="{Binding MovementNextPageCommand}"
                                                    Style="{StaticResource MaterialDesignIconButton}"
                                                    ToolTip="Próxima Página">
                                                <materialDesign:PackIcon Kind="ChevronRight"/>
                                            </Button>
                                            <Button Command="{Binding MovementLastPageCommand}"
                                                    Style="{StaticResource MaterialDesignIconButton}"
                                                    ToolTip="Última Página">
                                                <materialDesign:PackIcon Kind="PageLast"/>
                                            </Button>
                                        </StackPanel>

                                        <TextBlock Grid.Column="2" 
                                                   Text="Itens por página:" 
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>

                                        <ComboBox Grid.Column="3"
                                                  SelectedValue="{Binding MovementPageSize}"
                                                  Width="80"
                                                  Style="{StaticResource MaterialDesignOutlinedComboBox}">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding}"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                            <sys:Int32>10</sys:Int32>
                                            <sys:Int32>20</sys:Int32>
                                            <sys:Int32>50</sys:Int32>
                                            <sys:Int32>100</sys:Int32>
                                        </ComboBox>
                                    </Grid>
                                </materialDesign:Card>
                            </Grid>
                        </TabItem>

                        <!-- Low Stock Tab -->
                        <TabItem Header="Estoque Baixo">
                            <Grid Margin="8">
                                <materialDesign:Card Padding="0">
                                    <DataGrid ItemsSource="{Binding LowStockProducts}"
                                              AutoGenerateColumns="False"
                                              IsReadOnly="True"
                                              CanUserAddRows="False"
                                              CanUserDeleteRows="False"
                                              SelectionMode="Single"
                                              materialDesign:DataGridAssist.CellPadding="8"
                                              materialDesign:DataGridAssist.ColumnHeaderPadding="8">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Produto" 
                                                                Binding="{Binding ProductName}" 
                                                                Width="*"
                                                                MinWidth="250"/>

                                            <DataGridTextColumn Header="Quantidade Atual" 
                                                                Binding="{Binding Quantity}" 
                                                                Width="150">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                        <Setter Property="Foreground" Value="#FF9800"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <DataGridTextColumn Header="Estoque Mínimo" 
                                                                Binding="{Binding MinimumStock}" 
                                                                Width="150">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <DataGridTextColumn Header="Ponto de Reposição" 
                                                                Binding="{Binding ReorderPoint}" 
                                                                Width="150">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <DataGridTextColumn Header="Disponível" 
                                                                Binding="{Binding AvailableQuantity}" 
                                                                Width="120">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </materialDesign:Card>
                            </Grid>
                        </TabItem>

                        <!-- Out of Stock Tab -->
                        <TabItem Header="Sem Estoque">
                            <Grid Margin="8">
                                <materialDesign:Card Padding="0">
                                    <DataGrid ItemsSource="{Binding OutOfStockProducts}"
                                              AutoGenerateColumns="False"
                                              IsReadOnly="True"
                                              CanUserAddRows="False"
                                              CanUserDeleteRows="False"
                                              SelectionMode="Single"
                                              materialDesign:DataGridAssist.CellPadding="8"
                                              materialDesign:DataGridAssist.ColumnHeaderPadding="8">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Produto" 
                                                                Binding="{Binding ProductName}" 
                                                                Width="*"
                                                                MinWidth="300"/>

                                            <DataGridTextColumn Header="Reservado" 
                                                                Binding="{Binding ReservedQuantity}" 
                                                                Width="120">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <DataGridTextColumn Header="Última Atualização" 
                                                                Binding="{Binding LastStockUpdate, StringFormat={}{0:dd/MM/yyyy HH:mm}}" 
                                                                Width="170"/>

                                            <DataGridTemplateColumn Header="Status" Width="150">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Border Background="#F44336"
                                                                CornerRadius="12" Padding="12,6">
                                                            <TextBlock Text="SEM ESTOQUE"
                                                                       Foreground="White"
                                                                       HorizontalAlignment="Center"
                                                                       FontSize="12"
                                                                       FontWeight="Bold"/>
                                                        </Border>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </materialDesign:Card>
                            </Grid>
                        </TabItem>

                        <!-- Inventory Tab -->
                        <TabItem Header="Inventário">
                            <Grid Margin="8">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Filters & Actions -->
                                <materialDesign:Card Grid.Row="0" Padding="16" Margin="0,0,0,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="200"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBox Grid.Column="0"
                                                 Text="{Binding InventorySearchTerm, UpdateSourceTrigger=PropertyChanged}"
                                                 materialDesign:HintAssist.Hint="Buscar por código ou descrição..."
                                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                                 Margin="0,0,8,0">
                                            <TextBox.InputBindings>
                                                <KeyBinding Key="Enter" Command="{Binding LoadInventoryCommand}"/>
                                            </TextBox.InputBindings>
                                        </TextBox>

                                        <ComboBox Grid.Column="1"
                                                  ItemsSource="{Binding Categories}"
                                                  SelectedItem="{Binding SelectedInventoryCategory}"
                                                  DisplayMemberPath="Name"
                                                  materialDesign:HintAssist.Hint="Categoria"
                                                  Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                                  Margin="0,0,8,0"/>

                                        <Button Grid.Column="2"
                                                Command="{Binding ClearInventoryFiltersCommand}"
                                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                                Margin="0,0,8,0">
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="FilterRemove" 
                                                                         VerticalAlignment="Center"/>
                                                <TextBlock Text="Limpar" Margin="4,0,0,0"/>
                                            </StackPanel>
                                        </Button>

                                        <Button Grid.Column="3"
                                                Command="{Binding ExportInventoryCommand}"
                                                Style="{StaticResource MaterialDesignRaisedButton}">
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="FileExport" 
                                                                         VerticalAlignment="Center"/>
                                                <TextBlock Text="Exportar" Margin="4,0,0,0"/>
                                            </StackPanel>
                                        </Button>
                                    </Grid>
                                </materialDesign:Card>

                                <!-- DataGrid -->
                                <materialDesign:Card Grid.Row="1" Padding="0">
                                    <DataGrid ItemsSource="{Binding InventoryItems}"
                                              SelectedItem="{Binding SelectedInventoryItem}"
                                              AutoGenerateColumns="False"
                                              IsReadOnly="True"
                                              CanUserAddRows="False"
                                              CanUserDeleteRows="False"
                                              SelectionMode="Single"
                                              materialDesign:DataGridAssist.CellPadding="8"
                                              materialDesign:DataGridAssist.ColumnHeaderPadding="8">
                                        <DataGrid.Columns>
                                            <!-- Código -->
                                            <DataGridTextColumn Header="Código" 
                                                                Binding="{Binding InternalCode}" 
                                                                Width="120">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                                        <Setter Property="Foreground" Value="{DynamicResource PrimaryHueMidBrush}"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <!-- Descrição -->
                                            <DataGridTextColumn Header="Descrição" 
                                                                Binding="{Binding ProductName}" 
                                                                Width="*"
                                                                MinWidth="250">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="FontWeight" Value="Medium"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <!-- Categoria -->
                                            <DataGridTextColumn Header="Categoria" 
                                                                Binding="{Binding CategoryName}" 
                                                                Width="150">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBodyLight}"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <!-- Qtd Entrada -->
                                            <DataGridTextColumn Header="Qtd Entrada" 
                                                                Binding="{Binding TotalEntries}" 
                                                                Width="110">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                        <Setter Property="Foreground" Value="#4CAF50"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <!-- Qtd Saída -->
                                            <DataGridTextColumn Header="Qtd Saída" 
                                                                Binding="{Binding TotalExits}" 
                                                                Width="110">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                        <Setter Property="Foreground" Value="#F44336"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <!-- Disponível -->
                                            <DataGridTextColumn Header="Disponível" 
                                                                Binding="{Binding AvailableQuantity}" 
                                                                Width="110">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                        <Setter Property="FontSize" Value="14"/>
                                                        <Setter Property="Foreground" Value="{DynamicResource PrimaryHueMidBrush}"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <!-- Custo Unit. -->
                                            <DataGridTextColumn Header="Custo Unit." 
                                                                Binding="{Binding CostPrice, StringFormat={}{0:C2}}" 
                                                                Width="120">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                        <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBodyLight}"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <!-- Valor Total -->
                                            <DataGridTextColumn Header="Valor" 
                                                                Binding="{Binding TotalValue, StringFormat={}{0:C2}}" 
                                                                Width="130">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                        <Setter Property="FontSize" Value="14"/>
                                                        <Setter Property="Foreground" Value="#2196F3"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </materialDesign:Card>

                                <!-- Summary Footer -->
                                <materialDesign:Card Grid.Row="2" Padding="16" Margin="0,8,0,0" Background="#F5F5F5">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" 
                                                   Text="TOTAIS:"
                                                   FontWeight="Bold"
                                                   FontSize="14"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,32,0"/>

                                        <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0,0,24,0">
                                            <TextBlock Text="Entradas: " 
                                                       VerticalAlignment="Center"
                                                       Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                            <TextBlock Text="{Binding TotalInventoryEntries}" 
                                                       FontWeight="Bold"
                                                       FontSize="16"
                                                       Foreground="#4CAF50"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="3" Orientation="Horizontal" Margin="0,0,24,0">
                                            <TextBlock Text="Saídas: " 
                                                       VerticalAlignment="Center"
                                                       Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                            <TextBlock Text="{Binding TotalInventoryExits}" 
                                                       FontWeight="Bold"
                                                       FontSize="16"
                                                       Foreground="#F44336"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="4" Orientation="Horizontal">
                                            <TextBlock Text="Valor Total: " 
                                                       VerticalAlignment="Center"
                                                       Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                            <TextBlock Text="{Binding TotalInventoryValue, StringFormat={}{0:C2}}" 
                                                       FontWeight="Bold"
                                                       FontSize="18"
                                                       Foreground="#2196F3"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                </materialDesign:Card>
                            </Grid>
                        </TabItem>
                    </TabControl>
                </Grid>
            </materialDesign:Card>
        </Grid>

        <!-- Adjustment Form Dialog -->
        <Grid Grid.RowSpan="2"
              Visibility="{Binding IsAdjustmentFormOpen, Converter={StaticResource BoolToVisibilityConverter}}"
              Background="#80000000">
            <materialDesign:Card Width="500" MaxHeight="500"
                                 VerticalAlignment="Center"
                                 HorizontalAlignment="Center">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <Grid Grid.Row="0" Background="{DynamicResource PrimaryHueMidBrush}">
                        <TextBlock Text="Ajustar Estoque"
                                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                   Foreground="White"
                                   Margin="24,16"/>
                    </Grid>

                    <!-- Form -->
                    <StackPanel Grid.Row="1" Margin="24">
                        <TextBox Text="{Binding AdjustmentNewQuantity, UpdateSourceTrigger=PropertyChanged}"
                                 materialDesign:HintAssist.Hint="Nova Quantidade *"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 Margin="0,0,0,16"/>

                        <TextBox Text="{Binding AdjustmentReason, UpdateSourceTrigger=PropertyChanged}"
                                 materialDesign:HintAssist.Hint="Motivo do Ajuste *"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 MinLines="3"
                                 MaxLines="5"/>
                    </StackPanel>

                    <!-- Actions -->
                    <Grid Grid.Row="2" Background="{DynamicResource MaterialDesignDivider}" Margin="5"
                          >
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="1"
                                Command="{Binding CancelAdjustmentCommand}"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Content="Cancelar"
                                Margin="0,0,8,0"/>

                        <Button Grid.Column="2"
                                Command="{Binding SaveAdjustmentCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Content="Salvar"/>
                    </Grid>
                </Grid>
            </materialDesign:Card>
        </Grid>

        <!-- Status Message -->
        <materialDesign:Snackbar x:Name="StatusSnackbar"
                                 Grid.Row="1"
                                 HorizontalAlignment="Stretch"
                                 VerticalAlignment="Bottom"
                                 Margin="16,0,16,16"/>

        <!-- Loading Overlay -->
        <Grid Grid.RowSpan="2"
              Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
              Background="#B0000000"
              Panel.ZIndex="9999">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                             Value="0"
                             IsIndeterminate="True"
                             Width="60"
                             Height="60"
                             Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                <TextBlock Text="Carregando..."
                           Foreground="White"
                           FontSize="16"
                           FontWeight="Medium"
                           Margin="0,16,0,0"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
